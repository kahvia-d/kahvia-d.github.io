<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kahvia&#39;s Home</title>
  
  <subtitle>Never give up!</subtitle>
  <link href="https://blog.kahvia.cn/atom.xml" rel="self"/>
  
  <link href="https://blog.kahvia.cn/"/>
  <updated>2022-11-29T05:15:39.648Z</updated>
  <id>https://blog.kahvia.cn/</id>
  
  <author>
    <name>Kahvia</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Mysql-Uft8mb4</title>
    <link href="https://blog.kahvia.cn/2022/11/29/MysqlUtf8mb4.html"/>
    <id>https://blog.kahvia.cn/2022/11/29/MysqlUtf8mb4.html</id>
    <published>2022-11-29T04:31:58.919Z</published>
    <updated>2022-11-29T05:15:39.648Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>åœ¨ä½¿ç”¨MySQLæ•°æ®åº“å­˜å‚¨æ•°æ®çš„æ—¶å€™ï¼Œæ„å¤–å‘ç°ä¸èƒ½å­˜å‚¨Emojiè¡¨æƒ…ğŸ˜„ã€‚ç»è¿‡ç™¾åº¦æŸ¥è¯å¾—çŸ¥ï¼Œmysqlé»˜è®¤çš„ utf8 æ˜¯ä¸‰ä¸ªå­—èŠ‚çš„ï¼Œå­˜å‚¨ä¸äº†å››ä¸ªå­—èŠ‚çš„ç”Ÿåƒ»å­—æˆ–è€…Emojiè¡¨æƒ…ã€‚éœ€è¦æ¢æˆæ”¯æŒå››ä¸ªå­—èŠ‚çš„ utf8mb4 ï¼Œä¹Ÿå°±æ˜¯UTF-8 most byte 4 ã€‚</p><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># æ•°æ®åº“æ›´æ¢å­—ç¬¦é›†</span><br><span class="line">ALTER DATABASE AchatUserService CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;</span><br><span class="line"># è¡¨æ›´æ¢å­—ç¬¦é›†</span><br><span class="line">ALTER TABLE friendship CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</span><br><span class="line"># éœ€è¦æ”¹å˜çš„åˆ—è¿›è¡Œæ›´æ¢å­—ç¬¦é›†</span><br><span class="line">ALTER TABLE messages CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure><p>ä»…ä»…è¿™æ ·æ˜¯ä¸å¤Ÿçš„ã€‚åœ¨å»ºç«‹æ•°æ®åº“è¿æ¥çš„åœ°æ–¹ï¼Œè¿˜éœ€è¦æŒ‡å®šUTF-8å­—ç¬¦é›†ã€‚æ¯”å¦‚åœ¨Spring booté¡¹ç›®çš„é…ç½®æ–‡ä»¶ä¸­ï¼ŒæŒ‡å®šæ•°æ®åº“è¿æ¥çš„ url å¤„ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/AchatUserService?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8</span> <span class="comment"># here</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxxx</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">100MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">500MB</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">39939</span></span><br></pre></td></tr></table></figure><p>ä¸æŒ‡å®š utf-8 çš„è¯ï¼Œä¼°è®¡é»˜è®¤æ˜¯æŒ‰ç…§ utf8mb3 å»è¿æ¥çš„å§ï¼Œè¿™æ ·æ˜¯ä¿®æ”¹ä¸äº†è®¾ç½®äº† utf8mb4 å­—ç¬¦é›†çš„æ•°æ®çš„ã€‚ï¼ˆè¿™å¯æ˜¯é‡ç‚¹æ‰€åœ¨ï¼‰</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h3&gt;&lt;p&gt;åœ¨ä½¿ç”¨MySQLæ•°æ®åº“å­˜å‚¨æ•°æ®çš„æ—¶å€™ï¼Œæ„å¤–å‘ç°ä¸èƒ½å­˜å‚¨Emojiè¡¨æƒ…ğŸ˜„ã€‚ç»è¿‡ç™¾åº¦æŸ¥è¯å¾—çŸ¥ï¼Œmysqlé»˜è®¤çš„ utf8 æ˜¯ä¸‰ä¸ªå­—èŠ‚çš„ï¼Œå­˜å‚¨ä¸</summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Mysql" scheme="https://blog.kahvia.cn/tags/Mysql/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-VerticalText</title>
    <link href="https://blog.kahvia.cn/2022/11/19/FlutterVerticalText.html"/>
    <id>https://blog.kahvia.cn/2022/11/19/FlutterVerticalText.html</id>
    <published>2022-11-19T06:35:27.432Z</published>
    <updated>2022-11-19T07:27:35.146Z</updated>
    
    <content type="html"><![CDATA[<h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>ä»Šå¤©æœ‰äººé—®äº†æˆ‘ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ï¼šå¦‚ä½•å®ç°æ–‡å­—ç«–ç›´æ’åˆ—ï¼Œå°±åƒå¤è¯—è¯ä¸€æ ·ã€‚</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>æˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯ä½¿ç”¨ Container ç»„ä»¶åµŒå¥— Text ç»„ä»¶ï¼Œå›ºå®šå®ƒçš„å®½åº¦ï¼Œè¿™æ ·æ¥å®ç°ä¸€è¡Œä¸€ä¸ªæ–‡å­—ã€‚çœ‹èµ·æ¥å°±åƒç«–ç›´æ’åˆ—ä¸€æ ·ã€‚ä½†æ˜¯å®ƒçš„æ–‡å­—å‚ç›´é—´è·å¾ˆæ˜¾ç„¶ä¸æ–¹ä¾¿æ§åˆ¶ã€‚</p><p>æˆ‘ä¾¿å» StackOverflow ä¸Šæœç´¢äº†ä¸€ç•ª vertical textã€‚æœç„¶æœ‰æ‰€æ”¶è·ã€‚æœ‰äººæå‡ºï¼Œä½¿ç”¨ Wrap ç»„ä»¶å»å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚åˆ†å‰²éœ€è¦ç«–ç›´æ’åˆ—çš„å­—ç¬¦ä¸²ä¸ºå•ä¸ªå­—ï¼Œç”¨ Text ç»„ä»¶åŒ…è£¹æ¯ä¸ªå­—ï¼Œç„¶ååˆ©ç”¨ Wrap ç»„ä»¶çš„ direction ä½¿å¾—è¿™äº› Text åˆ—è¡¨å‚ç›´æ’åˆ—ï¼Œæ’ä¸ä¸‹åˆ™å¾€å³è¾¹å¦èµ·ä¸€åˆ—ã€‚</p><p>æˆ‘è‡ªç„¶æ˜¯å¸Œæœ›å¤è¯—ä¸€åˆ—ä¸€å¥çš„ã€‚æ‰€ä»¥å°±ä¸ç”¨è€ƒè™‘è¶…å‡ºæ¢åˆ—ï¼Œæ‰‹åŠ¨åˆ†å‰²å½“ç„¶æœ€å¥½ã€‚æ—¢ç„¶ä½¿ç”¨ä¸åˆ° Wrap ï¼Œç”¨å„ç§ ListView æ¥å±•ç¤ºä¸Šé¢çš„ Text ä»¬ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>å½“ç„¶äº†ï¼Œå¦‚æœæ˜¯æ˜¾ç¤ºçš„å®‹è¯ï¼Œé‚£ä¸€å¥å¤ªé•¿ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ï¼Œä¸ºäº†ä¿é™©èµ·è§ï¼Œæˆ‘è¿˜æ˜¯ä½¿ç”¨äº†Wrapåšäº†è¶…å‡ºå¤„ç†ã€‚</p><p>å¦‚æ­¤ä¸€æ¥ï¼Œå°±å¯ä»¥ç€æ‰‹å®ç°äº†ã€‚å°è£…ä¸€ä¸ªç”¨ Wrap ä¸ºæ ¸å¿ƒçš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œä¸»è¦ç”¨äºå±•ç¤ºå¤è¯—çš„ä¸€å¥ã€‚æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªå¤è¯—åï¼Œå¯ä»¥å°†å¤è¯—æŒ‰æ ‡ç‚¹ç¬¦å·åˆ†å‰²ï¼Œåˆ†å‰²åçš„å¥å­ç”¨è‡ªå®šä¹‰çš„ VerticalText æ˜¾ç¤ºå°±å¯ä»¥äº†ã€‚æˆ‘æ›´å€¾å‘äºç”¨ Row ç»„ä»¶å»æ˜¾ç¤ºï¼Œå› ä¸ºæˆ‘èƒ½ç”¨å®ƒå†³å®šä¸»è½´æ–¹å‘å’Œäº¤å‰è½´æ–¹å‘çš„èµ·ç‚¹ï¼Œè¿™èƒ½åšåˆ°å¤è¯—å¥çš„ä¸Šå¯¹é½ï¼Œå’Œå³å¯¹é½ã€‚ç”¨ ListView çš„è¯ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç¿»è½¬å¤è¯—å¥çš„é¡ºåºï¼Œä½†æ˜¯ä¸å¤ªæ–¹ä¾¿å¯¹é½ã€‚</p><p>å…·ä½“çš„å®ç°å¯ä»¥å‚è€ƒå¦‚ä¸‹ä»£ç ã€‚</p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> MyPage(&#123;<span class="keyword">super</span>.key&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">List</span>&lt;VerticalText&gt; poetry=<span class="keyword">const</span>[</span><br><span class="line">      VerticalText(<span class="string">&quot;å°†è¿›é…’ï¼Œ&quot;</span>),</span><br><span class="line">      VerticalText(<span class="string">&quot;æ¯è«åœã€‚&quot;</span>),</span><br><span class="line">      VerticalText(<span class="string">&quot;ä¸å›æ­Œä¸€æ›²,&quot;</span>),</span><br><span class="line">      VerticalText(<span class="string">&quot;è¯·å›ä¸ºæˆ‘å€¾è€³å¬ã€‚&quot;</span>)</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: <span class="keyword">const</span> Text(<span class="string">&quot;test&quot;</span>),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Row(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.end,</span><br><span class="line">          crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">          children: <span class="built_in">List</span>.from(poetry.reversed) ,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VerticalText</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> text;</span><br><span class="line">  <span class="keyword">const</span> VerticalText(<span class="keyword">this</span>.text,&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">//åˆ†å‰²å­—ç¬¦ä¸²ä¸ºå•å­—ï¼Œæ¯ä¸ªå­—åŒ…è£¹ä¸€ä¸ªTextç»„ä»¶ï¼Œä½œä¸ºWrapç»„ä»¶çš„å­ç»„ä»¶</span></span><br><span class="line">    <span class="built_in">List</span>&lt;Text&gt; texts=text.split(<span class="string">&quot;&quot;</span>).map((string) =&gt; Text(string, style: <span class="keyword">const</span> TextStyle(fontSize: <span class="number">17</span>))).toList();</span><br><span class="line">    <span class="keyword">return</span> Padding(</span><br><span class="line">      padding: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">10</span>),</span><br><span class="line">      child: Wrap(</span><br><span class="line">        <span class="comment">//æ’åˆ—æ–¹å¼ï¼Œverticalä»£è¡¨ç«–ç€æ’ï¼Œæ’ä¸å¤Ÿå°±å¾€æ—è¾¹æ’</span></span><br><span class="line">        direction: Axis.vertical,</span><br><span class="line">        <span class="comment">//ä¸»è½´æ–¹å‘ä¸Šé—´è·</span></span><br><span class="line">        spacing: <span class="number">20</span>,</span><br><span class="line">        <span class="comment">//äº¤å‰è½´æ–¹å‘ä¸Šé—´è·</span></span><br><span class="line">        runSpacing: <span class="number">30</span>,</span><br><span class="line">        alignment: WrapAlignment.center,</span><br><span class="line">        children: texts,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pics.kahvia.cn/img/image-20221119145723737.png" alt="æ•ˆæœå›¾"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;éœ€æ±‚&quot;&gt;&lt;a href=&quot;#éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;éœ€æ±‚&quot;&gt;&lt;/a&gt;éœ€æ±‚&lt;/h3&gt;&lt;p&gt;ä»Šå¤©æœ‰äººé—®äº†æˆ‘ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ï¼šå¦‚ä½•å®ç°æ–‡å­—ç«–ç›´æ’åˆ—ï¼Œå°±åƒå¤è¯—è¯ä¸€æ ·ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ€è·¯&quot;&gt;&lt;a href=&quot;#æ€è·¯&quot; cla</summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>OS-Lab2</title>
    <link href="https://blog.kahvia.cn/2022/11/13/OS-lab2.html"/>
    <id>https://blog.kahvia.cn/2022/11/13/OS-lab2.html</id>
    <published>2022-11-13T11:57:16.204Z</published>
    <updated>2022-11-13T12:01:06.478Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç»ƒä¹ 0"><a href="#ç»ƒä¹ 0" class="headerlink" title="ç»ƒä¹ 0"></a>ç»ƒä¹ 0</h2><blockquote><p>ç»ƒä¹ 0ï¼šå¡«å†™å·²æœ‰å®éªŒ<br>æœ¬å®éªŒä¾èµ–å®éªŒ1ã€‚è¯·æŠŠä½ åšçš„å®éªŒ1çš„ä»£ç å¡«å…¥æœ¬å®éªŒä¸­ä»£ç ä¸­æœ‰â€œLAB1â€çš„æ³¨é‡Šç›¸åº”éƒ¨åˆ†ã€‚</p></blockquote><p>ä½¿ç”¨ Meld Diff Viewer å°† lab1 çš„ä»£ç å¡«å…¥äº† lab2 çš„ç›¸åº”ä½ç½®ã€‚</p><h2 id="ç»ƒä¹ 1"><a href="#ç»ƒä¹ 1" class="headerlink" title="ç»ƒä¹ 1"></a>ç»ƒä¹ 1</h2><blockquote><p>ç»ƒä¹ 1ï¼šå®ç° first-fit è¿ç»­ç‰©ç†å†…å­˜åˆ†é…ç®—æ³•ï¼ˆéœ€è¦ç¼–ç¨‹ï¼‰<br>åœ¨å®ç°first fit å†…å­˜åˆ†é…ç®—æ³•çš„å›æ”¶å‡½æ•°æ—¶ï¼Œè¦è€ƒè™‘åœ°å€è¿ç»­çš„ç©ºé—²å—ä¹‹é—´çš„åˆå¹¶æ“ä½œã€‚æç¤º:åœ¨å»ºç«‹ç©ºé—²é¡µå—é“¾è¡¨æ—¶ï¼Œéœ€è¦æŒ‰ç…§ç©ºé—²é¡µå—èµ·å§‹åœ°å€æ¥æ’åºï¼Œå½¢æˆä¸€ä¸ªæœ‰åºçš„é“¾è¡¨ã€‚å¯èƒ½ä¼šä¿®æ”¹default_pmm.cä¸­çš„default_initï¼Œdefault_init_memmapï¼Œdefault_alloc_pagesï¼Œdefault_free_pagesç­‰ç›¸å…³å‡½æ•°ã€‚è¯·ä»”ç»†æŸ¥çœ‹å’Œç†è§£default_pmm.cä¸­çš„æ³¨é‡Šã€‚<br>è¯·åœ¨å®éªŒæŠ¥å‘Šä¸­ç®€è¦è¯´æ˜ä½ çš„è®¾è®¡å®ç°è¿‡ç¨‹ã€‚è¯·å›ç­”å¦‚ä¸‹é—®é¢˜ï¼š<br>ä½ çš„first fitç®—æ³•æ˜¯å¦æœ‰è¿›ä¸€æ­¥çš„æ”¹è¿›ç©ºé—´</p></blockquote><ol><li>è¿›å…¥ucoreæ“ä½œç³»ç»Ÿä¹‹åï¼Œç¬¬ä¸€ä¸ªæ‰§è¡Œçš„å‡½æ•°æ˜¯ default_init_memmapï¼Œå¯¹å†…æ ¸è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨å…¶ä¸­ï¼Œè°ƒç”¨äº†åˆå§‹åŒ–ç‰©ç†å†…å­˜çš„å‡½æ•° pmm_init ã€‚</li><li>è¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯å®Œæˆå¯¹äºæ•´ä¸ªç‰©ç†å†…å­˜çš„åˆå§‹åŒ–ï¼Œé¡µåˆå§‹åŒ–åªæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè°ƒç”¨ä½ç½®åå‰ï¼Œå‡½æ•°ä¹‹åçš„éƒ¨åˆ†å¯ä»¥ä¸ç®¡ï¼Œç›´æ¥è¿›å…¥page_initå‡½æ•°ã€‚</li><li>å‡½æ•° page_init å®Œæˆäº†ä¸€ä¸ªæ•´ä½“ç‰©ç†åœ°å€çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚</li><li>é¡µåˆå§‹åŒ–éƒ¨åˆ†ï¼Œç”±å‡½æ•° init_memmap å¤„ç†ã€‚</li></ol><p>åœ¨ kern&#x2F;mm&#x2F;default_pmm.c æ–‡ä»¶ä¸­ï¼Œä¿®æ”¹å„ä¸ªå‡½æ•°ã€‚</p><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span></span><br><span class="line"><span class="title function_">default_init_memmap</span><span class="params">(<span class="keyword">struct</span> Page *base, <span class="type">size_t</span> n)</span> &#123;</span><br><span class="line">    assert(n &gt; <span class="number">0</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *<span class="title">p</span> =</span> base;</span><br><span class="line">    <span class="keyword">for</span> (; p != base + n; p ++) &#123;</span><br><span class="line">        assert(PageReserved(p));</span><br><span class="line">        p-&gt;flags = <span class="number">0</span>;</span><br><span class="line">        SetPageProperty(p);</span><br><span class="line">        p-&gt;property = <span class="number">0</span>;</span><br><span class="line">        set_page_ref(p, <span class="number">0</span>);</span><br><span class="line">        list_add_before(&amp;free_list, &amp;(p-&gt;page_link));</span><br><span class="line">    &#125;</span><br><span class="line">    nr_free += n;</span><br><span class="line">    <span class="comment">//first block</span></span><br><span class="line">    base-&gt;property = n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">struct</span> Page *</span><br><span class="line"><span class="title function_">default_alloc_pages</span><span class="params">(<span class="type">size_t</span> n)</span> &#123;</span><br><span class="line">    assert(n &gt; <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (n &gt; nr_free) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">list_entry_t</span> *le, *len;</span><br><span class="line">    le = &amp;free_list;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>((le=list_next(le)) != &amp;free_list) &#123;</span><br><span class="line">      <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *<span class="title">p</span> =</span> le2page(le, page_link);</span><br><span class="line">      <span class="keyword">if</span>(p-&gt;property &gt;= n)&#123;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">          len = list_next(le);</span><br><span class="line">          <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *<span class="title">pp</span> =</span> le2page(le, page_link);</span><br><span class="line">          SetPageReserved(pp);</span><br><span class="line">          ClearPageProperty(pp);</span><br><span class="line">          list_del(le);</span><br><span class="line">          le = len;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;property&gt;n)&#123;</span><br><span class="line">          (le2page(le,page_link))-&gt;property = p-&gt;property - n;</span><br><span class="line">        &#125;</span><br><span class="line">        ClearPageProperty(p);</span><br><span class="line">        SetPageReserved(p);</span><br><span class="line">        nr_free -= n;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span></span><br><span class="line"><span class="title function_">default_free_pages</span><span class="params">(<span class="keyword">struct</span> Page *base, <span class="type">size_t</span> n)</span> &#123;</span><br><span class="line">    assert(n &gt; <span class="number">0</span>);</span><br><span class="line">    assert(PageReserved(base));</span><br><span class="line"></span><br><span class="line">    <span class="type">list_entry_t</span> *le = &amp;free_list;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> * <span class="title">p</span>;</span></span><br><span class="line">    <span class="keyword">while</span>((le=list_next(le)) != &amp;free_list) &#123;</span><br><span class="line">      p = le2page(le, page_link);</span><br><span class="line">      <span class="keyword">if</span>(p&gt;base)&#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//list_add_before(le, base-&gt;page_link);</span></span><br><span class="line">    <span class="keyword">for</span>(p=base;p&lt;base+n;p++)&#123;</span><br><span class="line">      list_add_before(le, &amp;(p-&gt;page_link));</span><br><span class="line">    &#125;</span><br><span class="line">    base-&gt;flags = <span class="number">0</span>;</span><br><span class="line">    set_page_ref(base, <span class="number">0</span>);</span><br><span class="line">    ClearPageProperty(base);</span><br><span class="line">    SetPageProperty(base);</span><br><span class="line">    base-&gt;property = n;</span><br><span class="line">    </span><br><span class="line">    p = le2page(le,page_link) ;</span><br><span class="line">    <span class="keyword">if</span>( base+n == p )&#123;</span><br><span class="line">      base-&gt;property += p-&gt;property;</span><br><span class="line">      p-&gt;property = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    le = list_prev(&amp;(base-&gt;page_link));</span><br><span class="line">    p = le2page(le, page_link);</span><br><span class="line">    <span class="keyword">if</span>(le!=&amp;free_list &amp;&amp; p==base<span class="number">-1</span>)&#123;</span><br><span class="line">      <span class="keyword">while</span>(le!=&amp;free_list)&#123;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;property)&#123;</span><br><span class="line">          p-&gt;property += base-&gt;property;</span><br><span class="line">          base-&gt;property = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        le = list_prev(le);</span><br><span class="line">        p = le2page(le,page_link);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    nr_free += n;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»ƒä¹ 2"><a href="#ç»ƒä¹ 2" class="headerlink" title="ç»ƒä¹ 2"></a>ç»ƒä¹ 2</h2><blockquote><p>ç»ƒä¹ 2ï¼šå®ç°å¯»æ‰¾è™šæ‹Ÿåœ°å€å¯¹åº”çš„é¡µè¡¨é¡¹ï¼ˆéœ€è¦ç¼–ç¨‹ï¼‰<br>é€šè¿‡è®¾ç½®é¡µè¡¨å’Œå¯¹åº”çš„é¡µè¡¨é¡¹ï¼Œå¯å»ºç«‹è™šæ‹Ÿå†…å­˜åœ°å€å’Œç‰©ç†å†…å­˜åœ°å€çš„å¯¹åº”å…³ç³»ã€‚å…¶ä¸­çš„get_pteå‡½æ•°æ˜¯è®¾ç½®é¡µè¡¨é¡¹ç¯èŠ‚ä¸­çš„ä¸€ä¸ªé‡è¦æ­¥éª¤ã€‚æ­¤å‡½æ•°æ‰¾åˆ°ä¸€ä¸ªè™šåœ°å€å¯¹åº”çš„äºŒçº§é¡µè¡¨é¡¹çš„å†…æ ¸è™šåœ°å€ï¼Œå¦‚æœæ­¤äºŒçº§é¡µè¡¨é¡¹ä¸å­˜åœ¨ï¼Œåˆ™åˆ†é…ä¸€ä¸ªåŒ…å«æ­¤é¡¹çš„äºŒçº§é¡µè¡¨ã€‚æœ¬ç»ƒä¹ éœ€è¦è¡¥å…¨get_pteå‡½æ•° in kern&#x2F;mm&#x2F;pmm.cï¼Œå®ç°å…¶åŠŸèƒ½ã€‚</p></blockquote><p>æ‰“å¼€ pmm.c æ–‡ä»¶ï¼Œæ ¹æ®æ³¨é‡Šå®ç°ä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//get_pte - get pte and return the kernel virtual address of this pte for la</span></span><br><span class="line"><span class="comment">//        - if the PT contians this pte didn&#x27;t exist, alloc a page for PT</span></span><br><span class="line"><span class="comment">// parameter:</span></span><br><span class="line"><span class="comment">//  pgdir:  the kernel virtual base address of PDT</span></span><br><span class="line"><span class="comment">//  la:     the linear address need to map</span></span><br><span class="line"><span class="comment">//  create: a logical value to decide if alloc a page for PT</span></span><br><span class="line"><span class="comment">// return vaule: the kernel virtual address of this pte</span></span><br><span class="line"><span class="type">pte_t</span> *</span><br><span class="line"><span class="title function_">get_pte</span><span class="params">(<span class="type">pde_t</span> *pgdir, <span class="type">uintptr_t</span> la, <span class="type">bool</span> create)</span> &#123;</span><br><span class="line">    <span class="comment">/* LAB2 EXERCISE 2: YOUR CODE</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * If you need to visit a physical address, please use KADDR()</span></span><br><span class="line"><span class="comment">     * please read pmm.h for useful macros</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Maybe you want help comment, BELOW comments can help you finish the code</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Some Useful MACROs and DEFINEs, you can use them in below implementation.</span></span><br><span class="line"><span class="comment">     * MACROs or Functions:</span></span><br><span class="line"><span class="comment">     *   PDX(la) = the index of page directory entry of VIRTUAL ADDRESS la.</span></span><br><span class="line"><span class="comment">     *   KADDR(pa) : takes a physical address and returns the corresponding kernel virtual address.</span></span><br><span class="line"><span class="comment">     *   set_page_ref(page,1) : means the page be referenced by one time</span></span><br><span class="line"><span class="comment">     *   page2pa(page): get the physical address of memory which this (struct Page *) page  manages</span></span><br><span class="line"><span class="comment">     *   struct Page * alloc_page() : allocation a page</span></span><br><span class="line"><span class="comment">     *   memset(void *s, char c, size_t n) : sets the first n bytes of the memory area pointed by s</span></span><br><span class="line"><span class="comment">     *                                       to the specified value c.</span></span><br><span class="line"><span class="comment">     * DEFINEs:</span></span><br><span class="line"><span class="comment">     *   PTE_P           0x001                   // page table/directory entry flags bit : Present</span></span><br><span class="line"><span class="comment">     *   PTE_W           0x002                   // page table/directory entry flags bit : Writeable</span></span><br><span class="line"><span class="comment">     *   PTE_U           0x004                   // page table/directory entry flags bit : User can access</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">    <span class="type">pde_t</span> *pdep = <span class="literal">NULL</span>;   <span class="comment">// (1) find page directory entry</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span>) &#123;              <span class="comment">// (2) check if entry is not present</span></span><br><span class="line">                          <span class="comment">// (3) check if creating is needed, then alloc page for page table</span></span><br><span class="line">                          <span class="comment">// CAUTION: this page is used for page table, not for common data page</span></span><br><span class="line">                          <span class="comment">// (4) set page reference</span></span><br><span class="line">        <span class="type">uintptr_t</span> pa = <span class="number">0</span>; <span class="comment">// (5) get linear address of page</span></span><br><span class="line">                          <span class="comment">// (6) clear page content using memset</span></span><br><span class="line">                          <span class="comment">// (7) set page directory entry&#x27;s permission</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;          <span class="comment">// (8) return page table entry</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="comment">//å°è¯•è·å¾—é¡µè¡¨</span></span><br><span class="line">    <span class="type">pde_t</span> *pdep = &amp;pgdir[PDX(la)]; </span><br><span class="line">    <span class="comment">//è‹¥æ˜¯è·å–ä¸æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (!(*pdep &amp; PTE_P)) &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *<span class="title">page</span>;</span></span><br><span class="line">        <span class="comment">//è‹¥æ˜¯ä¸éœ€è¦åˆ›å»ºæˆ–è€…åˆ›å»ºå¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (!create || (page = alloc_page()) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¢åŠ å¼•ç”¨æ¬¡æ•°</span></span><br><span class="line">        set_page_ref(page, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//å¾—åˆ°è¯¥é¡µç‰©ç†åœ°å€</span></span><br><span class="line">        <span class="type">uintptr_t</span> pa = page2pa(page);</span><br><span class="line">        <span class="comment">//ç‰©ç†åœ°å€è½¬è™šæ‹Ÿåœ°å€å¹¶åˆå§‹åŒ–</span></span><br><span class="line">        <span class="built_in">memset</span>(KADDR(pa), <span class="number">0</span>, PGSIZE);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ§åˆ¶ä½</span></span><br><span class="line">        *pdep = pa | PTE_U | PTE_W | PTE_P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¿”å›çš„æ˜¯è™šæ‹Ÿåœ°å€laå¯¹åº”çš„é¡µè¡¨é¡¹å…¥å£åœ°å€</span></span><br><span class="line">    <span class="keyword">return</span> &amp;((<span class="type">pte_t</span> *)KADDR(PDE_ADDR(*pdep)))[PTX(la)];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆå°è¯•ä½¿ç”¨PDXå‡½æ•°ï¼Œè·å–ä¸€çº§é¡µè¡¨çš„ä½ç½®ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œå¯ä»¥ç›´æ¥è¿”å›ã€‚</li><li>å¦‚æœè·å–ä¸æˆåŠŸï¼Œé‚£ä¹ˆéœ€è¦æ ¹æ®createæ ‡è®°ä½æ¥å†³å®šæ˜¯å¦åˆ›å»ºè¿™ä¸€ä¸ªäºŒçº§é¡µè¡¨ï¼ˆæ³¨æ„ï¼Œä¸€çº§é¡µè¡¨ä¸­ï¼Œå­˜å‚¨çš„éƒ½æ˜¯äºŒçº§é¡µè¡¨çš„èµ·å§‹åœ°å€ï¼‰ã€‚å¦‚æœcreateä¸º0ï¼Œé‚£ä¹ˆä¸åˆ›å»ºï¼Œå¦åˆ™åˆ›å»ºã€‚</li><li>æ—¢ç„¶éœ€è¦æŸ¥æ‰¾è¿™ä¸ªé¡µè¡¨ï¼Œé‚£ä¹ˆé¡µè¡¨çš„å¼•ç”¨æ¬¡æ•°å°±è¦åŠ ä¸€ã€‚</li><li>ä¹‹åï¼Œéœ€è¦ä½¿ç”¨memsetå°†æ–°å»ºçš„è¿™ä¸ªé¡µè¡¨è™šæ‹Ÿåœ°å€ï¼Œå…¨éƒ¨è®¾ç½®ä¸º0ï¼Œå› ä¸ºè¿™ä¸ªé¡µæ‰€ä»£è¡¨çš„è™šæ‹Ÿåœ°å€éƒ½æ²¡æœ‰è¢«æ˜ å°„ã€‚</li><li>æ¥ä¸‹æ¥æ˜¯è®¾ç½®æ§åˆ¶ä½ã€‚è¿™é‡Œåº”è¯¥è®¾ç½®åŒæ—¶è®¾ç½®ä¸ŠPTE_Uã€PTE_Wå’ŒPTE_Pï¼Œåˆ†åˆ«ä»£è¡¨ç”¨æˆ·æ€çš„è½¯ä»¶å¯ä»¥è¯»å–å¯¹åº”åœ°å€çš„ç‰©ç†å†…å­˜é¡µå†…å®¹ã€ç‰©ç†å†…å­˜é¡µå†…å®¹å¯å†™ã€ç‰©ç†å†…å­˜é¡µå­˜åœ¨ã€‚</li></ul><h2 id="ç»ƒä¹ 3"><a href="#ç»ƒä¹ 3" class="headerlink" title="ç»ƒä¹ 3"></a>ç»ƒä¹ 3</h2><blockquote><p>ç»ƒä¹ 3ï¼šé‡Šæ”¾æŸè™šåœ°å€æ‰€åœ¨çš„é¡µå¹¶å–æ¶ˆå¯¹åº”äºŒçº§é¡µè¡¨é¡¹çš„æ˜ å°„ï¼ˆéœ€è¦ç¼–ç¨‹ï¼‰<br>å½“é‡Šæ”¾ä¸€ä¸ªåŒ…å«æŸè™šåœ°å€çš„ç‰©ç†å†…å­˜é¡µæ—¶ï¼Œéœ€è¦è®©å¯¹åº”æ­¤ç‰©ç†å†…å­˜é¡µçš„ç®¡ç†æ•°æ®ç»“æ„Pageåšç›¸å…³çš„æ¸…é™¤å¤„ç†ï¼Œä½¿å¾—æ­¤ç‰©ç†å†…å­˜é¡µæˆä¸ºç©ºé—²ï¼›å¦å¤–è¿˜éœ€æŠŠè¡¨ç¤ºè™šåœ°å€ä¸ç‰©ç†åœ°å€å¯¹åº”å…³ç³»çš„äºŒçº§é¡µè¡¨é¡¹æ¸…é™¤ã€‚è¯·ä»”ç»†æŸ¥çœ‹å’Œç†è§£page_remove_pteå‡½æ•°ä¸­çš„æ³¨é‡Šã€‚ä¸ºæ­¤ï¼Œéœ€è¦è¡¥å…¨åœ¨<br>kern&#x2F;mm&#x2F;pmm.cä¸­çš„page_remove_pteå‡½æ•°ã€‚page_remove_pteå‡½æ•°çš„è°ƒç”¨å…³ç³»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š<br>å›¾2 page_remove_pteå‡½æ•°çš„è°ƒç”¨å…³ç³»å›¾<br>è¯·åœ¨å®éªŒæŠ¥å‘Šä¸­ç®€è¦è¯´æ˜ä½ çš„è®¾è®¡å®ç°è¿‡ç¨‹ã€‚è¯·å›ç­”å¦‚ä¸‹é—®é¢˜ï¼š<br>æ•°æ®ç»“æ„Pageçš„å…¨å±€å˜é‡ï¼ˆå…¶å®æ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰çš„æ¯ä¸€é¡¹ä¸é¡µè¡¨ä¸­çš„é¡µç›®å½•é¡¹å’Œé¡µè¡¨é¡¹æœ‰æ— å¯¹åº”å…³ç³»ï¼Ÿå¦‚æœæœ‰ï¼Œå…¶å¯¹åº”å…³ç³»æ˜¯å•¥ï¼Ÿ<br>å¦‚æœå¸Œæœ›è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€ç›¸ç­‰ï¼Œåˆ™éœ€è¦å¦‚ä½•ä¿®æ”¹lab2ï¼Œå®Œæˆæ­¤äº‹ï¼Ÿ é¼“åŠ±é€šè¿‡ç¼–ç¨‹æ¥å…·ä½“å®Œæˆè¿™ä¸ªé—®é¢˜</p></blockquote><h3 id="1-1"><a href="#1-1" class="headerlink" title="1"></a>1</h3><p>page_remove_pteå‡½æ•°è¡¥å…¨å¦‚ä¸‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//page_remove_pte - free an Page sturct which is related linear address la</span></span><br><span class="line"><span class="comment">//                - and clean(invalidate) pte which is related linear address la</span></span><br><span class="line"><span class="comment">//note: PT is changed, so the TLB need to be invalidate </span></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span></span><br><span class="line"><span class="title function_">page_remove_pte</span><span class="params">(<span class="type">pde_t</span> *pgdir, <span class="type">uintptr_t</span> la, <span class="type">pte_t</span> *ptep)</span> &#123;</span><br><span class="line">    <span class="comment">/* LAB2 EXERCISE 3: YOUR CODE</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Please check if ptep is valid, and tlb must be manually updated if mapping is updated</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Maybe you want help comment, BELOW comments can help you finish the code</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Some Useful MACROs and DEFINEs, you can use them in below implementation.</span></span><br><span class="line"><span class="comment">     * MACROs or Functions:</span></span><br><span class="line"><span class="comment">     *   struct Page *page pte2page(*ptep): get the according page from the value of a ptep</span></span><br><span class="line"><span class="comment">     *   free_page : free a page</span></span><br><span class="line"><span class="comment">     *   page_ref_dec(page) : decrease page-&gt;ref. NOTICE: ff page-&gt;ref == 0 , then this page should be free.</span></span><br><span class="line"><span class="comment">     *   tlb_invalidate(pde_t *pgdir, uintptr_t la) : Invalidate a TLB entry, but only if the page tables being</span></span><br><span class="line"><span class="comment">     *                        edited are the ones currently in use by the processor.</span></span><br><span class="line"><span class="comment">     * DEFINEs:</span></span><br><span class="line"><span class="comment">     *   PTE_P           0x001                   // page table/directory entry flags bit : Present</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span>) &#123;                      <span class="comment">//(1) check if this page table entry is present</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *<span class="title">page</span> =</span> <span class="literal">NULL</span>; <span class="comment">//(2) find corresponding page to pte</span></span><br><span class="line">                                  <span class="comment">//(3) decrease page reference</span></span><br><span class="line">                                  <span class="comment">//(4) and free this page when page reference reachs 0</span></span><br><span class="line">                                  <span class="comment">//(5) clear second page table entry</span></span><br><span class="line">                                  <span class="comment">//(6) flush tlb</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span> (*ptep &amp; PTE_P) &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Page</span> *<span class="title">page</span> =</span> pte2page(*ptep);</span><br><span class="line">        <span class="keyword">if</span> (page_ref_dec(page) == <span class="number">0</span>) &#123;</span><br><span class="line">            free_page(page);</span><br><span class="line">        &#125;</span><br><span class="line">        *ptep = <span class="number">0</span>;</span><br><span class="line">        tlb_invalidate(pgdir, la);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆåˆ¤æ–­è¯¥é¡µè¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œå¦‚æœåªè¢«å¼•ç”¨äº†ä¸€æ¬¡ï¼Œé‚£ä¹ˆç›´æ¥é‡Šæ”¾æ‰è¿™é¡µï¼Œ å¦åˆ™å°±åˆ æ‰äºŒçº§é¡µè¡¨çš„è¯¥è¡¨é¡¹ï¼Œå³è¯¥é¡µçš„å…¥å£ã€‚æˆ‘ä»¬å…ˆå°†ç‰©ç†é¡µçš„å¼•ç”¨æ•°ç›®å‡ä¸€ï¼Œå¦‚æœå˜ä¸ºé›¶ï¼Œé‚£ä¹ˆé‡Šæ”¾é¡µé¢ï¼›ç„¶åå°†é¡µç›®å½•é¡¹æ¸…é›¶ï¼Œåˆ·æ–°é¡µè¡¨ï¼Œå³å¯å–æ¶ˆé¡µè¡¨æ˜ å°„ã€‚</p><h3 id="2-1"><a href="#2-1" class="headerlink" title="2"></a>2</h3><p>æ•°æ®ç»“æ„Pageçš„å…¨å±€å˜é‡çš„æ¯ä¸€é¡¹ä¸é¡µè¡¨ä¸­çš„é¡µç›®å½•é¡¹å’Œé¡µè¡¨é¡¹æœ‰å…³ç³»ã€‚æ•°æ®ç»“æ„pageæ˜¯æœ€ä½çº§çš„é¡µè¡¨ï¼Œç›®å½•é¡¹æ˜¯ä¸€çº§é¡µè¡¨ï¼Œå­˜å‚¨çš„å†…å®¹æ˜¯é¡µè¡¨é¡¹çš„èµ·å§‹åœ°å€ï¼ˆäºŒçº§é¡µè¡¨ï¼‰ï¼Œè€Œé¡µè¡¨é¡¹æ˜¯äºŒçº§é¡µè¡¨ï¼Œå­˜å‚¨çš„æ˜¯æ¯ä¸ªé¡µè¡¨çš„å¼€å§‹åœ°å€ï¼Œè¿™äº›å†…å®¹ä¹‹é—´çš„å…³ç³»æ—¶é€šè¿‡çº¿æ€§åœ°å€é«˜ä½ä½ä¸åŒåŠŸèƒ½çš„å¯»å€ä½“ç°çš„ã€‚</p><h3 id="3-1"><a href="#3-1" class="headerlink" title="3"></a>3</h3><p>ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€ä¹‹é—´å­˜åœ¨ä¸€å®šåç§»offsetï¼Œé€šå¸¸ï¼Œè¿™ä¸ªoffsetï¼Œå°±æ˜¯KERNBASEï¼Œæ˜¯ç”±æ“ä½œç³»ç»Ÿå†³å®šçš„ï¼Œè€Œucoreä¸­ï¼Œå®šä¹‰åœ¨ï¼ˆkern&#x2F;mm&#x2F;memlayout.hï¼‰ã€‚KERNBASEä¸ºè™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„å†…æ ¸åŸºå€ï¼Œå³åç§»é‡ã€‚å¦‚æœæƒ³è¦è®©è™šæ‹Ÿåœ°å€ä¸ç‰©ç†åœ°å€ç›¸ç­‰ï¼Œå°±éœ€è¦ä¿®æ”¹åç§»å€¼ä¸º0ã€‚</p><p>ä¿®æ”¹ä½ç½®å¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://pics.kahvia.cn/img/image-20221113195348463.png" alt="image-20221113195348463"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç»ƒä¹ 0&quot;&gt;&lt;a href=&quot;#ç»ƒä¹ 0&quot; class=&quot;headerlink&quot; title=&quot;ç»ƒä¹ 0&quot;&gt;&lt;/a&gt;ç»ƒä¹ 0&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;ç»ƒä¹ 0ï¼šå¡«å†™å·²æœ‰å®éªŒ&lt;br&gt;æœ¬å®éªŒä¾èµ–å®éªŒ1ã€‚è¯·æŠŠä½ åšçš„å®éªŒ1çš„ä»£ç å¡«å…¥æœ¬å®éªŒä¸­ä»£ç ä¸­æœ‰â€œLAB1â€çš„æ³¨é‡Š</summary>
      
    
    
    
    <category term="è¯¾ç¨‹å®éªŒ" scheme="https://blog.kahvia.cn/categories/%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C/"/>
    
    
    <category term="OS" scheme="https://blog.kahvia.cn/tags/OS/"/>
    
  </entry>
  
  <entry>
    <title>OS-Lab1</title>
    <link href="https://blog.kahvia.cn/2022/11/13/OS-lab1.html"/>
    <id>https://blog.kahvia.cn/2022/11/13/OS-lab1.html</id>
    <published>2022-11-13T11:57:16.199Z</published>
    <updated>2022-11-13T12:01:06.474Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç»ƒä¹ 1"><a href="#ç»ƒä¹ 1" class="headerlink" title="ç»ƒä¹ 1"></a>ç»ƒä¹ 1</h2><blockquote><p>ç»ƒä¹ 1ï¼šç†è§£é€šè¿‡makeç”Ÿæˆæ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ã€‚ï¼ˆè¦æ±‚åœ¨æŠ¥å‘Šä¸­å†™å‡ºå¯¹ä¸‹è¿°é—®é¢˜çš„å›ç­”ï¼‰<br>åˆ—å‡ºæœ¬å®éªŒå„ç»ƒä¹ ä¸­å¯¹åº”çš„OSåŸç†çš„çŸ¥è¯†ç‚¹ï¼Œå¹¶è¯´æ˜æœ¬å®éªŒä¸­çš„å®ç°éƒ¨åˆ†å¦‚ä½•å¯¹åº”å’Œä½“ç°äº†åŸç†ä¸­çš„åŸºæœ¬æ¦‚å¿µå’Œå…³é”®çŸ¥è¯†ç‚¹ã€‚<br>åœ¨æ­¤ç»ƒä¹ ä¸­ï¼Œå¤§å®¶éœ€è¦é€šè¿‡é™æ€åˆ†æä»£ç æ¥äº†è§£ï¼š</p><p>1.æ“ä½œç³»ç»Ÿé•œåƒæ–‡ä»¶ucore.imgæ˜¯å¦‚ä½•ä¸€æ­¥ä¸€æ­¥ç”Ÿæˆçš„ï¼Ÿ(éœ€è¦æ¯”è¾ƒè¯¦ç»†åœ°è§£é‡ŠMakefileä¸­æ¯ä¸€æ¡ç›¸å…³å‘½ä»¤å’Œå‘½ä»¤å‚æ•°çš„å«ä¹‰ï¼Œä»¥åŠè¯´æ˜å‘½ä»¤å¯¼è‡´çš„ç»“æœ)</p><p>2.ä¸€ä¸ªè¢«ç³»ç»Ÿè®¤ä¸ºæ˜¯ç¬¦åˆè§„èŒƒçš„ç¡¬ç›˜ä¸»å¼•å¯¼æ‰‡åŒºçš„ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ </p></blockquote><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><p>è¾“å…¥make â€œV&#x3D;â€ å¾—åˆ°è¯¦ç»†çš„makeè¿‡ç¨‹å¦‚ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">[~/moocos/ucore_lab/labcodes/lab1]</span><br><span class="line">moocos-&gt; make <span class="string">&quot;V=&quot;</span></span><br><span class="line">+ cc kern/init/init.c</span><br><span class="line">gcc -Ikern/init/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/init/init.c -o obj/kern/init/init.o</span><br><span class="line">kern/init/init.c:95:1: warning: â€˜lab1_switch_testâ€™ defined but not used [-Wunused-<span class="keyword">function</span>]</span><br><span class="line"> lab1_switch_test(void) &#123;</span><br><span class="line"> ^</span><br><span class="line">+ cc kern/libs/readline.c</span><br><span class="line">gcc -Ikern/libs/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/libs/readline.c -o obj/kern/libs/readline.o</span><br><span class="line">+ cc kern/libs/stdio.c</span><br><span class="line">gcc -Ikern/libs/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/libs/stdio.c -o obj/kern/libs/stdio.o</span><br><span class="line">+ cc kern/debug/kdebug.c</span><br><span class="line">gcc -Ikern/debug/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/debug/kdebug.c -o obj/kern/debug/kdebug.o</span><br><span class="line">kern/debug/kdebug.c:251:1: warning: â€˜read_eipâ€™ defined but not used [-Wunused-<span class="keyword">function</span>]</span><br><span class="line"> read_eip(void) &#123;</span><br><span class="line"> ^</span><br><span class="line">+ cc kern/debug/kmonitor.c</span><br><span class="line">gcc -Ikern/debug/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/debug/kmonitor.c -o obj/kern/debug/kmonitor.o</span><br><span class="line">+ cc kern/debug/panic.c</span><br><span class="line">gcc -Ikern/debug/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/debug/panic.c -o obj/kern/debug/panic.o</span><br><span class="line">+ cc kern/driver/clock.c</span><br><span class="line">gcc -Ikern/driver/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/driver/clock.c -o obj/kern/driver/clock.o</span><br><span class="line">+ cc kern/driver/console.c</span><br><span class="line">gcc -Ikern/driver/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/driver/console.c -o obj/kern/driver/console.o</span><br><span class="line">+ cc kern/driver/intr.c</span><br><span class="line">gcc -Ikern/driver/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/driver/intr.c -o obj/kern/driver/intr.o</span><br><span class="line">+ cc kern/driver/picirq.c</span><br><span class="line">gcc -Ikern/driver/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/driver/picirq.c -o obj/kern/driver/picirq.o</span><br><span class="line">+ cc kern/trap/trap.c</span><br><span class="line">gcc -Ikern/trap/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/trap/trap.c -o obj/kern/trap/trap.o</span><br><span class="line">kern/trap/trap.c:14:13: warning: â€˜print_ticksâ€™ defined but not used [-Wunused-<span class="keyword">function</span>]</span><br><span class="line"> static void <span class="function"><span class="title">print_ticks</span></span>() &#123;</span><br><span class="line">             ^</span><br><span class="line">kern/trap/trap.c:30:26: warning: â€˜idt_pdâ€™ defined but not used [-Wunused-variable]</span><br><span class="line"> static struct pseudodesc idt_pd = &#123;</span><br><span class="line">                          ^</span><br><span class="line">+ cc kern/trap/trapentry.S</span><br><span class="line">gcc -Ikern/trap/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/trap/trapentry.S -o obj/kern/trap/trapentry.o</span><br><span class="line">+ cc kern/trap/vectors.S</span><br><span class="line">gcc -Ikern/trap/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/trap/vectors.S -o obj/kern/trap/vectors.o</span><br><span class="line">+ cc kern/mm/pmm.c</span><br><span class="line">gcc -Ikern/mm/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Ikern/debug/ -Ikern/driver/ -Ikern/trap/ -Ikern/mm/ -c kern/mm/pmm.c -o obj/kern/mm/pmm.o</span><br><span class="line">+ cc libs/printfmt.c</span><br><span class="line">gcc -Ilibs/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/  -c libs/printfmt.c -o obj/libs/printfmt.o</span><br><span class="line">+ cc libs/string.c</span><br><span class="line">gcc -Ilibs/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/  -c libs/string.c -o obj/libs/string.o</span><br><span class="line">+ ld bin/kernel</span><br><span class="line">ld -m    elf_i386 -nostdlib -T tools/kernel.ld -o bin/kernel  obj/kern/init/init.o obj/kern/libs/readline.o obj/kern/libs/stdio.o obj/kern/debug/kdebug.o obj/kern/debug/kmonitor.o obj/kern/debug/panic.o obj/kern/driver/clock.o obj/kern/driver/console.o obj/kern/driver/intr.o obj/kern/driver/picirq.o obj/kern/trap/trap.o obj/kern/trap/trapentry.o obj/kern/trap/vectors.o obj/kern/mm/pmm.o  obj/libs/printfmt.o obj/libs/string.o</span><br><span class="line">+ cc boot/bootasm.S</span><br><span class="line">gcc -Iboot/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Os -nostdinc -c boot/bootasm.S -o obj/boot/bootasm.o</span><br><span class="line">+ cc boot/bootmain.c</span><br><span class="line">gcc -Iboot/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Os -nostdinc -c boot/bootmain.c -o obj/boot/bootmain.o</span><br><span class="line">+ cc tools/sign.c</span><br><span class="line">gcc -Itools/ -g -Wall -O2 -c tools/sign.c -o obj/sign/tools/sign.o</span><br><span class="line">gcc -g -Wall -O2 obj/sign/tools/sign.o -o bin/sign</span><br><span class="line">+ ld bin/bootblock</span><br><span class="line">ld -m    elf_i386 -nostdlib -N -e start -Ttext 0x7C00 obj/boot/bootasm.o obj/boot/bootmain.o -o obj/bootblock.o</span><br><span class="line"><span class="string">&#x27;obj/bootblock.out&#x27;</span> size: 472 bytes</span><br><span class="line">build 512 bytes boot sector: <span class="string">&#x27;bin/bootblock&#x27;</span> success!</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=bin/ucore.img count=10000</span><br><span class="line">10000+0 records <span class="keyword">in</span></span><br><span class="line">10000+0 records out</span><br><span class="line">5120000 bytes (5.1 MB) copied, 0.0484045 s, 106 MB/s</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=bin/bootblock of=bin/ucore.img conv=notrunc</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">512 bytes (512 B) copied, 0.000105295 s, 4.9 MB/s</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=bin/kernel of=bin/ucore.img seek=1 conv=notrunc</span><br><span class="line">138+1 records <span class="keyword">in</span></span><br><span class="line">138+1 records out</span><br><span class="line">70775 bytes (71 kB) copied, 0.00033329 s, 212 MB/s</span><br><span class="line">[~/moocos/ucore_lab/labcodes/lab1]</span><br><span class="line">moocos-&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€äº›ä¸gccæœ‰å…³çš„å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c xxxx.c -o xxxx.o</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯å°†æŸä¸ª c æ–‡ä»¶ç»è¿‡ é¢„å¤„ç†(-E)ã€æ±‡ç¼–(-S)ã€ç¼–è¯‘(-c) åï¼Œå°†å¾—åˆ°çš„ç»“æœè¾“å‡ºåˆ°ç›®æ ‡æ–‡ä»¶ï¼Œå³.oåç¼€çš„æ–‡ä»¶ã€‚</p><p>è¿˜æœ‰ldå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ld -o [target]  [<span class="built_in">source</span>]</span><br></pre></td></tr></table></figure><p>å°† source å¯¹åº”çš„æºæ–‡ä»¶ä½œè¿æ¥å¤„ç†ï¼Œå¾—åˆ°æœ€ç»ˆçš„æ–‡ä»¶ã€‚</p><p>makeè®°å½•ä¸­å¯¹åº”çš„ç›®æ ‡å‘½ä»¤å¦‚ä¸‹ï¼Œå°†ä¹‹å‰gccç¼–è¯‘å‡ºæ¥çš„ï¼Œä¸€äº›ä»¥.oåç¼€çš„å¯¹è±¡æ–‡ä»¶ï¼Œä½œè¿æ¥å¤„ç†åï¼Œå¾—åˆ°æœ€ç»ˆæ–‡ä»¶ kernel.ldï¼Œå­˜æ”¾åœ¨toolsç›®å½•ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ld -m    elf_i386 -nostdlib -T tools/kernel.ld -o bin/kernel  obj/kern/init/init.o obj/kern/libs/readline.o obj/kern/libs/stdio.o obj/kern/debug/kdebug.o obj/kern/debug/kmonitor.o obj/kern/debug/panic.o obj/kern/driver/clock.o obj/kern/driver/console.o obj/kern/driver/intr.o obj/kern/driver/picirq.o obj/kern/trap/trap.o obj/kern/trap/trapentry.o obj/kern/trap/vectors.o obj/kern/mm/pmm.o  obj/libs/printfmt.o obj/libs/string.o</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒéƒ¨åˆ†çš„ç¼–è¯‘å’Œè¿æ¥è¿‡ç¨‹æ›´çŸ­ï¼Œå¯ä»¥çœ‹å¾—æ›´ç›´è§‚ã€‚ç¼–è¯‘å¾—åˆ°bootasm.oå’Œbootmain.oï¼Œå†é€šè¿‡ldå‘½ä»¤è¿æ¥ï¼Œå¾—åˆ°objç›®å½•ä¸‹çš„bootblock.oæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ cc boot/bootasm.S</span><br><span class="line">gcc -Iboot/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Os -nostdinc -c boot/bootasm.S -o obj/boot/bootasm.o</span><br><span class="line">+ cc boot/bootmain.c</span><br><span class="line">gcc -Iboot/ -fno-builtin -Wall -ggdb -m32 -gstabs -nostdinc  -fno-stack-protector -Ilibs/ -Os -nostdinc -c boot/bootmain.c -o obj/boot/bootmain.o</span><br><span class="line">+ cc tools/sign.c</span><br><span class="line">gcc -Itools/ -g -Wall -O2 -c tools/sign.c -o obj/sign/tools/sign.o</span><br><span class="line">gcc -g -Wall -O2 obj/sign/tools/sign.o -o bin/sign</span><br><span class="line">+ ld bin/bootblock</span><br><span class="line">ld -m    elf_i386 -nostdlib -N -e start -Ttext 0x7C00 obj/boot/bootasm.o obj/boot/bootmain.o -o obj/bootblock.o</span><br><span class="line"><span class="string">&#x27;obj/bootblock.out&#x27;</span> size: 472 bytes</span><br></pre></td></tr></table></figure><p><img src="https://pics.kahvia.cn/img/image-20221112141937226.png" alt="bootblock.o"></p><p>æœ€ååˆ™æ˜¯ dd å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=xxx of=yyy count=number</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼äºæ‹·è´ï¼Œif æŒ‡å®šè¾“å…¥æ–‡ä»¶ï¼Œ of æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œ count æŒ‡å®šæ‹·è´çš„çš„å—æ•°ã€‚</p><p>makeè¿‡ç¨‹ä¸­å¯¹åº”çš„ä»£ç å—å¦‚ä¸‹ã€‚conv&#x3D;notruncæŒ‡çš„æ˜¯â€œä¸æˆªçŸ­è¾“å‡ºæ–‡ä»¶â€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=bin/ucore.img count=10000</span><br><span class="line">10000+0 records <span class="keyword">in</span></span><br><span class="line">10000+0 records out</span><br><span class="line">5120000 bytes (5.1 MB) copied, 0.0484045 s, 106 MB/s</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=bin/bootblock of=bin/ucore.img conv=notrunc</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">512 bytes (512 B) copied, 0.000105295 s, 4.9 MB/s</span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=bin/kernel of=bin/ucore.img seek=1 conv=notrunc</span><br><span class="line">138+1 records <span class="keyword">in</span></span><br><span class="line">138+1 records out</span><br><span class="line">70775 bytes (71 kB) copied, 0.00033329 s, 212 MB/s</span><br></pre></td></tr></table></figure><p>å…·ä½“æ‹·è´çš„æµç¨‹æˆ‘ç»“åˆæŒ‡ä»¤è¯¦è§£ä¹Ÿä¸æ˜¯å¾ˆæ˜ç™½ã€‚</p><h4 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h4><p>makeç”Ÿæˆ ucore.img å¤§æ¦‚æœ‰ä¸‰æ­¥ï¼Œåˆ†åˆ«ä¾èµ–æŒ‡ä»¤ gcc, ld, ddã€‚</p><p>gccå‘½ä»¤è´Ÿè´£ç¼–è¯‘æºæ–‡ä»¶ï¼Œldå‘½ä»¤è´Ÿè´£è¿æ¥gccå¾—åˆ°çš„ç›®æ ‡æ–‡ä»¶ï¼Œddå‘½ä»¤è´Ÿè´£æ‹·è´ç›®æ ‡æ–‡ä»¶åˆ°æŒ‡å®šçš„ä½ç½®ã€‚è€Œdd å‘½ä»¤å®Œæˆåå¾—åˆ°çš„æœ€ç»ˆæ–‡ä»¶ï¼Œå°±æ˜¯ ucore.img </p><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>å¼•å¯¼æ‰‡åŒºçš„å¤§å°ä¸º512å­—èŠ‚ã€‚</p><h2 id="ç»ƒä¹ 2"><a href="#ç»ƒä¹ 2" class="headerlink" title="ç»ƒä¹ 2"></a>ç»ƒä¹ 2</h2><blockquote><p>ç»ƒä¹ 2ï¼šä½¿ç”¨qemuæ‰§è¡Œå¹¶è°ƒè¯•lab1ä¸­çš„è½¯ä»¶ã€‚ï¼ˆè¦æ±‚åœ¨æŠ¥å‘Šä¸­ç®€è¦å†™å‡ºç»ƒä¹ è¿‡ç¨‹ï¼‰<br>ä¸ºäº†ç†Ÿæ‚‰ä½¿ç”¨qemuå’Œgdbè¿›è¡Œçš„è°ƒè¯•å·¥ä½œï¼Œæˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹çš„å°ç»ƒä¹ ï¼š<br>1.ä»CPUåŠ ç”µåæ‰§è¡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤å¼€å§‹ï¼Œå•æ­¥è·Ÿè¸ªBIOSçš„æ‰§è¡Œã€‚<br>2.åœ¨åˆå§‹åŒ–ä½ç½®0x7c00è®¾ç½®å®åœ°å€æ–­ç‚¹,æµ‹è¯•æ–­ç‚¹æ­£å¸¸ã€‚<br>3.ä»0x7c00å¼€å§‹è·Ÿè¸ªä»£ç è¿è¡Œ,å°†å•æ­¥è·Ÿè¸ªåæ±‡ç¼–å¾—åˆ°çš„ä»£ç ä¸bootasm.Så’Œbootblock.asmè¿›è¡Œæ¯”è¾ƒã€‚<br>4.è‡ªå·±æ‰¾ä¸€ä¸ªbootloaderæˆ–å†…æ ¸ä¸­çš„ä»£ç ä½ç½®ï¼Œè®¾ç½®æ–­ç‚¹å¹¶è¿›è¡Œæµ‹è¯•ã€‚</p></blockquote><h3 id="1-1"><a href="#1-1" class="headerlink" title="1"></a>1</h3><p>åœ¨lab1ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ make -debugï¼Œè¿›å…¥è°ƒè¯•ç•Œé¢ï¼Œè¾“å…¥siè¿›è¡Œå•æ­¥è·Ÿè¸ªï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://pics.kahvia.cn/img/image-20221112153930312.png" alt="image-20221112153930312"></p><h3 id="2-1"><a href="#2-1" class="headerlink" title="2"></a>2</h3><p>è®¾ç½®å®åœ°å€æ–­ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set architecture i8086</span><br><span class="line">target remote :1234</span><br><span class="line">b *0x7c00</span><br><span class="line">c</span><br><span class="line">x/2i $pc</span><br></pre></td></tr></table></figure><p>å†æ¬¡ä½¿ç”¨make -debug,æµ‹è¯•æ–­ç‚¹æ­£å¸¸</p><p><img src="https://pics.kahvia.cn/img/image-20221112154421915.png" alt="image-20221112154421915"></p><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><p>å°†makefile çš„ç¬¬218è¡Œèµ·çš„ä»£ç ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç </p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">debug: <span class="variable">$(UCOREIMG)</span></span></span><br><span class="line"><span class="variable">$(V)</span><span class="variable">$(TERMINAL)</span> -e <span class="string">&quot;<span class="variable">$(QEMU)</span> -S -s -d in_asm -D <span class="variable">$(BINDIR)</span>/q.log -parallel stdio -hda <span class="variable">$&lt;</span> -serial null&quot;</span></span><br><span class="line"><span class="variable">$(V)</span>sleep 2</span><br><span class="line"><span class="variable">$(V)</span><span class="variable">$(TERMINAL)</span> -e <span class="string">&quot;gdb -q -tui -x tools/gdbinit&quot;</span></span><br></pre></td></tr></table></figure><p>make -debug åäº§ç”Ÿ q.log æ–‡ä»¶ã€‚é€šè¿‡æŸ¥æ‰¾æ–­ç‚¹åœ°å€å¾—å¦‚ä¸‹ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IN: </span><br><span class="line">0x00007c00:  cli    </span><br><span class="line">0x00007c01:  cld    </span><br><span class="line">0x00007c02:  xor    %ax,%ax</span><br><span class="line">0x00007c04:  mov    %ax,%ds</span><br><span class="line">0x00007c06:  mov    %ax,%es</span><br><span class="line">0x00007c08:  mov    %ax,%ss</span><br></pre></td></tr></table></figure><p>è€Œ bootasm.S æ–‡ä»¶ä¸­ï¼Œå¦‚æ­¤æ˜¾ç¤ºã€‚</p><p><img src="https://pics.kahvia.cn/img/image-20221112155556494.png" alt="image-20221112155556494"></p><p>bootblock.asm æ–‡ä»¶ä¸­å¦‚æ­¤æ˜¾ç¤ºã€‚</p><p><img src="https://pics.kahvia.cn/img/image-20221112155733053.png" alt="image-20221112155733053"></p><p>é€šè¿‡æ¯”è¾ƒå¾—çŸ¥ï¼Œå„æ–‡ä»¶ä¸­ï¼ŒæŒ‡ä»¤å·®åˆ«ä¸å¤§ã€‚</p><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><p>è®¾ç½®æ–°æ–­ç‚¹ä¸º 0x7c16</p><p>make -debug å¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="https://pics.kahvia.cn/img/image-20221112160237581.png" alt="image-20221112160237581"></p><p>æ­¤æ—¶æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ä¸º test å’Œ jne</p><h2 id="ç»ƒä¹ 3"><a href="#ç»ƒä¹ 3" class="headerlink" title="ç»ƒä¹ 3"></a>ç»ƒä¹ 3</h2><blockquote><p>ç»ƒä¹ 3ï¼šåˆ†æbootloaderè¿›å…¥ä¿æŠ¤æ¨¡å¼çš„è¿‡ç¨‹ã€‚ï¼ˆè¦æ±‚åœ¨æŠ¥å‘Šä¸­å†™å‡ºåˆ†æï¼‰<br>BIOSå°†é€šè¿‡è¯»å–ç¡¬ç›˜ä¸»å¼•å¯¼æ‰‡åŒºåˆ°å†…å­˜ï¼Œå¹¶è½¬è·³åˆ°å¯¹åº”å†…å­˜ä¸­çš„ä½ç½®æ‰§è¡Œbootloaderã€‚è¯·åˆ†æbootloaderæ˜¯å¦‚ä½•å®Œæˆä»å®æ¨¡å¼è¿›å…¥ä¿æŠ¤æ¨¡å¼çš„ã€‚</p></blockquote><h3 id="1-å¼€å¯A20é—¨"><a href="#1-å¼€å¯A20é—¨" class="headerlink" title="1.å¼€å¯A20é—¨"></a>1.å¼€å¯A20é—¨</h3><p>åœ¨ bootasm.S æ–‡ä»¶ä¸­ï¼Œæœ‰è¿™æ ·çš„ä»£ç </p><p><img src="https://pics.kahvia.cn/img/image-20221112162346236.png" alt="image-20221112162346236"></p><p>å…¶ä¸­seta20.1æ˜¯å¾€ç«¯å£0x64å†™æ•°æ®0xd1ï¼Œå‘Šè¯‰CPUæˆ‘è¦å¾€8042èŠ¯ç‰‡çš„P2ç«¯å£å†™æ•°æ®ï¼›seta20.2æ˜¯å¾€ç«¯å£0x60å†™æ•°æ®0xdfï¼Œä»è€Œå°†8042èŠ¯ç‰‡çš„P2ç«¯å£è®¾ç½®ä¸º1. ä¸¤æ®µä»£ç éƒ½éœ€è¦å…ˆè¯»0x64ç«¯å£çš„ç¬¬2ä½ï¼Œç¡®ä¿è¾“å…¥ç¼“å†²åŒºä¸ºç©ºåå†è¿›è¡Œåç»­å†™æ“ä½œã€‚</p><h3 id="2-åˆå§‹åŒ–GDTè¡¨"><a href="#2-åˆå§‹åŒ–GDTè¡¨" class="headerlink" title="2.åˆå§‹åŒ–GDTè¡¨"></a>2.åˆå§‹åŒ–GDTè¡¨</h3><p>åŒæ ·åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p><p><img src="https://pics.kahvia.cn/img/image-20221112162738325.png" alt="image-20221112162738325"></p><h3 id="3-è¿›å…¥ä¿æŠ¤æ¨¡å¼"><a href="#3-è¿›å…¥ä¿æŠ¤æ¨¡å¼" class="headerlink" title="3.è¿›å…¥ä¿æŠ¤æ¨¡å¼"></a>3.è¿›å…¥ä¿æŠ¤æ¨¡å¼</h3><p>å°†cr0å¯„å­˜å™¨çš„PEä½ï¼ˆcr0å¯„å­˜å™¨çš„æœ€ä½ä½ï¼‰è®¾ç½®ä¸º1ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movl %cr0, %eax</span><br><span class="line">orl $CR0_PE_ON, %eax</span><br><span class="line">movl %eax, %cr0</span><br></pre></td></tr></table></figure><h2 id="ç»ƒä¹ 4"><a href="#ç»ƒä¹ 4" class="headerlink" title="ç»ƒä¹ 4"></a>ç»ƒä¹ 4</h2><blockquote><p>ç»ƒä¹ 4ï¼šåˆ†æbootloaderåŠ è½½ELFæ ¼å¼çš„OSçš„è¿‡ç¨‹ã€‚ï¼ˆè¦æ±‚åœ¨æŠ¥å‘Šä¸­å†™å‡ºåˆ†æï¼‰<br>é€šè¿‡é˜…è¯»bootmain.cï¼Œäº†è§£bootloaderå¦‚ä½•åŠ è½½ELFæ–‡ä»¶ã€‚é€šè¿‡åˆ†ææºä»£ç å’Œé€šè¿‡qemuæ¥è¿è¡Œå¹¶è°ƒè¯•bootloader&amp;OSï¼Œ<br>1.bootloaderå¦‚ä½•è¯»å–ç¡¬ç›˜æ‰‡åŒºçš„ï¼Ÿ<br>2.bootloaderæ˜¯å¦‚ä½•åŠ è½½ELFæ ¼å¼çš„OSï¼Ÿ</p></blockquote><h3 id="1-2"><a href="#1-2" class="headerlink" title="1"></a>1</h3><p>åœ¨bootç›®å½•ä¸‹çš„ bootmain.c æ–‡ä»¶ä¸­ï¼Œè¯»å–æ‰‡åŒºçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* readsect - read a single sector at @secno into @dst */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span></span><br><span class="line"><span class="title function_">readsect</span><span class="params">(<span class="type">void</span> *dst, <span class="type">uint32_t</span> secno)</span> &#123;</span><br><span class="line">    <span class="comment">// wait for disk to be ready</span></span><br><span class="line">    waitdisk();</span><br><span class="line"></span><br><span class="line">    outb(<span class="number">0x1F2</span>, <span class="number">1</span>);                         <span class="comment">// count = 1</span></span><br><span class="line">    outb(<span class="number">0x1F3</span>, secno &amp; <span class="number">0xFF</span>);</span><br><span class="line">    outb(<span class="number">0x1F4</span>, (secno &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>);</span><br><span class="line">    outb(<span class="number">0x1F5</span>, (secno &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>);</span><br><span class="line">    outb(<span class="number">0x1F6</span>, ((secno &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xF</span>) | <span class="number">0xE0</span>);</span><br><span class="line">    outb(<span class="number">0x1F7</span>, <span class="number">0x20</span>);                      <span class="comment">// cmd 0x20 - read sectors</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// wait for disk to be ready</span></span><br><span class="line">    waitdisk();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// read a sector</span></span><br><span class="line">    insl(<span class="number">0x1F0</span>, dst, SECTSIZE / <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ç­‰å¾…ç£ç›˜å°±ç»ª</li><li>å‘å‡ºæŒ‡ä»¤</li><li>ç­‰å¾…ç£ç›˜å°±ç»ª</li><li>è¯»å–æ‰‡åŒº</li></ul><h3 id="2-2"><a href="#2-2" class="headerlink" title="2"></a>2</h3><p>åŠ è½½ELFæ ¼å¼çš„OSçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* bootmain - the entry of bootloader */</span></span><br><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">bootmain</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// read the 1st page off disk</span></span><br><span class="line">    readseg((<span class="type">uintptr_t</span>)ELFHDR, SECTSIZE * <span class="number">8</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// is this a valid ELF?</span></span><br><span class="line">    <span class="keyword">if</span> (ELFHDR-&gt;e_magic != ELF_MAGIC) &#123;</span><br><span class="line">        <span class="keyword">goto</span> bad;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">proghdr</span> *<span class="title">ph</span>, *<span class="title">eph</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// load each program segment (ignores ph flags)</span></span><br><span class="line">    ph = (<span class="keyword">struct</span> proghdr *)((<span class="type">uintptr_t</span>)ELFHDR + ELFHDR-&gt;e_phoff);</span><br><span class="line">    eph = ph + ELFHDR-&gt;e_phnum;</span><br><span class="line">    <span class="keyword">for</span> (; ph &lt; eph; ph ++) &#123;</span><br><span class="line">        readseg(ph-&gt;p_va &amp; <span class="number">0xFFFFFF</span>, ph-&gt;p_memsz, ph-&gt;p_offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// call the entry point from the ELF header</span></span><br><span class="line">    <span class="comment">// note: does not return</span></span><br><span class="line">    ((<span class="type">void</span> (*)(<span class="type">void</span>))(ELFHDR-&gt;e_entry &amp; <span class="number">0xFFFFFF</span>))();</span><br><span class="line"></span><br><span class="line">bad:</span><br><span class="line">    outw(<span class="number">0x8A00</span>, <span class="number">0x8A00</span>);</span><br><span class="line">    outw(<span class="number">0x8A00</span>, <span class="number">0x8E00</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* do nothing */</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ä»ç£ç›˜è¯»å–ç¬¬ä¸€é¡µ</li><li>åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•çš„ELF</li><li>åŠ è½½æ¯ä¸€ä¸ªæ‰‡åŒº</li><li>ä»ELFå¤´éƒ¨è°ƒç”¨å…¥å£å‡½æ•°</li></ul><h2 id="ç»ƒä¹ 5"><a href="#ç»ƒä¹ 5" class="headerlink" title="ç»ƒä¹ 5"></a>ç»ƒä¹ 5</h2><blockquote><p>ç»ƒä¹ 5ï¼šå®ç°å‡½æ•°è°ƒç”¨å †æ ˆè·Ÿè¸ªå‡½æ•° ï¼ˆéœ€è¦ç¼–ç¨‹ï¼‰<br>æˆ‘ä»¬éœ€è¦åœ¨lab1ä¸­å®Œæˆkdebug.cä¸­å‡½æ•°print_stackframeçš„å®ç°ï¼Œå¯ä»¥é€šè¿‡å‡½æ•°print_stackframeæ¥è·Ÿè¸ªå‡½æ•°è°ƒç”¨å †æ ˆä¸­è®°å½•çš„è¿”å›åœ°å€ã€‚åœ¨å¦‚æœèƒ½å¤Ÿæ­£ç¡®å®ç°æ­¤å‡½æ•°ï¼Œå¯åœ¨lab1ä¸­æ‰§è¡Œ â€œmake qemuâ€åï¼Œåœ¨qemuæ¨¡æ‹Ÿå™¨ä¸­å¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼š<br>â€¦â€¦<br>ebp:0x00007b28 eip:0x00100992 args:0x00010094 0x00010094 0x00007b58 0x00100096<br>kern&#x2F;debug&#x2F;kdebug.c:305: print_stackframe+22<br>ebp:0x00007b38 eip:0x00100c79 args:0x00000000 0x00000000 0x00000000 0x00007ba8<br>kern&#x2F;debug&#x2F;kmonitor.c:125: mon_backtrace+10<br>ebp:0x00007b58 eip:0x00100096 args:0x00000000 0x00007b80 0xffff0000 0x00007b84<br>kern&#x2F;init&#x2F;init.c:48: grade_backtrace2+33<br>ebp:0x00007b78 eip:0x001000bf args:0x00000000 0xffff0000 0x00007ba4 0x00000029<br>kern&#x2F;init&#x2F;init.c:53: grade_backtrace1+38<br>ebp:0x00007b98 eip:0x001000dd args:0x00000000 0x00100000 0xffff0000 0x0000001d<br>kern&#x2F;init&#x2F;init.c:58: grade_backtrace0+23<br>ebp:0x00007bb8 eip:0x00100102 args:0x0010353c 0x00103520 0x00001308 0x00000000<br>kern&#x2F;init&#x2F;init.c:63: grade_backtrace+34<br>ebp:0x00007be8 eip:0x00100059 args:0x00000000 0x00000000 0x00000000 0x00007c53<br>kern&#x2F;init&#x2F;init.c:28: kern_init+88<br>ebp:0x00007bf8 eip:0x00007d73 args:0xc031fcfa 0xc08ed88e 0x64e4d08e 0xfa7502a8<br><unknow>: â€“ 0x00007d72 â€“<br>â€¦â€¦<br>è¯·å®Œæˆå®éªŒï¼Œçœ‹çœ‹è¾“å‡ºæ˜¯å¦ä¸ä¸Šè¿°æ˜¾ç¤ºå¤§è‡´ä¸€è‡´ï¼Œå¹¶è§£é‡Šæœ€åä¸€è¡Œå„ä¸ªæ•°å€¼çš„å«ä¹‰ã€‚</p></blockquote><p>å®ç°å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">print_stackframe(<span class="type">void</span>) &#123;</span><br><span class="line">    <span class="type">uint32_t</span> *ebp = (<span class="type">uint32_t</span> *)read_ebp();</span><br><span class="line">    <span class="type">uint32_t</span> eip = read_eip();</span><br><span class="line">    <span class="keyword">while</span> (ebp)</span><br><span class="line">    &#123;</span><br><span class="line">        cprintf(<span class="string">&quot;ebp:0x%08x eip:0x%08x args:&quot;</span>, (<span class="type">uint32_t</span>)ebp, eip);</span><br><span class="line">        cprintf(<span class="string">&quot;0x%08x 0x%08x 0x%08x 0x%08x\n&quot;</span>, ebp[<span class="number">2</span>], ebp[<span class="number">3</span>], ebp[<span class="number">4</span>], ebp[<span class="number">5</span>]);</span><br><span class="line">        print_debuginfo(eip - <span class="number">1</span>);</span><br><span class="line">        eip = ebp[<span class="number">1</span>];</span><br><span class="line">        ebp = (<span class="type">uint32_t</span> *)*ebp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œmake qemuï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤º</p><p><img src="https://pics.kahvia.cn/img/image-20221112164802166.png" alt="image-20221112164802166"></p><ul><li>ebpï¼šebpçš„å€¼æ˜¯kern_initå‡½æ•°çš„æ ˆé¡¶åœ°å€ã€‚</li><li>eipï¼šeipçš„å€¼æ˜¯kern_initå‡½æ•°çš„è¿”å›åœ°å€ï¼Œä¹Ÿå°±æ˜¯bootmainå‡½æ•°è°ƒç”¨kern_initå¯¹åº”çš„æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</li><li>argsï¼šå­˜æ”¾çš„æ˜¯boot loaderæŒ‡ä»¤çš„å‰16ä¸ªå­—èŠ‚ã€‚</li></ul><h2 id="ç»ƒä¹ 6"><a href="#ç»ƒä¹ 6" class="headerlink" title="ç»ƒä¹ 6"></a>ç»ƒä¹ 6</h2><blockquote><p>ç»ƒä¹ 6ï¼šå®Œå–„ä¸­æ–­åˆå§‹åŒ–å’Œå¤„ç† ï¼ˆéœ€è¦ç¼–ç¨‹ï¼‰<br>è¯·å®Œæˆç¼–ç å·¥ä½œå’Œå›ç­”å¦‚ä¸‹é—®é¢˜ï¼š<br>1.ä¸­æ–­æè¿°ç¬¦è¡¨ï¼ˆä¹Ÿå¯ç®€ç§°ä¸ºä¿æŠ¤æ¨¡å¼ä¸‹çš„ä¸­æ–­å‘é‡è¡¨ï¼‰ä¸­ä¸€ä¸ªè¡¨é¡¹å å¤šå°‘å­—èŠ‚ï¼Ÿå…¶ä¸­å“ªå‡ ä½ä»£è¡¨ä¸­æ–­å¤„ç†ä»£ç çš„å…¥å£ï¼Ÿ<br>2.è¯·ç¼–ç¨‹å®Œå–„kern&#x2F;trap&#x2F;trap.cä¸­å¯¹ä¸­æ–­å‘é‡è¡¨è¿›è¡Œåˆå§‹åŒ–çš„å‡½æ•°idt_initã€‚åœ¨idt_initå‡½æ•°ä¸­ï¼Œä¾æ¬¡å¯¹æ‰€æœ‰ä¸­æ–­å…¥å£è¿›è¡Œåˆå§‹åŒ–ã€‚ä½¿ç”¨mmu.hä¸­çš„SETGATEå®ï¼Œå¡«å……idtæ•°ç»„å†…å®¹ã€‚æ¯ä¸ªä¸­æ–­çš„å…¥å£ç”±tools&#x2F;vectors.cç”Ÿæˆï¼Œä½¿ç”¨trap.cä¸­å£°æ˜çš„vectorsæ•°ç»„å³å¯ã€‚<br>3.è¯·ç¼–ç¨‹å®Œå–„trap.cä¸­çš„ä¸­æ–­å¤„ç†å‡½æ•°trapï¼Œåœ¨å¯¹æ—¶é’Ÿä¸­æ–­è¿›è¡Œå¤„ç†çš„éƒ¨åˆ†å¡«å†™trapå‡½æ•°ä¸­å¤„ç†æ—¶é’Ÿä¸­æ–­çš„éƒ¨åˆ†ï¼Œä½¿æ“ä½œç³»ç»Ÿæ¯é‡åˆ°100æ¬¡æ—¶é’Ÿä¸­æ–­åï¼Œè°ƒç”¨print_tickså­ç¨‹åºï¼Œå‘å±å¹•ä¸Šæ‰“å°ä¸€è¡Œæ–‡å­—â€100 ticksâ€ã€‚</p></blockquote><h4 id="1-3"><a href="#1-3" class="headerlink" title="1"></a>1</h4><p>ä¸­æ–­æè¿°ç¬¦è¡¨ä¸€ä¸ªè¡¨é¡¹å 8ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­2-3å­—èŠ‚æ˜¯æ®µé€‰æ‹©å­ï¼Œ0-1å­—èŠ‚å’Œ6-7å­—èŠ‚æ‹¼æˆåç§»é‡ï¼Œå³ç¬¬16~ 32ä½æ˜¯æ®µé€‰æ‹©å­ï¼Œç¬¬0~ 15ã€48~63ä½æ„æˆçš„åç§»åœ°å€ï¼Œé€šè¿‡æ®µé€‰æ‹©å­å»GDTä¸­æ‰¾åˆ°å¯¹åº”çš„åŸºåœ°å€ï¼Œç„¶ååŸºåœ°å€åŠ ä¸Šåç§»é‡å°±æ˜¯ä¸­æ–­å¤„ç†ç¨‹åºçš„åœ°å€ã€‚</p><h3 id="2-3"><a href="#2-3" class="headerlink" title="2"></a>2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">idt_init</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">     <span class="comment">/* LAB1 YOUR CODE : STEP 2 */</span></span><br><span class="line">     <span class="comment">/* (1) Where are the entry addrs of each Interrupt Service Routine (ISR)?</span></span><br><span class="line"><span class="comment">      *     All ISR&#x27;s entry addrs are stored in __vectors. where is uintptr_t __vectors[] ?</span></span><br><span class="line"><span class="comment">      *     __vectors[] is in kern/trap/vector.S which is produced by tools/vector.c</span></span><br><span class="line"><span class="comment">      *     (try &quot;make&quot; command in lab1, then you will find vector.S in kern/trap DIR)</span></span><br><span class="line"><span class="comment">      *     You can use  &quot;extern uintptr_t __vectors[];&quot; to define this extern variable which will be used later.</span></span><br><span class="line"><span class="comment">      * (2) Now you should setup the entries of ISR in Interrupt Description Table (IDT).</span></span><br><span class="line"><span class="comment">      *     Can you see idt[256] in this file? Yes, it&#x27;s IDT! you can use SETGATE macro to setup each item of IDT</span></span><br><span class="line"><span class="comment">      * (3) After setup the contents of IDT, you will let CPU know where is the IDT by using &#x27;lidt&#x27; instruction.</span></span><br><span class="line"><span class="comment">      *     You don&#x27;t know the meaning of this instruction? just google it! and check the libs/x86.h to know more.</span></span><br><span class="line"><span class="comment">      *     Notice: the argument of lidt is idt_pd. try to find it!</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="keyword">extern</span> <span class="type">uintptr_t</span> __vectors[];</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(idt) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> gatedesc); i ++) &#123;</span><br><span class="line">        SETGATE(idt[i], <span class="number">0</span>, GD_KTEXT, __vectors[i], DPL_KERNEL);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// set for switch from user to kernel</span></span><br><span class="line">    SETGATE(idt[T_SWITCH_TOK], <span class="number">0</span>, GD_KTEXT, __vectors[T_SWITCH_TOK], DPL_USER);</span><br><span class="line"><span class="comment">// load the IDT</span></span><br><span class="line">    lidt(&amp;idt_pd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-1"><a href="#3-1" class="headerlink" title="3"></a>3</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> IRQ_OFFSET + IRQ_TIMER:</span><br><span class="line">        <span class="comment">/* LAB1 YOUR CODE : STEP 3 */</span></span><br><span class="line">        <span class="comment">/* handle the timer interrupt */</span></span><br><span class="line">        <span class="comment">/* (1) After a timer interrupt, you should record this event using a global variable (increase it), such as ticks in kern/driver/clock.c</span></span><br><span class="line"><span class="comment">         * (2) Every TICK_NUM cycle, you can print some info using a funciton, such as print_ticks().</span></span><br><span class="line"><span class="comment">         * (3) Too Simple? Yes, I think so!</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        ticks ++;</span><br><span class="line">        <span class="keyword">if</span> (ticks % TICK_NUM == <span class="number">0</span>) &#123;</span><br><span class="line">            print_ticks();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="https://pics.kahvia.cn/img/image-20221112170446171.png" alt="image-20221112170446171"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç»ƒä¹ 1&quot;&gt;&lt;a href=&quot;#ç»ƒä¹ 1&quot; class=&quot;headerlink&quot; title=&quot;ç»ƒä¹ 1&quot;&gt;&lt;/a&gt;ç»ƒä¹ 1&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;ç»ƒä¹ 1ï¼šç†è§£é€šè¿‡makeç”Ÿæˆæ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ã€‚ï¼ˆè¦æ±‚åœ¨æŠ¥å‘Šä¸­å†™å‡ºå¯¹ä¸‹è¿°é—®é¢˜çš„å›ç­”ï¼‰&lt;br&gt;åˆ—å‡ºæœ¬å®éªŒå„ç»ƒä¹ ä¸­</summary>
      
    
    
    
    <category term="è¯¾ç¨‹å®éªŒ" scheme="https://blog.kahvia.cn/categories/%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C/"/>
    
    
    <category term="OS" scheme="https://blog.kahvia.cn/tags/OS/"/>
    
  </entry>
  
  <entry>
    <title>Android-HttpRequest</title>
    <link href="https://blog.kahvia.cn/2022/10/31/AndroidHttpRequest.html"/>
    <id>https://blog.kahvia.cn/2022/10/31/AndroidHttpRequest.html</id>
    <published>2022-10-31T10:34:42.189Z</published>
    <updated>2022-10-31T11:09:39.431Z</updated>
    
    <content type="html"><![CDATA[<h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><p>æ®åº¦å¨˜è§£é‡Šï¼Œä»¥å‰çš„å®‰å“åº”ç”¨å‘å‡º http è¯·æ±‚åï¼Œå¦‚æœè¯·æ±‚æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šäº§ç”Ÿåº”ç”¨æ— å“åº”çš„çŠ¶æ€ã€‚æ‰€ä»¥æ”¹æˆäº†ç°åœ¨è¿™ç§ï¼Œç›´æ¥å‘å‡º http è¯·æ±‚å°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚æƒ³è¦æ­£ç¡®åœ°å‘å‡ºhttpè¯·æ±‚ï¼Œå°±éœ€è¦å¼€ä¸€ä¸ªå­çº¿ç¨‹æ¥è¿›è¡Œè¿™äº›æ“ä½œã€‚</p><p>ä¸‹æ–¹çš„ä»£ç é‡‡ç”¨çš„æ˜¯ï¼Œç›´æ¥é€šè¿‡ Thread ç±»åˆ›å»ºå­çº¿ç¨‹ï¼Œéœ€è¦ä¼ é€’çš„å‚æ•°æ˜¯ä¸€ä¸ªå®ç°äº† Runnable æ¥å£çš„ç±»çš„å®ä¾‹å¯¹è±¡ã€‚è¿™é‡Œçš„å¯¹è±¡é€šè¿‡åŒ¿åç±»ç”Ÿæˆã€‚çº¿ç¨‹å’ŒåŒ¿åç±»çš„çŸ¥è¯†ï¼Œå¯ä»¥åœ¨ã€ŠJava2 å®ç”¨æ•™ç¨‹ã€‹ï¼ˆä¿—ç§° è¯¾æœ¬ï¼‰ä¸­æ‰¾åˆ°ã€‚</p><p>çº¿ç¨‹çš„å¯åŠ¨ä½¿ç”¨ startï¼ˆï¼‰æ–¹æ³•ã€‚å¯åŠ¨åï¼Œå°±è¿›å…¥ç­‰å¾…cpuä½¿ç”¨æƒçš„é˜Ÿåˆ—ã€‚å¾—åˆ°ä½¿ç”¨æƒå°±å¼€å§‹è¿è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">requestPost</span><span class="params">()</span> <span class="keyword">throws</span> IOException, JSONException &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   <span class="comment">//åˆ›å»ºURLå¯¹è±¡</span></span><br><span class="line">                   URL url=<span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://www.xxx.com/user/check&quot;</span>);</span><br><span class="line">                   <span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">                   HttpURLConnection connection= (HttpURLConnection) url.openConnection();</span><br><span class="line">                   <span class="comment">//è®¾å®šè¯·æ±‚æ–¹å¼</span></span><br><span class="line">                   connection.setRequestMethod(<span class="string">&quot;POST&quot;</span>);</span><br><span class="line">                   <span class="comment">//è®¾ç½®å†…å®¹ç±»å‹ï¼Œè¿™é‡Œæ˜¯jsonæ•°æ®</span></span><br><span class="line">                   connection.setRequestProperty(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">                   <span class="comment">//æœŸæœ›æ¥æ”¶åˆ°çš„è¯·æ±‚è¿”å›å€¼</span></span><br><span class="line">                   connection.setRequestProperty(<span class="string">&quot;Accept&quot;</span>,<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">                   <span class="comment">//å…è®¸é€šè¿‡è¿æ¥å‘å¤–è¾“å‡ºï¼Œå³å‘é€æ•°æ®åˆ°æœåŠ¡å™¨</span></span><br><span class="line">                   connection.setDoOutput(<span class="literal">true</span>);</span><br><span class="line">                   <span class="comment">//å…è®¸é€šè¿‡è¿æ¥å‘å†…è¾“å‡ºï¼Œå³å®‰å“åº”ç”¨æ”¶åˆ°æ•°æ®</span></span><br><span class="line">                   connection.setDoInput(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">                   <span class="comment">//åˆ›å»ºå®ä½“å¯¹è±¡</span></span><br><span class="line">                   User user=<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;914302063&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">                   <span class="comment">//è½¬æ¢ä¸ºJSONObjectå¯¹è±¡ã€‚user.toString()çš„toStringæ–¹æ³•æ˜¯é¢å¤–å®ç°çš„ã€‚</span></span><br><span class="line">                   JSONObject jsonObject=<span class="keyword">new</span> <span class="title class_">JSONObject</span>(user.toString());</span><br><span class="line">                   <span class="comment">//è½¬å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¿—ç§°çš„jsonå­—ç¬¦ä¸²ï¼Œæ˜¯ç›®æ ‡æ•°æ®ã€‚</span></span><br><span class="line">                   String json=jsonObject.toString();</span><br><span class="line">                   Log.i(<span class="string">&quot;JsonData&quot;</span>,json);</span><br><span class="line"></span><br><span class="line">                   <span class="comment">//é€šè¿‡è¿æ¥è·å–è¾“å‡ºæµ</span></span><br><span class="line">                   OutputStream outputStream=connection.getOutputStream();</span><br><span class="line">                   <span class="comment">//æŠŠjsonå­—ç¬¦ä¸²è½¬æ¢æˆå­—ç¬¦æ•°ç»„ï¼Œé€šè¿‡è¾“å‡ºæµè¾“å‡º</span></span><br><span class="line">                   outputStream.write(json.getBytes());</span><br><span class="line">                   <span class="comment">//outputStreamè¾“å‡ºæµç¼“å­˜åŒºæ»¡äº†ä¼šè‡ªåŠ¨è°ƒç”¨flushï¼ˆï¼‰ï¼Œè¾“å‡ºæµå…³é—­å‰ä¹Ÿä¼šè°ƒç”¨ã€‚æ‰€ä»¥è¿™é‡Œå†™ä¸å†™flushéƒ½å¯ã€‚</span></span><br><span class="line">                   outputStream.flush();</span><br><span class="line">                   outputStream.close();</span><br><span class="line">                   Log.i(<span class="string">&quot;responseCode&quot;</span>, String.valueOf(connection.getResponseCode()));</span><br><span class="line"></span><br><span class="line">                   <span class="comment">//é€šè¿‡è¿æ¥è·å¾—è¾“å…¥æµ</span></span><br><span class="line">                   InputStream inputStream=connection.getInputStream();</span><br><span class="line">                   String result=<span class="string">&quot;&quot;</span>;</span><br><span class="line">                   StringBuilder stringBuilder=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                   InputStreamReader inputStreamReader=<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream);</span><br><span class="line">                   BufferedReader bufferedReader=<span class="keyword">new</span> <span class="title class_">BufferedReader</span>(inputStreamReader);</span><br><span class="line">                   <span class="keyword">while</span>((result=bufferedReader.readLine())!=<span class="literal">null</span>)&#123;</span><br><span class="line">                       stringBuilder.append(result);</span><br><span class="line">                   &#125;</span><br><span class="line">                   Log.i(<span class="string">&quot;resultData&quot;</span>, String.valueOf(stringBuilder));</span><br><span class="line">               &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">                   System.out.println(e);</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    String username;</span><br><span class="line">    String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;<span class="comment">//è¿™ä¸ªæ–¹æ³•åœ¨è½¬æ¢å¯¹è±¡ä¸ºJSONObjectçš„æ—¶å€™ä¼šç”¨åˆ°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pics.kahvia.cn/img/image-20221031190721290.png" alt="æ•ˆæœå›¾"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;POST&quot;&gt;&lt;a href=&quot;#POST&quot; class=&quot;headerlink&quot; title=&quot;POST&quot;&gt;&lt;/a&gt;POST&lt;/h3&gt;&lt;p&gt;æ®åº¦å¨˜è§£é‡Šï¼Œä»¥å‰çš„å®‰å“åº”ç”¨å‘å‡º http è¯·æ±‚åï¼Œå¦‚æœè¯·æ±‚æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šäº§ç”Ÿåº”ç”¨æ— å“åº”çš„çŠ¶æ€ã€‚æ‰€ä»¥æ”¹æˆäº†ç°åœ¨è¿™ç§ï¼Œç›´æ¥å‘å‡º </summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Android" scheme="https://blog.kahvia.cn/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-ListWheelScrollView</title>
    <link href="https://blog.kahvia.cn/2022/10/29/FlutterListWheelScrollView.html"/>
    <id>https://blog.kahvia.cn/2022/10/29/FlutterListWheelScrollView.html</id>
    <published>2022-10-29T06:13:54.682Z</published>
    <updated>2022-10-29T06:37:40.800Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ListWheelScrollView"><a href="#ListWheelScrollView" class="headerlink" title="ListWheelScrollView"></a>ListWheelScrollView</h3><p>å’Œ ListView ç±»ä¼¼ï¼Œä½†æ˜¯æ­£å¦‚å®ƒçš„åå­—ï¼Œå®ƒåƒä¸ªè½®å­ï¼Œæ˜¾ç¤ºçš„æ—¶å€™æœ‰å¼§åº¦ã€‚</p><p>è¿™æ˜¯å®˜æ–¹çš„ç»„ä»¶ï¼Œå¹¶ä¸éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>å®ƒå°±åƒä¸€ä¸ªæ¨ªæ”¾çš„åœ†æŸ±ï¼Œä½ åªèƒ½çœ‹åˆ°å‰é¢è¿™ä¸ªé¢ã€‚èƒ½çœ‹åˆ°å¤šå°‘ä¸œè¥¿ï¼Œå–å†³äºå®ƒçš„å¤§å°å’Œä½ ç¦»å®ƒçš„ä½ç½®ã€‚</p><p>å¯ä»¥ä½¿ç”¨ diameterRatio æ”¹å˜å®ƒçš„åœ†é¢ç›´å¾„ã€‚ä½ ç«™åœ¨ä¸€ä¸ªåœ°æ–¹çœ‹åœ†æŸ±ï¼Œåœ†æŸ±è¶Šå¤§ï¼Œä½ çœ‹é‚£ä¸ªé¢è¶Šä¸åƒå¼§é¢ï¼Œèƒ½çœ‹åˆ°çš„ä¸œè¥¿å°±è¶Šå¤šã€‚å°±å¥½åƒæœ¬æ¥å¼¯æ›²çš„ä¹¦æœ¬ï¼Œä½ è®©å®ƒä¸é‚£ä¹ˆå¼¯æ›²åï¼Œçœ‹åˆ°çš„å°±æ›´å¤šäº†å§ã€‚</p><p>å¯ä»¥ä½¿ç”¨ perspective æ¥å†³å®šä½ çš„é€è§†ä½ç½®ã€‚ä½ ç¦»å®ƒè¶Šè¿œï¼Œçœ‹åˆ°çš„ä¸œè¥¿è¶Šå¤šã€‚å°±åƒä¸€å¼ å¼¯æ›²çš„çº¸ä¸Šå†™ç€å¾ˆå¤šå­—ï¼Œä½ è´´è¿‘äº†çœ‹ï¼Œåªèƒ½çœ‹åˆ°å‡ ä¸ªå­—ï¼Œæ‹¿è¿œäº†çœ‹ï¼Œå°±çœ‹å¾—è§ä¸€äº›å¼¯æ›²åçš„å­—ï¼Œæ€»ä½“ä¸Šæ¥è¯´èƒ½çœ‹æ¸…çš„å­—å˜å¤šäº†ã€‚</p><p>å‰è€…æ˜¯åœ¨è§†é‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè®©åœ†æŸ±å¯è§†é¢èƒ½æ˜¾ç¤ºæ›´å¤šçš„ä¸œè¥¿ã€‚åè€…æ˜¯è®©åœ†æŸ±é¢æ˜¾ç¤ºçš„ä¸œè¥¿ä¸å˜çš„æƒ…å†µä¸‹ï¼Œè‡ªå·±å»è·å¾—æ›´å¤§çš„è§†é‡ï¼Œä¼å›¾å»çœ‹åˆ°æ›´å¤šä¸œè¥¿ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Checker</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> Checker(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">//å±‚å å¸ƒå±€ï¼Œç”¨ä¸€ä¸ªé˜´å½±æ¥æ ‡æ³¨å½“å‰é€‰é¡¹</span></span><br><span class="line">    <span class="keyword">return</span> Stack(</span><br><span class="line">      children: [</span><br><span class="line">        Center(</span><br><span class="line">          child: Row(</span><br><span class="line">            mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">            children: [</span><br><span class="line">              SizedBox(</span><br><span class="line">                width: <span class="number">100</span>,</span><br><span class="line">                child:ListWheelScrollView.useDelegate(</span><br><span class="line">                  <span class="comment">//å›ºå®šè·ç¦»æ»šåŠ¨ï¼Œè¿™æ ·å¯ä»¥åˆšå¥½åœç•™åœ¨ä¸€ä¸ªé€‰é¡¹ä¸Š</span></span><br><span class="line">                    physics: <span class="keyword">const</span> FixedExtentScrollPhysics(),</span><br><span class="line">                    <span class="comment">//é€è§†ç¨‹åº¦ã€‚0ä»£è¡¨ä»æ— é™è¿œçš„åœ°æ–¹è§‚å¯Ÿåœ†æŸ±ï¼Œè€Œ1ä»£è¡¨ä»æ— é™è¿‘çš„åœ°æ–¹è§‚å¯Ÿï¼Œè¿‘åˆ°æ— æ³•æ¸²æŸ“</span></span><br><span class="line">                    <span class="comment">//å¯é€‰æ‹©çš„èŒƒå›´æ˜¯(0,0.01]ï¼Œéš”å¾—è¶Šè¿œï¼Œå¼§çº¿è§’åº¦å˜åŒ–è¶Šä¸æ˜æ˜¾ï¼Œçœ‹åˆ°çš„èŒƒå›´ä¹Ÿå°±è¶Šå¤§</span></span><br><span class="line">                    perspective: <span class="number">0.005</span>,</span><br><span class="line">                    <span class="comment">//ç›´å¾„æ¯”ï¼Œé»˜è®¤ä¸º2ã€‚å¯ä»¥ä»£è¡¨è¿™ä¸ªåœ†æŸ±æˆªé¢åœ†çš„ç›´å¾„ã€‚</span></span><br><span class="line">                    <span class="comment">//åœ¨æŸä¸ªå›ºå®šçš„åœ°æ–¹è§‚å¯Ÿåœ†æŸ±ï¼Œåœ†æŸ±æˆªé¢ç›´å¾„è¶Šå¤§ï¼Œè§’åº¦å˜åŒ–è¶Šä¸æ˜æ˜¾ã€‚åˆ—è¡¨çœ‹èµ·æ¥è¶Šåƒç›´çº¿ï¼Œçœ‹çš„èŒƒå›´åè€Œå¥½åƒå˜å¤§äº†ã€‚</span></span><br><span class="line">                    diameterRatio: <span class="number">1.2</span>,</span><br><span class="line">                    <span class="comment">//æ¯ä¸ªé€‰é¡¹çš„é«˜åº¦</span></span><br><span class="line">                    itemExtent: <span class="number">50</span>,</span><br><span class="line">                    <span class="comment">//å­é€‰é¡¹æ„é€ å™¨</span></span><br><span class="line">                    childDelegate: ListWheelChildBuilderDelegate(</span><br><span class="line">                        childCount: <span class="number">13</span>,</span><br><span class="line">                        builder: (context,index)=&gt;Hour(hour: index,)</span><br><span class="line">                    )</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">              SizedBox(</span><br><span class="line">                width: <span class="number">100</span>,</span><br><span class="line">                child: ListWheelScrollView.useDelegate(</span><br><span class="line">                    physics: <span class="keyword">const</span> FixedExtentScrollPhysics(),</span><br><span class="line">                    perspective: <span class="number">0.005</span>,</span><br><span class="line">                    diameterRatio: <span class="number">1.2</span>,</span><br><span class="line">                    itemExtent: <span class="number">50</span>,</span><br><span class="line">                    childDelegate: ListWheelChildBuilderDelegate(</span><br><span class="line">                        childCount: <span class="number">60</span>,</span><br><span class="line">                        builder: (context,index)=&gt;Minute(minute: index)</span><br><span class="line">                    )</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">              SizedBox(</span><br><span class="line">                width: <span class="number">100</span>,</span><br><span class="line">                child: ListWheelScrollView.useDelegate(</span><br><span class="line">                    physics: <span class="keyword">const</span> FixedExtentScrollPhysics(),</span><br><span class="line">                    perspective: <span class="number">0.005</span>,</span><br><span class="line">                    diameterRatio: <span class="number">1.2</span>,</span><br><span class="line">                    itemExtent: <span class="number">50</span>,</span><br><span class="line">                    childDelegate: ListWheelChildBuilderDelegate(</span><br><span class="line">                        childCount: <span class="number">2</span>,</span><br><span class="line">                        builder: (context,index)&#123;</span><br><span class="line">                          <span class="keyword">return</span> AmPm(am: index==<span class="number">0</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    )</span><br><span class="line">                ),</span><br><span class="line">              )</span><br><span class="line">            ],</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        Center(</span><br><span class="line">          child: Container(</span><br><span class="line">            decoration: BoxDecoration(</span><br><span class="line">              color: <span class="keyword">const</span> Color.fromRGBO(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>),</span><br><span class="line">              borderRadius: BorderRadius.circular(<span class="number">24</span>)</span><br><span class="line">            ),</span><br><span class="line">            height: <span class="number">50</span>,</span><br><span class="line">          ),</span><br><span class="line">        )</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h3><p><img src="https://pics.kahvia.cn/img/image-20221029143240083.png" alt="image-20221029143240083"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;ListWheelScrollView&quot;&gt;&lt;a href=&quot;#ListWheelScrollView&quot; class=&quot;headerlink&quot; title=&quot;ListWheelScrollView&quot;&gt;&lt;/a&gt;ListWheelScrollView&lt;/h3&gt;&lt;p&gt;å’Œ </summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-SmoothPageIndicator-Lottie</title>
    <link href="https://blog.kahvia.cn/2022/10/27/FlutterSmoothPageIndicator.html"/>
    <id>https://blog.kahvia.cn/2022/10/27/FlutterSmoothPageIndicator.html</id>
    <published>2022-10-27T05:30:16.234Z</published>
    <updated>2022-10-28T09:31:54.387Z</updated>
    
    <content type="html"><![CDATA[<h3 id="SmoothPageIndicator"><a href="#SmoothPageIndicator" class="headerlink" title="SmoothPageIndicator"></a>SmoothPageIndicator</h3><p>å¹³æ»‘çš„é¡µé¢æŒ‡ç¤ºå™¨ã€‚æˆ‘ç§°å®ƒä¸ºç‚¹é›†ã€‚æ•ˆæœä¸ dots indicator ç±»ä¼¼ï¼Œä½†æ ·å¼æ›´å¤šæ ·ã€‚</p><h4 id="ä¾èµ–å¼•å…¥"><a href="#ä¾èµ–å¼•å…¥" class="headerlink" title="ä¾èµ–å¼•å…¥"></a>ä¾èµ–å¼•å…¥</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">smooth_page_indicator:</span> <span class="string">^1.0.0+2</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SmoothPageIndicator(</span><br><span class="line">  <span class="comment">//this controller is PageController,which is usually used in PageView to controlle the page changing</span></span><br><span class="line">  controller: _controller,</span><br><span class="line">  count: <span class="number">3</span>,</span><br><span class="line">  onDotClicked: (index)&#123;</span><br><span class="line">    _controller.jumpToPage(index);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//æ˜¯ç‰¹æ•ˆï¼æˆ‘åŠ äº†ç‰¹æ•ˆï¼</span></span><br><span class="line">  <span class="comment">//ExpandingDotsEffect,ColorTransitionEffect,JumpingDotEffect...</span></span><br><span class="line">  effect: SwapEffect(</span><br><span class="line">    activeDotColor: Colors.deepPurple,</span><br><span class="line">    dotColor: Colors.deepPurple.shade200</span><br><span class="line">  ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h3 id="Lottie"><a href="#Lottie" class="headerlink" title="Lottie"></a>Lottie</h3><p>ä¸€ä¸ªå¯ä»¥æ¸²æŸ“åŠ¨æ€ç‰¹æ•ˆçš„å·¥å…·ã€‚å¸¸ç”¨äºæ¸²æŸ“ AE å¯¼å‡ºçš„ json æ ¼å¼çš„ç‰¹æ•ˆã€‚</p><p>å¯é…åˆ<a href="https://lottiefiles.com/">LottieFiles</a>ä½¿ç”¨ã€‚</p><h4 id="ä¾èµ–å¼•å…¥-1"><a href="#ä¾èµ–å¼•å…¥-1" class="headerlink" title="ä¾èµ–å¼•å…¥"></a>ä¾èµ–å¼•å…¥</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">lottie:</span> <span class="string">^1.4.3</span> <span class="comment"># A library for animations</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Lottie.asset(<span class="string">&quot;assets/lotties/wifi-high-speed-internet.json&quot;</span>) <span class="comment">//é€šè¿‡é¢„è®¾èµ„æºä½¿ç”¨</span></span><br><span class="line">Lottie.network(<span class="string">&quot;https://assets5.lottiefiles.com/packages/lf20_mdxpRNhzMQ.json&quot;</span>) <span class="comment">//é€šè¿‡ç½‘ç»œèµ„æºä½¿ç”¨</span></span><br></pre></td></tr></table></figure><h3 id="ä¸¤è€…ç»“åˆ"><a href="#ä¸¤è€…ç»“åˆ" class="headerlink" title="ä¸¤è€…ç»“åˆ"></a>ä¸¤è€…ç»“åˆ</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntroductionScreensPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">//the page controller is essential</span></span><br><span class="line">  <span class="keyword">final</span> PageController _controller=PageController();</span><br><span class="line"></span><br><span class="line">  IntroductionScreensPage(&#123;<span class="keyword">super</span>.key&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">//only using the stack layout can make the dots bar shown correctly on the screen</span></span><br><span class="line">    <span class="comment">//å› ä¸ºç”¨columnä¼šè¶…å‡ºå±å¹•ï¼Œç„¶åæŠ¥é”™</span></span><br><span class="line">    <span class="keyword">return</span> Stack(</span><br><span class="line">      alignment: <span class="keyword">const</span> AlignmentDirectional(<span class="number">0</span>, <span class="number">0.75</span>),</span><br><span class="line">      children: [</span><br><span class="line">        PageView(</span><br><span class="line">          controller: _controller,</span><br><span class="line">          children: <span class="keyword">const</span> [</span><br><span class="line">            IntroductionPage1(),</span><br><span class="line">            IntroductionPage2(),</span><br><span class="line">            IntroductionPage3()</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">        SmoothPageIndicator(</span><br><span class="line">          controller: _controller,</span><br><span class="line">          count: <span class="number">3</span>,</span><br><span class="line">          onDotClicked: (index)&#123;</span><br><span class="line">            _controller.jumpToPage(index);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">//æ˜¯ç‰¹æ•ˆï¼æˆ‘åŠ äº†ç‰¹æ•ˆï¼</span></span><br><span class="line">          <span class="comment">//ExpandingDotsEffect,ColorTransitionEffect,JumpingDotEffect...</span></span><br><span class="line">          effect: SwapEffect(</span><br><span class="line">            activeDotColor: Colors.deepPurple,</span><br><span class="line">            dotColor: Colors.deepPurple.shade200</span><br><span class="line">          ),</span><br><span class="line">        )</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntroductionPage1</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> IntroductionPage1(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: Container(</span><br><span class="line">        color: Colors.deepPurple.shade300,</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.spaceEvenly,</span><br><span class="line">          children: [</span><br><span class="line">            <span class="keyword">const</span> SizedBox(height: <span class="number">30</span>,),</span><br><span class="line">            <span class="keyword">const</span> Text(</span><br><span class="line">              <span class="string">&quot;It&#x27;s Achat&quot;</span>,</span><br><span class="line">              style: TextStyle(</span><br><span class="line">                fontFamily: <span class="string">&quot;Bebas_Neue&quot;</span>,</span><br><span class="line">                fontSize: <span class="number">70</span>,</span><br><span class="line">                color: Colors.white</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            Lottie.asset(<span class="string">&quot;assets/lotties/talk-show2.json&quot;</span>),</span><br><span class="line">            <span class="keyword">const</span> SizedBox(height: <span class="number">70</span>,),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="https://pics.kahvia.cn/img/image-20221027134752117.png" alt="image-20221027134752117"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;SmoothPageIndicator&quot;&gt;&lt;a href=&quot;#SmoothPageIndicator&quot; class=&quot;headerlink&quot; title=&quot;SmoothPageIndicator&quot;&gt;&lt;/a&gt;SmoothPageIndicator&lt;/h3&gt;&lt;p&gt;å¹³æ»‘</summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-PercentIndicator</title>
    <link href="https://blog.kahvia.cn/2022/10/26/FlutterPercentIndicator.html"/>
    <id>https://blog.kahvia.cn/2022/10/26/FlutterPercentIndicator.html</id>
    <published>2022-10-26T11:20:54.541Z</published>
    <updated>2022-10-28T09:32:02.135Z</updated>
    
    <content type="html"><![CDATA[<h3 id="PercentIndicator"><a href="#PercentIndicator" class="headerlink" title="PercentIndicator"></a>PercentIndicator</h3><p>è¿™æ˜¯ä¸€ä¸ªç™¾åˆ†æ¯”æŒ‡ç¤ºå™¨çš„ç»„ä»¶ï¼Œä¿—ç§°è¿›åº¦æ¡ã€‚æ˜¯ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œç”¨ä»¥å¼¥è¡¥å®˜æ–¹çš„ CircularProgressIndicator çš„ä¸è¶³ã€‚æˆ‘æ›¾æƒ³ç”¨å®˜æ–¹çš„è¿›åº¦æ¡ç»„ä»¶åŒ…è£¹ä¸€ä¸ªåœ†æ¡†ï¼Œç”¨ä»¥å±•ç¤ºå¤´åƒä¸Šä¼ è¿›åº¦ï¼Œç„¶è€Œå®˜æ–¹çš„ç»„ä»¶å¹¶ä¸æ”¯æŒåœ¨åœ†ç¯ä¸­é—´æ’å…¥å­ç»„ä»¶ï¼Œæ‰€ä»¥è‡ªå·±åšçš„è¯ï¼Œæˆ–è®¸è¦ç”¨å±‚å å¸ƒå±€ï¼Œé¢‡æ„Ÿéº»çƒ¦ã€‚</p><p>ä½†æ˜¯ä»Šå¤©å¶ç„¶é‡è§è¿™ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="ä¾èµ–å¼•å…¥"><a href="#ä¾èµ–å¼•å…¥" class="headerlink" title="ä¾èµ–å¼•å…¥"></a>ä¾èµ–å¼•å…¥</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">percent_indicator:</span> <span class="string">^4.0.1</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProgressBarPageContent</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ProgressBarPageContent(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;ProgressBarPageContent&gt; createState() =&gt; _ProgressBarPageContentState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_ProgressBarPageContentState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">ProgressBarPageContent</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">double</span> progress=<span class="number">0</span>;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: Column(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">        children: [</span><br><span class="line">          CircularPercentIndicator(</span><br><span class="line">            <span class="comment">//å¼€å¯è¿‡æ¸¡åŠ¨ç”»</span></span><br><span class="line">            animation: <span class="keyword">true</span>,</span><br><span class="line">            <span class="comment">//åŠ¨ç”»èµ·ç‚¹ä»ä¸Šä¸€æ¬¡åŠ¨ç”»ç»ˆç‚¹å¼€å§‹ã€‚é»˜è®¤ä»0å¼€å§‹ã€‚</span></span><br><span class="line">            animateFromLastPercent: <span class="keyword">true</span>,</span><br><span class="line">            <span class="comment">//åœ†ç¯åº•è‰²</span></span><br><span class="line">            backgroundColor: Colors.red[<span class="number">200</span>]!,</span><br><span class="line">            <span class="comment">//å¤–åœ†åŠå¾„</span></span><br><span class="line">            radius: <span class="number">150</span>,</span><br><span class="line">            <span class="comment">//åœ†ç¯å®½åº¦</span></span><br><span class="line">            lineWidth: <span class="number">10</span>,</span><br><span class="line">            <span class="comment">//åœ†ç¯çº¿å¸½è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯è¿›åº¦æ¡çš„å°¾éƒ¨ï¼Œå¤šå‡ºä¸€éƒ¨åˆ†ç”¨ä½œçº¿å¸½ï¼Œçº¿å¸½çš„å½¢çŠ¶</span></span><br><span class="line">            circularStrokeCap: CircularStrokeCap.round,</span><br><span class="line">            <span class="comment">//è¿™é‡Œåœ†ç¯ä¸­é—´å¯æ”¾ç½®ä»»æ„å…ƒç´ ã€‚</span></span><br><span class="line">            center: <span class="keyword">const</span> CircleAvatar(</span><br><span class="line">              backgroundImage: AssetImage(<span class="string">&quot;images/head/nilu.png&quot;</span>),</span><br><span class="line">              radius: <span class="number">140</span>,</span><br><span class="line">            ),</span><br><span class="line">            <span class="comment">//percentä¸ºè¿›åº¦</span></span><br><span class="line">            percent: progress</span><br><span class="line">          ),</span><br><span class="line">          <span class="keyword">const</span> SizedBox(height: <span class="number">10</span>,),</span><br><span class="line">          ElevatedButton(</span><br><span class="line">            style: ButtonStyle(</span><br><span class="line">              backgroundColor: MaterialStateProperty.all(Colors.redAccent)</span><br><span class="line">            ),</span><br><span class="line">            onPressed: ()&#123;</span><br><span class="line">              setState(() &#123;</span><br><span class="line">                <span class="keyword">if</span>(progress==<span class="number">1</span>) &#123;</span><br><span class="line">                  progress=<span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  progress=<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            child: <span class="keyword">const</span> Text(<span class="string">&quot;Show Progress&quot;</span>)</span><br><span class="line">          )</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœå±•ç¤º"><a href="#æ•ˆæœå±•ç¤º" class="headerlink" title="æ•ˆæœå±•ç¤º"></a>æ•ˆæœå±•ç¤º</h3><p><img src="https://pics.kahvia.cn/img/image-20221026192953616.png" alt="image-20221026192953616"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;PercentIndicator&quot;&gt;&lt;a href=&quot;#PercentIndicator&quot; class=&quot;headerlink&quot; title=&quot;PercentIndicator&quot;&gt;&lt;/a&gt;PercentIndicator&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç™¾åˆ†æ¯”æŒ‡ç¤ºå™¨çš„ç»„ä»¶ï¼Œ</summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-Slidable</title>
    <link href="https://blog.kahvia.cn/2022/10/23/FlutterSlidable.html"/>
    <id>https://blog.kahvia.cn/2022/10/23/FlutterSlidable.html</id>
    <published>2022-10-23T09:57:18.396Z</published>
    <updated>2022-10-28T10:35:10.469Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Slidable"><a href="#Slidable" class="headerlink" title="Slidable"></a>Slidable</h3><p>æ»‘åŠ¨é€‰é¡¹å¡ç»„ä»¶ã€‚</p><h3 id="ä¾èµ–å¼•å…¥"><a href="#ä¾èµ–å¼•å…¥" class="headerlink" title="ä¾èµ–å¼•å…¥"></a>ä¾èµ–å¼•å…¥</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter_slidable: ^<span class="number">2.0</span><span class="number">.0</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Slidable(<span class="comment">//å¯æ»‘åŠ¨çš„ç»„ä»¶</span></span><br><span class="line">  <span class="comment">//endä»£è¡¨ä»å³è¾¹å¾€å·¦è¾¹æ»‘åŠ¨</span></span><br><span class="line">  endActionPane: ActionPane(<span class="comment">//æ»‘åŠ¨é€‰é¡¹é¢æ¿</span></span><br><span class="line">    motion: <span class="keyword">const</span> StretchMotion(),<span class="comment">//æ»‘åŠ¨åŠ¨ç”»</span></span><br><span class="line">    children: [</span><br><span class="line">      <span class="comment">//SlidableActionæ˜¯å•ä¸ªæ»‘åŠ¨é€‰é¡¹</span></span><br><span class="line">      SlidableAction(</span><br><span class="line">        onPressed: onDelete,<span class="comment">//è§¦å‘åˆ é™¤çš„å‡½æ•°</span></span><br><span class="line">        icon: Icons.delete,<span class="comment">//å›¾æ ‡</span></span><br><span class="line">        backgroundColor: Colors.redAccent,<span class="comment">//èƒŒæ™¯è‰²</span></span><br><span class="line">        borderRadius: BorderRadius.circular(<span class="number">12</span>),<span class="comment">//åœ†è§’</span></span><br><span class="line">      )</span><br><span class="line">    ],</span><br><span class="line">  ),</span><br><span class="line">  child: Container(</span><br><span class="line">    padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">24</span>),</span><br><span class="line">    <span class="comment">// height: 60,</span></span><br><span class="line">    decoration:  BoxDecoration(</span><br><span class="line">        color: Colors.orange,</span><br><span class="line">        borderRadius: BorderRadius.circular(<span class="number">12</span>)</span><br><span class="line">    ),</span><br><span class="line">    child: Row(</span><br><span class="line">      children: [</span><br><span class="line">        Checkbox(</span><br><span class="line">          value: finished,</span><br><span class="line">          onChanged: onChanged,</span><br><span class="line">          activeColor: Colors.black,</span><br><span class="line">        ),</span><br><span class="line">        Text(</span><br><span class="line">          taskName,</span><br><span class="line">          style: TextStyle(decoration: finished?TextDecoration.lineThrough:TextDecoration.none),</span><br><span class="line">          overflow: TextOverflow.ellipsis,</span><br><span class="line">        )</span><br><span class="line">      ],</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Â Navigator.of(context).pop();&#x2F;&#x2F;è¿™æ ·Navigator.pop(context);&#x2F;&#x2F;æˆ–è¿™æ ·dart</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;Slidable&quot;&gt;&lt;a href=&quot;#Slidable&quot; class=&quot;headerlink&quot; title=&quot;Slidable&quot;&gt;&lt;/a&gt;Slidable&lt;/h3&gt;&lt;p&gt;æ»‘åŠ¨é€‰é¡¹å¡ç»„ä»¶ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¾èµ–å¼•å…¥&quot;&gt;&lt;a href=&quot;#ä¾èµ–å¼•å…¥&quot; cla</summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-CircularProgressIndicator</title>
    <link href="https://blog.kahvia.cn/2022/10/20/FlutterCircularProgressIndicator.html"/>
    <id>https://blog.kahvia.cn/2022/10/20/FlutterCircularProgressIndicator.html</id>
    <published>2022-10-20T08:29:31.068Z</published>
    <updated>2022-10-28T09:32:14.232Z</updated>
    
    <content type="html"><![CDATA[<h3 id="CircularProgressIndicator"><a href="#CircularProgressIndicator" class="headerlink" title="CircularProgressIndicator"></a>CircularProgressIndicator</h3><p>åœ†å½¢çš„è¿›åº¦æŒ‡ç¤ºã€‚å¯ä»¥ç”¨äºç­‰å¾…åŠ è½½çš„æ—¶å€™ã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>å¸¸é…åˆ showDialog( ) ä½¿ç”¨ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">showDialog(</span><br><span class="line">    context: context,</span><br><span class="line">    builder: (context)&#123;</span><br><span class="line">      <span class="keyword">return</span> Center(</span><br><span class="line">        child: CircularProgressIndicator(color: MyColors.rgbRed,),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç”¨å®Œä»¥åç”¨ Navigator å›é€€é¡µé¢å°±è¡Œäº†ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Navigator.of(context).pop();<span class="comment">//è¿™æ ·</span></span><br><span class="line">Navigator.pop(context);<span class="comment">//æˆ–è¿™æ ·</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;CircularProgressIndicator&quot;&gt;&lt;a href=&quot;#CircularProgressIndicator&quot; class=&quot;headerlink&quot; title=&quot;CircularProgressIndicator&quot;&gt;&lt;/a&gt;CircularPro</summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-ImagePicker-ImageCropper</title>
    <link href="https://blog.kahvia.cn/2022/10/20/FlutterImagePickerAndCropper.html"/>
    <id>https://blog.kahvia.cn/2022/10/20/FlutterImagePickerAndCropper.html</id>
    <published>2022-10-20T05:49:22.508Z</published>
    <updated>2022-10-28T09:32:25.212Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ImagePicker"><a href="#ImagePicker" class="headerlink" title="ImagePicker"></a>ImagePicker</h3><p>Flutterç”¨äºé€‰æ‹©å›¾ç‰‡çš„å·¥å…·åŒ…ã€‚</p><h4 id="ä¾èµ–å¼•å…¥"><a href="#ä¾èµ–å¼•å…¥" class="headerlink" title="ä¾èµ–å¼•å…¥"></a>ä¾èµ–å¼•å…¥</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image_picker:</span> <span class="string">^0.8.6</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ImagePicker _picker=ImagePicker();<span class="comment">//åˆ›å»ºé€‰æ‹©å™¨å®ä¾‹</span></span><br><span class="line">onPressed: ()<span class="keyword">async</span>&#123;</span><br><span class="line">        <span class="comment">//ä»ç›¸å†Œé€‰æ‹©å›¾ç‰‡</span></span><br><span class="line">        <span class="keyword">final</span> image=<span class="keyword">await</span> _picker.pickImage(source: ImageSource.gallery);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><h3 id="ImageCropper"><a href="#ImageCropper" class="headerlink" title="ImageCropper"></a>ImageCropper</h3><p>ç”¨äºå›¾ç‰‡è£å‰ªçš„å·¥å…·åŒ…</p><h4 id="ä¾èµ–å¼•å…¥-1"><a href="#ä¾èµ–å¼•å…¥-1" class="headerlink" title="ä¾èµ–å¼•å…¥"></a>ä¾èµ–å¼•å…¥</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">image_cropper:</span> <span class="string">^3.0.0</span></span><br></pre></td></tr></table></figure><h4 id="ç›¸å…³é…ç½®-å®‰å“éœ€è¦é…ç½®ï¼Œiosä¸éœ€è¦"><a href="#ç›¸å…³é…ç½®-å®‰å“éœ€è¦é…ç½®ï¼Œiosä¸éœ€è¦" class="headerlink" title="ç›¸å…³é…ç½®(å®‰å“éœ€è¦é…ç½®ï¼Œiosä¸éœ€è¦)"></a>ç›¸å…³é…ç½®(å®‰å“éœ€è¦é…ç½®ï¼Œiosä¸éœ€è¦)</h4><p>åœ¨AndroidManifest.xmlåŠ å…¥ä»¥ä¸‹ä¿¡æ¯ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;com.yalantis.ucrop.UCropActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.AppCompat.Light.NoActionBar&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CroppedFile? croppedImage=<span class="keyword">await</span> ImageCropper().cropImage(sourcePath: image.path);<span class="comment">//åˆ›å»ºè£å‰ªå™¨ç»™å®šå›¾ç‰‡æºè¿›è¡Œè£å‰ª</span></span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="ä¸¤è€…ç»“åˆ"><a href="#ä¸¤è€…ç»“åˆ" class="headerlink" title="ä¸¤è€…ç»“åˆ"></a>ä¸¤è€…ç»“åˆ</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Widget build(BuildContext context) &#123;</span><br><span class="line">  <span class="comment">//åˆ›å»ºå›¾ç‰‡é€‰æ‹©å™¨å®ä¾‹</span></span><br><span class="line">  <span class="keyword">final</span> ImagePicker _picker=ImagePicker();</span><br><span class="line">  <span class="keyword">return</span> ElevatedButton(</span><br><span class="line">    <span class="comment">//å•å‡»æŒ‰é’®è§¦å‘é€‰æ‹©</span></span><br><span class="line">    onPressed: ()<span class="keyword">async</span>&#123;</span><br><span class="line">      <span class="comment">//ä»ç›¸å†Œé€‰æ‹©å›¾ç‰‡</span></span><br><span class="line">      <span class="keyword">final</span> image=<span class="keyword">await</span> _picker.pickImage(source: ImageSource.gallery); <span class="comment">//è¿”å›çš„æ˜¯XFileå¯¹è±¡</span></span><br><span class="line">      <span class="comment">//é€‰æ‹©äº†å›¾ç‰‡åˆ™åˆ›å»ºè£å‰ªå™¨å®ä¾‹è¿›å…¥è£å‰ªç¯èŠ‚</span></span><br><span class="line">      <span class="keyword">if</span>(image!=<span class="keyword">null</span>)&#123;</span><br><span class="line">        CroppedFile? croppedImage=<span class="keyword">await</span> ImageCropper().cropImage(sourcePath: image.path);<span class="comment">//æ ¹æ®XFileå¯¹è±¡çš„è·¯å¾„è·å¾—å›¾ç‰‡è¿›è¡Œè£å‰ª</span></span><br><span class="line">        <span class="comment">//è£å‰ªäº†åˆ™æŠŠè£å‰ªåçš„å›¾ç‰‡è®¾ç½®ä¸ºé¢„è§ˆçš„æ–‡ä»¶æº</span></span><br><span class="line">        <span class="keyword">if</span>(croppedImage!=<span class="keyword">null</span>)&#123;</span><br><span class="line">          context.read&lt;ImageData&gt;().setImage(File(croppedImage.path));<span class="comment">//CroppedFileè½¬Fileï¼Œä¸Šä¼ å›¾ç‰‡çš„æ—¶å€™æ ¹æ®Fileè½¬MultipartFileå³å¯</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æœªè£å‰ªåˆ™è®¾ç½®è£å‰ªä¹‹å‰é€‰æ‹©çš„å›¾ç‰‡ä½œä¸ºé¢„è§ˆçš„æ–‡ä»¶æº</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">          context.read&lt;ImageData&gt;().setImage(File(image.path));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    style: ButtonStyle(</span><br><span class="line">        shape: MaterialStateProperty.all(<span class="keyword">const</span> RoundedRectangleBorder(</span><br><span class="line">            borderRadius: BorderRadius.all(Radius.circular(<span class="number">30</span>))</span><br><span class="line">        )),</span><br><span class="line">        <span class="comment">//è®¾ç½®æŒ‰é’®å®½åº¦é«˜åº¦ç­‰</span></span><br><span class="line">        minimumSize: MaterialStateProperty.all(<span class="keyword">const</span> Size(<span class="number">300</span>, <span class="number">40</span>)),</span><br><span class="line">        backgroundColor: MaterialStateProperty.all(MyColors.rgbRed)</span><br><span class="line">    ),</span><br><span class="line">    child: <span class="keyword">const</span> Text(<span class="string">&quot;Select a photo from gallery&quot;</span>),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å›¾ç‰‡ä¸Šä¼ "><a href="#å›¾ç‰‡ä¸Šä¼ " class="headerlink" title="å›¾ç‰‡ä¸Šä¼ "></a>å›¾ç‰‡ä¸Šä¼ </h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å›¾ç‰‡é€‰æ‹©æˆ–è£å‰ªå®Œæ¯•åï¼Œå•å‡»å®Œæˆä¸Šä¼ </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FinishedButton</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> FinishedButton(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºdioå®ä¾‹ï¼Œç”¨äºå‘é€httpè¯·æ±‚</span></span><br><span class="line">    <span class="keyword">final</span> dio=Dio();</span><br><span class="line">    <span class="comment">//è·å–å·²ç»å‡†å¤‡å¥½çš„å›¾ç‰‡æ–‡ä»¶æº</span></span><br><span class="line">    File? image=context.watch&lt;ImageData&gt;().image;</span><br><span class="line">    <span class="keyword">return</span> ElevatedButton(</span><br><span class="line">      onPressed: image==null?<span class="comment">//æ²¡æœ‰æ–‡ä»¶æºä»£è¡¨æ²¡æœ‰é€‰å›¾ç‰‡ï¼Œä¸è¿›è¡Œä¸Šä¼ æ“ä½œ</span></span><br><span class="line">      ()&#123;&#125;:<span class="comment">//æœ‰æ–‡ä»¶æºå°±è¿›å…¥ä¸Šä¼ é˜¶æ®µ</span></span><br><span class="line">      ()<span class="keyword">async</span>&#123;</span><br><span class="line">        <span class="keyword">final</span> multipartImg=<span class="keyword">await</span> MultipartFile.fromFile(image.path);<span class="comment">//æ ¹æ®æ–‡ä»¶æºç”Ÿæˆåª’ä½“å›¾ç‰‡</span></span><br><span class="line">        <span class="keyword">final</span> map=&lt;<span class="built_in">String</span>,<span class="built_in">dynamic</span>&gt;&#123;&#125;;<span class="comment">//åˆ›å»ºmapå­˜å‚¨å›¾ç‰‡</span></span><br><span class="line">        map[<span class="string">&#x27;file&#x27;</span>]=<span class="keyword">await</span> MultipartFile.fromFile(image.path);</span><br><span class="line">        <span class="comment">//å°†mapè½¬ä¸ºè¡¨å•æ•°æ®åï¼Œå‘é€postè¯·æ±‚ï¼Œä¸Šä¼ æœåŠ¡å™¨ï¼Œå¹¶æ¥æ”¶è¿”å›çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">var</span> response=<span class="keyword">await</span> dio.post(<span class="string">&quot;<span class="subst">$serviceUploadHeader</span>/<span class="subst">$&#123;context.read&lt;UserMsg&gt;().userId&#125;</span>&quot;</span>,data: FormData.fromMap(map));</span><br><span class="line">        context.read&lt;UserMsg&gt;().setHeadImg(response.data);<span class="comment">//åŠæ—¶æ›´æ–°å¤´åƒçš„é“¾æ¥</span></span><br><span class="line">        Navigator.pop(context);<span class="comment">//ä¸Šä¼ å®Œæ¯•å³é€€å›é¦–é¡µ</span></span><br><span class="line">      &#125;,</span><br><span class="line">      style: ButtonStyle(</span><br><span class="line">          backgroundColor: image==null?</span><br><span class="line">          MaterialStateProperty.all(Colors.grey):</span><br><span class="line">          MaterialStateProperty.all(MyColors.rgbRed)</span><br><span class="line">      ),</span><br><span class="line">      child:  <span class="keyword">const</span> Text(<span class="string">&quot;Finished&quot;</span>,),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;ImagePicker&quot;&gt;&lt;a href=&quot;#ImagePicker&quot; class=&quot;headerlink&quot; title=&quot;ImagePicker&quot;&gt;&lt;/a&gt;ImagePicker&lt;/h3&gt;&lt;p&gt;Flutterç”¨äºé€‰æ‹©å›¾ç‰‡çš„å·¥å…·åŒ…ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ä¾èµ–å¼•å…¥&quot;&gt;&lt;a href=&quot;#ä¾èµ–å¼•å…¥&quot; class=&quot;headerlink&quot; title=&quot;ä¾èµ–å¼•å…¥&quot;&gt;&lt;/a&gt;ä¾èµ–å¼•å…¥&lt;/h4&gt;&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;image_picker:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;^0.8.6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨&quot;&gt;&lt;/a&gt;ä½¿ç”¨&lt;/h4&gt;&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; ImagePicker _picker=ImagePicker();&lt;span class=&quot;comment&quot;&gt;//åˆ›å»ºé€‰æ‹©å™¨å®ä¾‹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;onPressed: ()&lt;span class=&quot;keyword&quot;&gt;async&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//ä»ç›¸å†Œé€‰æ‹©å›¾ç‰‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; image=&lt;span class=&quot;keyword&quot;&gt;await&lt;/span&gt; _picker.pickImage(source: ImageSource.gallery);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;ImageCropper&quot;&gt;&lt;a href=&quot;#ImageCropper&quot; class=&quot;headerlink&quot; title=&quot;ImageCropper&quot;&gt;&lt;/a&gt;ImageCropper&lt;/h3&gt;&lt;p&gt;ç”¨äºå›¾ç‰‡è£å‰ªçš„å·¥å…·åŒ…&lt;/p&gt;
&lt;h4 id=&quot;ä¾èµ–å¼•å…¥-1&quot;&gt;&lt;a href=&quot;#ä¾èµ–å¼•å…¥-1&quot; class=&quot;headerlink&quot; title=&quot;ä¾èµ–å¼•å…¥&quot;&gt;&lt;/a&gt;ä¾èµ–å¼•å…¥&lt;/h4&gt;&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;image_cropper:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;^3.0.0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;ç›¸å…³é…ç½®-å®‰å“éœ€è¦é…ç½®ï¼Œiosä¸éœ€è¦&quot;&gt;&lt;a href=&quot;#ç›¸å…³é…ç½®-å®‰å“éœ€è¦é…ç½®ï¼Œiosä¸éœ€è¦&quot; class=&quot;headerlink&quot; title=&quot;ç›¸å…³é…ç½®(å®‰å“éœ€è¦é…ç½®ï¼Œiosä¸éœ€è¦)&quot;&gt;&lt;/a&gt;ç›¸å…³é…ç½®(å®‰å“éœ€è¦é…ç½®ï¼Œiosä¸éœ€è¦)&lt;/h4&gt;&lt;p&gt;åœ¨AndroidManifest.xmlåŠ å…¥ä»¥ä¸‹ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;activity&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;com.yalantis.ucrop.UCropActivity&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:screenOrientation&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;portrait&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:theme&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&amp;quot;@style/Theme.AppCompat.Light.NoActionBar&amp;quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h4 id=&quot;ä½¿ç”¨-1&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨-1&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨&quot;&gt;&lt;/a&gt;ä½¿ç”¨&lt;/h4&gt;&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;CroppedFile? croppedImage=&lt;span class=&quot;keyword&quot;&gt;await&lt;/span&gt; ImageCropper().cropImage(sourcePath: image.path);&lt;span class=&quot;comment&quot;&gt;//åˆ›å»ºè£å‰ªå™¨ç»™å®šå›¾ç‰‡æºè¿›è¡Œè£å‰ª&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>MicroService-Nacos</title>
    <link href="https://blog.kahvia.cn/2022/10/16/MicroserviceNacos.html"/>
    <id>https://blog.kahvia.cn/2022/10/16/MicroserviceNacos.html</id>
    <published>2022-10-16T04:52:16.493Z</published>
    <updated>2022-10-28T09:32:19.120Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h3><p>ç”¨äºæ›¿ä»£å·²ç»åœæ­¢ç»´æŠ¤çš„ Eureka ã€‚</p><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><p>åœ¨<a href="https://github.com/alibaba/nacos">AlibabaNacos</a>çš„é‡Œç¨‹ç¢‘ä¸­é€‰æ‹©ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ã€‚</p><p>ä¸‹è½½è§£å‹åï¼Œåœ¨ bin ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥æŒ‡ä»¤å¯åŠ¨ã€‚Windows è¿è¡Œcmdæ–‡ä»¶ï¼ŒLinuxè¿è¡Œshæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./startup.cmd -m standalone</span><br></pre></td></tr></table></figure><p>é»˜è®¤æœåŠ¡ç«¯å£ä¸º8848ï¼Œå¯åœ¨ conf ç›®å½•ä¸‹é…ç½®æ–‡ä»¶ application.properties ä¸­æ›´æ”¹ã€‚</p><span id="more"></span><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><p>åœ¨çˆ¶å·¥ç¨‹çš„pomæ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ç®¡ç†ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Hoxton.SR9<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            åŒ…å«nacosçš„é¡¹ç›®ä¾èµ–ç®¡ç†--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å­å·¥ç¨‹ï¼ˆå„å¾®æœåŠ¡å¯¹åº”çš„spring booté¡¹ç›®ï¼‰pomæ–‡ä»¶ä¸­æ·»åŠ  nacos ä¾èµ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å­å·¥ç¨‹é…ç½®æ–‡ä»¶ymlä¸­é…ç½®æœåŠ¡ç«¯åœ°å€</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">UserService</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">39940</span></span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡å¤šçº§å­˜å‚¨æ¨¡å‹"><a href="#æœåŠ¡å¤šçº§å­˜å‚¨æ¨¡å‹" class="headerlink" title="æœåŠ¡å¤šçº§å­˜å‚¨æ¨¡å‹"></a>æœåŠ¡å¤šçº§å­˜å‚¨æ¨¡å‹</h3><p>å¾®æœåŠ¡åˆ†é›†ç¾¤éƒ¨ç½²ã€‚åˆ†é›†ç¾¤éƒ¨ç½²ï¼ŒæœåŠ¡ä¸å®¹æ˜“åŒæ—¶æŒ‚æ‰ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://www.kahvia.cn:3306/Blogs?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">Mysql3306@.com</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">UserService</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">discovery:</span> </span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">YC</span> <span class="comment">#é›†ç¾¤åç§°ï¼Œå¸¸æŒ‰åœ°ååˆ’åˆ†ï¼ŒYCä¸ºå®œæ˜Œ</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">39940</span></span><br></pre></td></tr></table></figure><h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h3><p>å±€éƒ¨ç­–ç•¥ï¼ˆåœ¨æŸä¸ªå¾®æœåŠ¡ä¸­è°ƒç”¨æŒ‡å®šå¾®æœåŠ¡çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">UserService:</span> <span class="comment">#ä¸ºæŸä¸ªå¾®æœåŠ¡é…ç½®è´Ÿè½½å‡è¡¡çš„è§„åˆ™</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span> <span class="comment">#è¯¥ç­–ç•¥ä¼˜å…ˆè¿œç¨‹è°ƒç”¨åŒé›†ç¾¤çš„å¾®æœåŠ¡ï¼ŒåŒé›†ç¾¤æŒ‚æ‰ä¼šè®¿é—®å…¶å®ƒé›†ç¾¤</span></span><br></pre></td></tr></table></figure><h3 id="æƒé‡"><a href="#æƒé‡" class="headerlink" title="æƒé‡"></a>æƒé‡</h3><p>åœ¨nacosç®¡ç†é¡µé¢ä¸­ï¼Œå¯ä»¥ä¸ºåŒä¸€å¾®æœåŠ¡åŒä¸€é›†ç¾¤çš„ä¸åŒå®ä¾‹è®¾ç½®æƒé‡ã€‚æƒé‡è¶Šå¤§ï¼Œè´Ÿè½½å‡è¡¡é€‰ä¸­çš„å‡ ç‡è¶Šå¤§ã€‚</p><p>å¯ä»¥é€šè¿‡å°†æƒé‡ç½®é›¶æ¥è¿›è¡ŒæœåŠ¡çš„å‡çº§ï¼Œå‡çº§å®Œæˆåè®¾ç½®è¾ƒå°æƒé‡è¿›è¡ŒæœåŠ¡æµ‹è¯•ã€‚</p><h3 id="ç¯å¢ƒéš”ç¦»"><a href="#ç¯å¢ƒéš”ç¦»" class="headerlink" title="ç¯å¢ƒéš”ç¦»"></a>ç¯å¢ƒéš”ç¦»</h3><p>ä¸åŒç¯å¢ƒï¼ˆä¸åŒå‘½åç©ºé—´ï¼‰çš„æœåŠ¡æ— æ³•äº’ç›¸è°ƒç”¨ã€‚å¯ç”¨äºå¼€å‘ç¯å¢ƒä¸ä¸Šçº¿åçš„ç¯å¢ƒéš”ç¦»ï¼Œå¤§æ¦‚ï¼Ÿ</p><p>åœ¨nacosç®¡ç†é¡µé¢ä¸­ï¼Œå¯æ–°å»ºå‘½åç©ºé—´ï¼Œè·å–å®ƒçš„idåï¼Œåœ¨éœ€è¦é…ç½®ç¯å¢ƒéš”ç¦»çš„æœåŠ¡é¡¹ç›®çš„ application.yml ä¸­ï¼Œå¦‚ä¸‹é…ç½®ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">AchatWs</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment">#nacosæœåŠ¡ç«¯åœ°å€</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">YC</span> <span class="comment">#é›†ç¾¤æ¨¡æ‹Ÿï¼Œå®œæ˜Œ</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">id</span> <span class="comment">#å‘½åç©ºé—´çš„id</span></span><br></pre></td></tr></table></figure><h3 id="Nacosé…ç½®ç®¡ç†"><a href="#Nacosé…ç½®ç®¡ç†" class="headerlink" title="Nacosé…ç½®ç®¡ç†"></a>Nacosé…ç½®ç®¡ç†</h3><p>å®¢æˆ·ç«¯å¼•å…¥nacosé…ç½®ç®¡ç†çš„ä¾èµ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦è¿›è¡Œé…ç½®ç®¡ç†çš„é¡¹ç›®æ–°å»º bootstrap.yml æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­å†™å…¥ä¸nacosæœ‰å…³çš„å±æ€§ï¼Œå¦‚å¼€å‘ç¯å¢ƒã€æœåŠ¡ç«¯åœ°å€ã€å¾®æœåŠ¡åç§°ç­‰ã€‚è¿™äº›ä¿¡æ¯åœ¨ application.yml ä¸­å°±å¯ä»¥ä¸å†™äº†ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#bootstrap.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">UserService</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#å¼€å‘ç¯å¢ƒ</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">YC</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#è¦è·å–çš„é…ç½®æ–‡ä»¶åç¼€å</span></span><br></pre></td></tr></table></figure><p>é¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆè¯»å– bootstrap.yml ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå†æ ¹æ®å…¶ä¸­çš„ä¿¡æ¯å»nacosæœåŠ¡ç«¯è·å–nacosç®¡ç†çš„é…ç½®ï¼Œå°†è¿™ä¸ªè·å–åˆ°çš„é…ç½®ä¸ä¹‹åè¯»å–çš„ application.yml ä½œåˆå¹¶ï¼Œæœ€åæ‰å®Œæ•´åœ°å¯åŠ¨é¡¹ç›®ã€‚</p><p>nacosæœåŠ¡ç«¯æ–°å»ºé…ç½®ï¼ŒIDç”±â€œæœåŠ¡å-ç¯å¢ƒ.åç¼€â€ç»„æˆæœ€å¥½ã€‚</p><p><img src="https://img1.imgtp.com/2022/10/16/wDZtkR8c.png" alt="è‡ªå®šä¹‰é…ç½®"></p><h3 id="Nacosé…ç½®ç®¡ç†çš„çƒ­æ›´æ–°"><a href="#Nacosé…ç½®ç®¡ç†çš„çƒ­æ›´æ–°" class="headerlink" title="Nacosé…ç½®ç®¡ç†çš„çƒ­æ›´æ–°"></a>Nacosé…ç½®ç®¡ç†çš„çƒ­æ›´æ–°</h3><h4 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h4><p>å“ªé‡Œä½¿ç”¨å°±ä¸ºé‚£é‡Œçš„ç±»æ·»åŠ çƒ­æ›´æ–°æ³¨é‡Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RefreshScope</span> <span class="comment">//åŠ è¿™ä¸ªæ³¨è§£æ‰èƒ½å®ç°é…ç½®çš„çƒ­æ›´æ–°</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String format;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/time&quot;)</span></span><br><span class="line">    String <span class="title function_">getTime</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(format));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹å¯¹@RefreshScopeçš„è§£é‡Šæ˜¯</p><blockquote><p>Convenience annotation to put a @Bean definition in refresh scope. Beans annotated this way can be refreshed at runtime and any components that are using them will get a new instance on the next method call, fully initialized and injected with all dependencies.</p></blockquote><h4 id="æ–¹å¼äºŒ-æ¨è"><a href="#æ–¹å¼äºŒ-æ¨è" class="headerlink" title="æ–¹å¼äºŒ(æ¨è)"></a>æ–¹å¼äºŒ(æ¨è)</h4><p>è‡ªå®šä¹‰é…ç½®ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kahvia.userservice.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span><span class="comment">//prefixæ˜¯å‰ç¼€çš„æ„æ€ï¼Œå‰ç¼€å’Œå±æ€§åæ‹¼æ¥ä¹‹åçš„å±æ€§è‹¥æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå°±å¯ä»¥å®ç°è‡ªåŠ¨æ³¨å…¥</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesFromNacos</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;<span class="comment">//å±æ€§åã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDateformat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dateformat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDateformat</span><span class="params">(String dateformat)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dateformat = dateformat;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@ConfigurationProperties(prefix &#x3D; â€œxxxâ€)æºç æ³¨é‡Š</p><blockquote><p>The prefix of the properties that are valid to bind to this object. Synonym for prefix(). A valid prefix is defined by one or more words separated with dots (e.g. â€œacme.system.featureâ€).<br>Returns: the prefix of the properties to bind</p></blockquote><p>ä½¿ç”¨è¯¥æ³¨é‡Šï¼Œéœ€è¦å¼•å…¥ä¾èµ–</p><blockquote><p>You can easily generate your own configuration metadata file from items annotated with <code>@ConfigurationProperties</code> by using the <code>spring-boot-configuration-processor</code> jar. The jar includes a Java annotation processor which is invoked as your project is compiled.</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¤šç¯å¢ƒå…±äº«é…ç½®"><a href="#å¤šç¯å¢ƒå…±äº«é…ç½®" class="headerlink" title="å¤šç¯å¢ƒå…±äº«é…ç½®"></a>å¤šç¯å¢ƒå…±äº«é…ç½®</h3><p>åœ¨nacosç®¡ç†é¡µé¢åˆ›å»ºé…ç½®æ–‡ä»¶çš„åå­—ï¼Œåªéœ€è¦ç”¨æœåŠ¡çš„åå­—å°±å¯ä»¥äº†ã€‚æ¯”å¦‚ï¼ŒUserService,è€Œä¸æ˜¯UserService-dev.</p><p>é¡¹ç›®å¯åŠ¨æ—¶ï¼Œä¼šåŒæ—¶ä»nacosè¯»å–ä¸Šè¿°ä¸¤ç§é…ç½®ï¼Œåè€…çš„ä¼˜å…ˆçº§å¤§äºå‰è€…ï¼Œå‰è€…å¤§äºæœ¬åœ°ã€‚åŒåå±æ€§åˆ™è¦†ç›–ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;Nacos&quot;&gt;&lt;a href=&quot;#Nacos&quot; class=&quot;headerlink&quot; title=&quot;Nacos&quot;&gt;&lt;/a&gt;Nacos&lt;/h3&gt;&lt;p&gt;ç”¨äºæ›¿ä»£å·²ç»åœæ­¢ç»´æŠ¤çš„ Eureka ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æœåŠ¡ç«¯&quot;&gt;&lt;a href=&quot;#æœåŠ¡ç«¯&quot; class=&quot;headerlink&quot; title=&quot;æœåŠ¡ç«¯&quot;&gt;&lt;/a&gt;æœåŠ¡ç«¯&lt;/h3&gt;&lt;p&gt;åœ¨&lt;a href=&quot;https://github.com/alibaba/nacos&quot;&gt;AlibabaNacos&lt;/a&gt;çš„é‡Œç¨‹ç¢‘ä¸­é€‰æ‹©ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½è§£å‹åï¼Œåœ¨ bin ç›®å½•ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥æŒ‡ä»¤å¯åŠ¨ã€‚Windows è¿è¡Œcmdæ–‡ä»¶ï¼ŒLinuxè¿è¡Œshæ–‡ä»¶&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;./startup.cmd -m standalone&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;é»˜è®¤æœåŠ¡ç«¯å£ä¸º8848ï¼Œå¯åœ¨ conf ç›®å½•ä¸‹é…ç½®æ–‡ä»¶ application.properties ä¸­æ›´æ”¹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="MicroService" scheme="https://blog.kahvia.cn/tags/MicroService/"/>
    
  </entry>
  
  <entry>
    <title>Springbooté¡¹ç›®æ‰“ jar åŒ…æ²¡æœ‰webappä¸­çš„é™æ€èµ„æº</title>
    <link href="https://blog.kahvia.cn/2022/10/07/SpringbootWithoutWebapp.html"/>
    <id>https://blog.kahvia.cn/2022/10/07/SpringbootWithoutWebapp.html</id>
    <published>2022-10-07T03:21:50.351Z</published>
    <updated>2022-10-24T04:13:33.074Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é—®é¢˜å‘ç”Ÿåœºæ™¯"><a href="#é—®é¢˜å‘ç”Ÿåœºæ™¯" class="headerlink" title="é—®é¢˜å‘ç”Ÿåœºæ™¯"></a>é—®é¢˜å‘ç”Ÿåœºæ™¯</h3><p>ä»¥ä¸‹åœºæ™¯éƒ½å»ºç«‹åœ¨ maven æ‰“ jar åŒ…çš„åŸºç¡€ä¸Šã€‚</p><p>æ˜¨æ—¥æˆ‘å¦‚å¾€å¸¸ä¸€æ ·ï¼Œåœ¨springbooté¡¹ç›®ä¸­æ–°å»º webapp æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨é‡Œé¢æ”¾ä¿©ç©ºæ–‡ä»¶å¤¹ï¼Œä½œä¸ºé¡¹ç›®é‡Œæ–‡ä»¶ä¸Šä¼ ä¸­è½¬çš„åœ°æ–¹ã€‚ç„¶åå‘ç°æ‰“åŒ…åç¨‹åºè¿è¡Œæ—¶å¹¶ä¸èƒ½æ‰¾åˆ°webappæ–‡ä»¶å¤¹ä¸­çš„é™æ€èµ„æºã€‚æŸ¥çœ‹ç¼–è¯‘åäº§ç”Ÿçš„ target ç›®å½•å‘ç°ï¼Œwebappå¹¶æ²¡æœ‰è¢«ç¼–è¯‘ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://img1.imgtp.com/2022/10/09/KyQk4s01.png" alt="webappæœªç¼–è¯‘"></p><p>è€Œå¹³æ—¶å¼€å‘ï¼Œç›´æ¥é€šè¿‡ idea è¿è¡Œçš„æ—¶å€™ï¼Œå´ä¼šç¼–è¯‘ webapp ä¸‹çš„èµ„æºæ–‡ä»¶åˆ° classes ç›®å½•ä¸‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://img1.imgtp.com/2022/10/09/0NJ4MtZB.png" alt="ideaç›´æ¥è¿è¡Œ"></p><span id="more"></span><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å¦‚æœè·Ÿæˆ‘ä¸€æ ·ä¸æ„¿æ„æ”¾å¼ƒ webapp çš„ä½¿ç”¨ï¼Œé‚£ä¹ˆæƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦æ‰‹åŠ¨æŒ‡å®šé¡¹ç›®æ„å»ºæ—¶çš„èµ„æºè·¯å¾„ã€‚</p><p>åœ¨ pom.xml æ–‡ä»¶çš„ build æ ‡ç­¾ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œæ‰‹åŠ¨æŒ‡å®šèµ„æºè·¯å¾„ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/webapp<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>META-INF/resources<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/**<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure><p>psï¼šè¿™æ ·åªæŒ‡å®šwebappçš„è·¯å¾„çš„è¯ï¼Œresource ä¸­çš„ static å’Œ template å°±ä¸ä¼šè¢«ç¼–è¯‘äº†ã€‚è¦æ˜¯éƒ½æƒ³è¦çš„è¯ï¼Œå°±å¾—éƒ½æ‰‹åŠ¨æŒ‡å®šã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œspringboot ä½¿ç”¨ mavenç¼–è¯‘æ—¶ï¼Œé»˜è®¤åªå¯»æ‰¾ resources ä¸­çš„é™æ€èµ„æºï¼Œè€Œå¿½ç•¥ webappã€‚</p><h3 id="é™„åŠ "><a href="#é™„åŠ " class="headerlink" title="é™„åŠ "></a>é™„åŠ </h3><p>è‡ªé—®ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¥å‰å­¦ä¹  spring mvc çš„æ—¶å€™ï¼Œç”¨ webapp æ–‡ä»¶å¤¹å­˜æ”¾é™æ€èµ„æºæ²¡æœ‰ä»»ä½•é—®é¢˜å‘¢ï¼Ÿ</p><p>è‡ªç­”ï¼šéè¦è¯´ springboot å’Œ spring mvc ç›´è§‚ä¸Šæœ‰å“ªé‡Œä¸å¤ªä¸€æ ·çš„è¯ï¼Œé‚£å°±æ˜¯æ‰“åŒ…æ–¹å¼äº†ã€‚ä»¥å‰å­¦ä¹  spring mvc çš„æ—¶å€™ï¼Œéƒ½æ˜¯æ‰“ war åŒ…ï¼Œç„¶åéƒ¨ç½²åˆ°è‡ªå·±çš„ tomcat æœåŠ¡å™¨ä¸Šã€‚é™æ€èµ„æºæ”¾åœ¨ webapp ä¸­ï¼Œè€Œæˆ‘ä¼¼ä¹ä¹Ÿä¸€ç›´æ˜¯è¿™ä¹ˆç”¨çš„ã€‚ä½†æ˜¯å½“æˆ‘å­¦äº†spring bootåï¼Œé¡¹ç›®éƒ½æ˜¯åœ¨æœ¬åœ°çš„ideaç›´æ¥è¿è¡Œï¼Œå¹¶æ²¡æœ‰æ­£å„¿å…«ç»æ‰“åŒ…ï¼Œç„¶åæ‰‹åŠ¨éƒ¨ç½²è¿‡ã€‚å› ä¸º idea è‡ªèº«ä¼šç¼–è¯‘ webapp ä¸‹çš„æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æœ‰å‘ç°è¿‡é—®é¢˜ã€‚</p><p>æ‰€ä»¥å¦ä¸€ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯æŠŠ spring boot æ‰“æˆ war åŒ…ã€‚</p><h3 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h3><p>ç©¶å…¶åŸå› è¿˜æ˜¯é¡¹ç›®æ‰“æˆ jar åŒ…å’Œ war åŒ…çš„åŒºåˆ«ã€‚è¿™é‡Œé‡‡ç”¨ç½‘ä¸Šçš„æè¿°ã€‚</p><ul><li><p>jaræ–‡ä»¶åŒ…æ‹¬javaæ™®é€šç±»ã€èµ„æºæ–‡ä»¶å’Œæ™®é€šæ–‡ä»¶ï¼Œåœ¨mavenä¸­å³æ˜¯æ‰“åŒ… src&#x2F;main&#x2F;java å’Œ src&#x2F;main&#x2F;resources èµ„æºæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚åœ¨æ‰“åŒ…çš„æ—¶å€™ä¼šè‡ªåŠ¨ç”Ÿæˆ META-INF æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜å‚¨ maven çš„ pom ä¿¡æ¯å’Œ MANIFEST.MF æ–‡ä»¶ã€‚ï¼ˆæœªåŒ…å« webapp æ–‡ä»¶å¤¹ï¼‰</p></li><li><p>waræ–‡ä»¶åŒ…å«å…¨éƒ¨çš„webåº”ç”¨ç¨‹åºï¼Œå³æ‰€æœ‰çš„javaç±»ï¼Œé…ç½®ä¿¡æ¯å’Œjspã€jsç­‰é™æ€èµ„æºã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´ webapp æ–‡ä»¶å¤¹ä¹ŸåŒ…å«äº†ï¼‰</p></li></ul><p>æˆ–è®¸è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå­¦ä¹  spring mvc çš„æ—¶å€™æˆ‘è¿˜åœ¨å‰åç«¯ä¸€ä½“ï¼Œ è€Œå­¦ä¹  spring boot åå´ä¸‹æ„è¯†çš„ç”¨èµ·äº†å‰åç«¯åˆ†ç¦»å§ã€‚ç å†œçš„ç›´è§‰ï¼Ÿ</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;é—®é¢˜å‘ç”Ÿåœºæ™¯&quot;&gt;&lt;a href=&quot;#é—®é¢˜å‘ç”Ÿåœºæ™¯&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜å‘ç”Ÿåœºæ™¯&quot;&gt;&lt;/a&gt;é—®é¢˜å‘ç”Ÿåœºæ™¯&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹åœºæ™¯éƒ½å»ºç«‹åœ¨ maven æ‰“ jar åŒ…çš„åŸºç¡€ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ˜¨æ—¥æˆ‘å¦‚å¾€å¸¸ä¸€æ ·ï¼Œåœ¨springbooté¡¹ç›®ä¸­æ–°å»º webapp æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨é‡Œé¢æ”¾ä¿©ç©ºæ–‡ä»¶å¤¹ï¼Œä½œä¸ºé¡¹ç›®é‡Œæ–‡ä»¶ä¸Šä¼ ä¸­è½¬çš„åœ°æ–¹ã€‚ç„¶åå‘ç°æ‰“åŒ…åç¨‹åºè¿è¡Œæ—¶å¹¶ä¸èƒ½æ‰¾åˆ°webappæ–‡ä»¶å¤¹ä¸­çš„é™æ€èµ„æºã€‚æŸ¥çœ‹ç¼–è¯‘åäº§ç”Ÿçš„ target ç›®å½•å‘ç°ï¼Œwebappå¹¶æ²¡æœ‰è¢«ç¼–è¯‘ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img1.imgtp.com/2022/10/09/KyQk4s01.png&quot; alt=&quot;webappæœªç¼–è¯‘&quot;&gt;&lt;/p&gt;
&lt;p&gt;è€Œå¹³æ—¶å¼€å‘ï¼Œç›´æ¥é€šè¿‡ idea è¿è¡Œçš„æ—¶å€™ï¼Œå´ä¼šç¼–è¯‘ webapp ä¸‹çš„èµ„æºæ–‡ä»¶åˆ° classes ç›®å½•ä¸‹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img1.imgtp.com/2022/10/09/0NJ4MtZB.png&quot; alt=&quot;ideaç›´æ¥è¿è¡Œ&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="å°é—®é¢˜" scheme="https://blog.kahvia.cn/categories/%E5%B0%8F%E9%97%AE%E9%A2%98/"/>
    
    
    <category term="Springboot" scheme="https://blog.kahvia.cn/tags/Springboot/"/>
    
  </entry>
  
  <entry>
    <title>MicroService-Eureka</title>
    <link href="https://blog.kahvia.cn/2022/10/05/MicroserviceEureka.html"/>
    <id>https://blog.kahvia.cn/2022/10/05/MicroserviceEureka.html</id>
    <published>2022-10-05T06:36:11.655Z</published>
    <updated>2022-10-24T04:13:33.066Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h3><p>å¾®æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒã€‚</p><h3 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h3><p>1.æ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.åº”ç”¨å¯åŠ¨å…¥å£æ ‡æ³¨@EnableEurekaServer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaServerDemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaServerDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.åœ¨ application.yml ä¸­é…ç½®ç›¸å…³ä¿¡æ¯</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">eurekaServer</span> <span class="comment"># åº”ç”¨è‡ªå·±çš„åç§°ï¼Œä¼šåœ¨eurekaä¸­æ³¨å†Œåæ˜¾ç¤º</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost/eureka</span> <span class="comment"># eurekaçš„æœåŠ¡ç«¯åœ°å€</span></span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><p>1.æ·»åŠ ä¾èµ–(è‹¥æ˜¯ä¾èµ–ç®¡ç†ä¸­æ²¡æœ‰å®¢æˆ·ç«¯çš„ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦åƒä¸‹é¢è¿™æ ·æ‰‹åŠ¨æ·»åŠ ï¼Œç‰ˆæœ¬æœ€å¥½è·ŸæœåŠ¡ç«¯ä¿æŒä¸€è‡´)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.åœ¨ application.yml ä¸­é…ç½®ç›¸å…³ä¿¡æ¯</p><p>ä¿®æ”¹ç«¯å£å’Œåº”ç”¨åç§°ï¼Œeurekaçš„æœåŠ¡ç«¯åœ°å€ä¿æŒä¸å˜ã€‚</p><h3 id="è¿œç¨‹è°ƒç”¨"><a href="#è¿œç¨‹è°ƒç”¨" class="headerlink" title="è¿œç¨‹è°ƒç”¨"></a>è¿œç¨‹è°ƒç”¨</h3><p>æœåŠ¡çš„è¿œç¨‹è°ƒç”¨åŒ…å«ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼šè°ƒç”¨æœåŠ¡çš„æ˜¯æ¶ˆè´¹è€…ï¼Œè¢«è°ƒç”¨æœåŠ¡çš„æ˜¯æä¾›è€…ã€‚ä¸€ä¸ªå®¢æˆ·ç«¯å¯ç”¨åŒæ—¶æ˜¯æ¶ˆè´¹è€…å’Œæä¾›è€…ã€‚</p><p>è¿œç¨‹è°ƒç”¨æœåŠ¡å¯ä½¿ç”¨ RestTemplate ç±»çš„å®ä¾‹çš„ getObject æ–¹æ³•ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘å†™ä¸€ä¸ªå·¥å…·ç±»ã€‚å°†æ„å»º RestTemplate å®ä½“çš„å·¥å‚å‡½æ•°æ³¨å†Œä¸º beanã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kahvia.imageservice.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨æœ‰éœ€è¦çš„åœ°æ–¹è‡ªåŠ¨è£…é…ä¸€ä¸ª RestTemplate å¯¹è±¡ï¼Œè°ƒç”¨å®ƒçš„å„ç§è¯·æ±‚æ–¹æ³•å°±è¡Œäº†ã€‚postç¤ºä¾‹å¦‚ä¸‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kahvia.imageservice.controller;</span><br><span class="line"><span class="keyword">import</span> cn.kahvia.imageservice.pojo.UploadResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.FileSystemResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.LinkedMultiValueMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.MultiValueMap;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/image&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">uploadImg</span><span class="params">(MultipartFile file, HttpServletRequest request)</span>&#123;</span><br><span class="line">        String path=request.getServletContext().getRealPath(<span class="string">&quot;&quot;</span>);<span class="comment">//è·å–å½“å‰servletä¸Šä¸‹æ–‡çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">        File temp=<span class="keyword">new</span> <span class="title class_">File</span>(path,file.getOriginalFilename());<span class="comment">//åœ¨è¿™ä¸ªè·¯å¾„ä¸‹æ–°å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶temp</span></span><br><span class="line">        <span class="keyword">try</span> &#123;<span class="comment">//æ¥å—ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¾€tempä¸­è¾“å‡º</span></span><br><span class="line">            InputStream inputStream=file.getInputStream();</span><br><span class="line">            FileOutputStream fileOutputStream=<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(temp);</span><br><span class="line">            BufferedOutputStream bufferedOutputStream=<span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(fileOutputStream);</span><br><span class="line">            <span class="type">int</span> n=<span class="number">0</span>;</span><br><span class="line">            <span class="type">byte</span> b[] = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];<span class="comment">//1024ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±1024byteï¼Œå³1kb</span></span><br><span class="line">            <span class="keyword">while</span> ((n=inputStream.read(b))!=-<span class="number">1</span>)<span class="comment">//read(b)ï¼Œæ˜¯è¯´ä»è¾“å…¥æµä¸­è¯»å–â€œbçš„å¤§å°â€è¿™ä¹ˆå¤šçš„æ•°æ®åˆ°bä¸­ï¼Œå¹¶è¿”å›è¯»å–çš„å­—èŠ‚ä¸ªæ•°ï¼Œ-1ä»£è¡¨è¯»å–å®Œäº†</span></span><br><span class="line">            &#123;</span><br><span class="line">                bufferedOutputStream.write(b);<span class="comment">//æŠŠè¯»å–åˆ°çš„çš„ï¼Œå­˜æ”¾åœ¨bä¸­çš„æ•°æ®å†™å…¥åˆ°è¾“å‡ºæµæŒ‡å‘çš„æ–‡ä»¶ä¸­</span></span><br><span class="line">            &#125;</span><br><span class="line">            bufferedOutputStream.flush();<span class="comment">//åˆ·æ–°ç¼“å­˜åŒºï¼Œåˆ·æ–°åï¼Œç¼“å†²è¾“å‡ºæµæŒ‡å‘çš„åº•å±‚è¾“å…¥æµï¼Œå³fileOutputStreamä¼šç«‹å³å°†ç¼“å­˜çš„å†…å®¹å†™å…¥ç›®çš„åœ°</span></span><br><span class="line">            bufferedOutputStream.close();<span class="comment">//å…ˆå…³é—­ä¸Šå±‚è¾“å‡ºæµ</span></span><br><span class="line">            inputStream.close();<span class="comment">//å†å…³é—­åº•å±‚è¾“å‡ºæµã€‚æŒ‰ç†è¯´å…³äº†ä¸Šå±‚ï¼Œåº•å±‚ä¹Ÿä¼šè‡ªåŠ¨å…³ã€‚</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å®šä¹‰ä¸€ä¸ªç©ºçš„mapï¼Œç”¨æ¥å­˜å‚¨è¯·æ±‚ç¬¬ä¸‰æ–¹æ¥å£æ‰€éœ€çš„æ•°æ®</span></span><br><span class="line">        MultiValueMap&lt;String,Object&gt; map= <span class="keyword">new</span> <span class="title class_">LinkedMultiValueMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//åˆ©ç”¨åˆšåˆšç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶ï¼Œåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿèµ„æº</span></span><br><span class="line">        FileSystemResource fileSystemResource=<span class="keyword">new</span> <span class="title class_">FileSystemResource</span>(temp);</span><br><span class="line">        <span class="comment">//æ·»åŠ åˆ°æ•°æ®mapä¸­ï¼Œç¬¬ä¸‰æ–¹æ‰€éœ€çš„å‚æ•°åä¸ºimage</span></span><br><span class="line">        map.add(<span class="string">&quot;image&quot;</span>,fileSystemResource);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®è¯·æ±‚å¤´ï¼ŒåŒ…æ‹¬è®¿é—®çš„æµè§ˆå™¨ï¼Œå’Œè¯·æ±‚ä½“å†…å®¹å›ºå®šç±»å‹ï¼Œä¼ è¾“æ–‡ä»¶è¦é€‰æ‹©è¡¨å•æ•°æ®&quot;multipart/form-data&quot;</span></span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">        headers.add(<span class="string">&quot;user-agent&quot;</span>, <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&quot;</span>);</span><br><span class="line">        headers.add(<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;multipart/form-data&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”Ÿæˆhttpè¯·æ±‚</span></span><br><span class="line">        HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; entity=<span class="keyword">new</span> <span class="title class_">HttpEntity</span>&lt;&gt;( map,headers);</span><br><span class="line">        <span class="comment">//å‘é€httpè¯·æ±‚ï¼Œè¿”å›ç›®æ ‡å¯¹è±¡ã€‚è¿”å›çš„jsonæ•°æ®ä¼šè‡ªåŠ¨å°è£…ä¸ºç›®æ ‡å¯¹è±¡ã€‚</span></span><br><span class="line">        UploadResult uploadResult= restTemplate.postForObject(<span class="string">&quot;https://xxxxxx/api/upload&quot;</span>,entity,UploadResult.class);</span><br><span class="line">        temp.delete();<span class="comment">//åˆ é™¤ä¸­è½¬æ–‡ä»¶</span></span><br><span class="line">        System.out.println(uploadResult.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h3><p>ä¸º RestTemplate çš„å·¥å‚å‡½æ•°æ·»åŠ  @LoadBalancedæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.kahvia.imageservice.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateUtil</span> &#123;</span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸç†ï¼šè¿œç¨‹è°ƒç”¨å…¶å®ƒæœåŠ¡ç«¯çš„æ¥å£æ—¶ï¼Œå‘å‡ºçš„è¯·æ±‚ä¼šè¢«æ‹¦æˆªï¼Œç„¶åæ ¹æ®è¯·æ±‚çš„åœ°å€è·å–ä¸»æœºåï¼ˆå¦‚æœæ˜¯eurekaæœåŠ¡è·å–åˆ°çš„å°±æ˜¯æœåŠ¡åï¼‰ï¼Œè·å–åˆ°æœåŠ¡ååå†å»eurekaæ³¨å†Œä¸­å¿ƒä¸­å–å¾—å¯¹åº”æœåŠ¡åçš„æ‰€æœ‰æœåŠ¡ç«¯åœ°å€ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡è½®è¯¢æˆ–è€…éšæœºçš„è§„åˆ™é€‰å–ä¸€ä¸ªåˆé€‚çš„åœ°å€ï¼Œæ›¿æ¢è¯·æ±‚çš„åœ°å€ä¸­çš„æœåŠ¡ååï¼Œå†æ”¾è¡Œï¼Œä»è€Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><h3 id="è´Ÿè½½å‡è¡¡çš„ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡çš„ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡çš„ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡çš„ç­–ç•¥</h3><ul><li>RoundRobinRuleï¼šç®€å•çš„è½®è¯¢ã€‚Ribboné»˜è®¤ç­–ç•¥ã€‚</li><li>ZoneAvoidanceRuleï¼šä»¥åŒºåŸŸä¸ºåŸºç¡€ï¼Œè¿›è¡ŒæœåŠ¡å™¨çš„é€‰æ‹©ã€‚ä½¿ç”¨Zoneè¿›è¡Œåˆ†ç±»ã€‚</li><li>RandomRuleï¼šéšæœºã€‚</li><li>RetryRuleï¼šé‡è¿ã€‚</li><li>AvailabilityFilteringRuleï¼ŒBestAvailableRuleï¼ŒWeightedResponseTimeRuleç­‰</li></ul><p>å…¨å±€ç­–ç•¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…¨å±€é…ç½®ï¼Œå¯¹æ‰€æœ‰å¾®æœåŠ¡æœ‰æ•ˆ</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateUtil</span> &#123;</span><br><span class="line">    <span class="meta">@LoadBalanced</span><span class="comment">//ä½¿ç”¨è´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IRule <span class="title function_">setBalanceRule</span><span class="params">()</span>&#123;<span class="comment">//è®¾ç½®ç­–ç•¥</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BestAvailableRule</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å±€éƒ¨ç­–ç•¥</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">UserService:</span> <span class="comment">#ä¸ºæŸä¸ªå¾®æœåŠ¡é…ç½®è´Ÿè½½å‡è¡¡çš„è§„åˆ™</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RandomRule</span></span><br></pre></td></tr></table></figure><h3 id="Ribbonä¿®æ”¹é¥¥é¥¿åŠ è½½"><a href="#Ribbonä¿®æ”¹é¥¥é¥¿åŠ è½½" class="headerlink" title="Ribbonä¿®æ”¹é¥¥é¥¿åŠ è½½"></a>Ribbonä¿®æ”¹é¥¥é¥¿åŠ è½½</h3><p>Ribboné»˜è®¤æ˜¯æ‡’åŠ è½½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒRibbonæä¾›çš„è´Ÿè½½å‡è¡¡çš„æœåŠ¡ LoadBalancerClient å¹¶ä¸ä¼šéšç€æœåŠ¡ç«¯å¯åŠ¨è€Œå¯åŠ¨ã€‚ç¬¬ä¸€æ¬¡è¯·æ±‚è¿œç¨‹è°ƒç”¨æ—¶ï¼Œä¼šåˆå§‹åŒ–è´Ÿè½½å‡è¡¡æœåŠ¡ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡ä¼šæ¯”è¾ƒæ…¢ã€‚</p><p>å¦‚æœæƒ³è¦è®©è´Ÿè½½å‡è¡¡æœåŠ¡éšç€æœåŠ¡ç«¯å¯åŠ¨è€Œå¯åŠ¨ï¼Œå°±éœ€è¦è®¾ç½®é¥¥é¥¿åŠ è½½ã€‚åœ¨ application.yml æ–‡ä»¶ä¸­é…ç½®é¥¥é¥¿åŠ è½½ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#å¼€å¯é¥¥é¥¿åŠ è½½ï¼Œå‡å°‘ç¬¬ä¸€æ¬¡è¿œç¨‹è°ƒç”¨çš„æ—¶é—´</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="string">UserService</span> <span class="comment">#é¥¥é¥¿åŠ è½½çš„åç§°,å¤šä¸ªåˆ™æ¢è¡Œä»¥-å¼€å¤´åˆ†éš”</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;Eureka&quot;&gt;&lt;a href=&quot;#Eureka&quot; class=&quot;headerlink&quot; title=&quot;Eureka&quot;&gt;&lt;/a&gt;Eureka&lt;/h3&gt;&lt;p&gt;å¾®æœåŠ¡çš„æ³¨å†Œä¸­å¿ƒã€‚&lt;/p&gt;
&lt;h3 id=&quot;æœåŠ¡ç«¯&quot;&gt;&lt;a href=&quot;#æœåŠ¡ç«¯&quot; class=&quot;headerlink&quot; title=&quot;æœåŠ¡ç«¯&quot;&gt;&lt;/a&gt;æœåŠ¡ç«¯&lt;/h3&gt;&lt;p&gt;1.æ·»åŠ ä¾èµ–&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-cloud-starter-netflix-eureka-server&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;2.åº”ç”¨å¯åŠ¨å…¥å£æ ‡æ³¨@EnableEurekaServer&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@EnableEurekaServer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@SpringBootApplication&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;EurekaServerDemoApplication&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SpringApplication.run(EurekaServerDemoApplication.class, args);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;3.åœ¨ application.yml ä¸­é…ç½®ç›¸å…³ä¿¡æ¯&lt;/p&gt;
&lt;figure class=&quot;highlight yaml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;server:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;port:&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;80&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;spring:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;application:&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;eurekaServer&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# åº”ç”¨è‡ªå·±çš„åç§°ï¼Œä¼šåœ¨eurekaä¸­æ³¨å†Œåæ˜¾ç¤º&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;eureka:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;attr&quot;&gt;client:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;service-url:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;attr&quot;&gt;defaultZone:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;http://localhost/eureka&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# eurekaçš„æœåŠ¡ç«¯åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="MicroService" scheme="https://blog.kahvia.cn/tags/MicroService/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-TextFormField</title>
    <link href="https://blog.kahvia.cn/2022/10/01/FlutterTextFormField.html"/>
    <id>https://blog.kahvia.cn/2022/10/01/FlutterTextFormField.html</id>
    <published>2022-10-01T03:01:39.421Z</published>
    <updated>2022-10-24T04:13:33.053Z</updated>
    
    <content type="html"><![CDATA[<h3 id="TextFormField"><a href="#TextFormField" class="headerlink" title="TextFormField"></a>TextFormField</h3><ul><li>decorationï¼šä½¿ç”¨ InputDecoration æ¥åˆ›å»ºæ–‡æœ¬æ¡†</li><li>controllerï¼šæŒ‡å®š TextEditingController å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡æ¥è·å–æ–‡æœ¬æ¡†çš„å€¼</li></ul><h4 id="InputDecoration"><a href="#InputDecoration" class="headerlink" title="InputDecoration"></a>InputDecoration</h4><ul><li>focusedBorderï¼šæ–‡æœ¬æ¡†èšç„¦çš„æ—¶å€™çš„è¾¹æ¡†æ ·å¼</li><li>disabledBorderï¼šç¦æ­¢è¾“å…¥æ—¶</li><li>enabledBorderï¼šå…è®¸é€‰ä¸­æ—¶</li><li>contentPaddingï¼šæ–‡æœ¬åŒºå®é™…ä¸Šæ˜¯ç”± InputDecoration åˆ›å»ºçš„ï¼Œè€Œæ­¤å¤„çš„ padding å°±æ˜¯è®¾ç½®çš„è¿™ä¸ªæ–‡æœ¬åŒºçš„ padding</li><li>borderï¼šè®¾ç½®ä¸º Border.none å¯ä»¥ä¸æ¸²æŸ“è¾¹æ¡†ã€‚ä½†æ˜¯å¸¸å¸¸ä¼šé€ æˆæ–‡æœ¬æ¡†å†…å®¹ä¸èƒ½å±…ä¸­ã€‚</li><li>hintTextï¼šè¾“å…¥æ¡†çš„æç¤ºå­—æ®µï¼Œç±»ä¼¼äº html ä¸­çš„ placeholder</li></ul><p>psï¼šæƒ³è¦è¾“å…¥æ¡†çš„å†…å®¹æ­£å¸¸çš„å‚ç›´å±…ä¸­ï¼Œå°±éœ€è¦è¾¹æ¡†ï¼Œä¸æƒ³è¦æ ·å¼çš„è¯ï¼Œå¯ä»¥è®¾ç½®è¾¹æ¡†ä¸ºé€æ˜è‰²ï¼Œå®½åº¦ä¸º0ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦è®¾ç½® contentPadding ä¸º0æ‰èƒ½ä¿è¯ç»å¯¹å‚ç›´å±…ä¸­ã€‚</p><p>ä»£ç åŒº</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">TextFormField(</span><br><span class="line">  decoration: <span class="keyword">const</span> InputDecoration(</span><br><span class="line">    focusedBorder: OutlineInputBorder(</span><br><span class="line">        borderSide: BorderSide(width: <span class="number">0</span>, color: Colors.transparent)),</span><br><span class="line">    disabledBorder: OutlineInputBorder(</span><br><span class="line">        borderSide: BorderSide(width: <span class="number">0</span>, color: Colors.transparent)),</span><br><span class="line">    enabledBorder: OutlineInputBorder(</span><br><span class="line">        borderSide: BorderSide(width: <span class="number">0</span>, color: Colors.transparent)),</span><br><span class="line">    contentPadding: EdgeInsets.symmetric(vertical: <span class="number">0</span>),</span><br><span class="line">    hintText: <span class="string">&quot;æ¶ˆæ¯&quot;</span>,</span><br><span class="line">  ),</span><br><span class="line">  controller: textEditingController,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;TextFormField&quot;&gt;&lt;a href=&quot;#TextFormField&quot; class=&quot;headerlink&quot; title=&quot;TextFormField&quot;&gt;&lt;/a&gt;TextFormField&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;decorationï¼šä½¿ç”¨ InputD</summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-è´­ç‰©å°æµ‹è¯•</title>
    <link href="https://blog.kahvia.cn/2022/09/29/FlutterGoodsStoreDemo.html"/>
    <id>https://blog.kahvia.cn/2022/09/29/FlutterGoodsStoreDemo.html</id>
    <published>2022-09-29T11:29:15.301Z</published>
    <updated>2022-10-24T04:13:33.029Z</updated>
    
    <content type="html"><![CDATA[<p> åœ¨å­¦ä¹  Provider çš„æ—¶å€™ï¼Œæˆ‘åœ¨ flutter çš„å®˜æ–¹å°æ•™ç¨‹ä¸­ï¼Œçœ‹åˆ°äº†ä¸€ä¸ª demoï¼Œæœ‰å…³è´­ä¹°å•†å“ï¼ŒåŠ å…¥è´­ç‰©è½¦çš„ã€‚åˆšå­¦ä¹  Provider çš„æ—¶å€™ï¼Œå¾ˆå¤šåœ°æ–¹ä¸æ˜ç™½ï¼Œæ‰€ä»¥é‚£ä¸ªæ¡ˆä¾‹ä¹Ÿæ²¡æœ‰èƒ½å¤Ÿç†è§£ã€‚</p><p>ä»Šå¤©çš„æˆ‘å·²ç»èƒ½ä½¿ç”¨ Navigator å’Œ Provider çš„çŸ¥è¯†äº†ã€‚åˆ©ç”¨æˆ‘å·²æœ‰çš„çŸ¥è¯†ï¼Œå¯ä»¥å¤§æ¦‚æ¨¡ä»¿å‡ºå®˜æ–¹ demo çš„æ ·å­äº†ã€‚</p><h3 id="è·¯ç”±åˆ†æ"><a href="#è·¯ç”±åˆ†æ" class="headerlink" title="è·¯ç”±åˆ†æ"></a>è·¯ç”±åˆ†æ</h3><p>è¿™ä¸ª demo æ¶‰åŠåˆ°ä¸‰ä¸ªé¡µé¢ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç™»å½•ç•Œé¢ï¼Œç¬¬äºŒä¸ªæ˜¯å•†å“ç•Œé¢ï¼Œç¬¬ä¸‰ä¸ªæ˜¯è´­ç‰©è½¦ç•Œé¢ã€‚</p><p>åˆ†åˆ«å‘½åä¸ºï¼šLogin, Catalog, Cart</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dayly/Login.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dayly/Catalog.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dayly/Cart.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> routes=&#123;</span><br><span class="line">  <span class="string">&#x27;login&#x27;</span>:(context) =&gt; <span class="keyword">const</span> Login(),</span><br><span class="line">  <span class="string">&quot;catalog&quot;</span>:(context) =&gt; <span class="keyword">const</span> Catalog(),</span><br><span class="line">  <span class="string">&quot;cart&quot;</span>:(context) =&gt; <span class="keyword">const</span> Cart(),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="å…±äº«æ•°æ®"><a href="#å…±äº«æ•°æ®" class="headerlink" title="å…±äº«æ•°æ®"></a>å…±äº«æ•°æ®</h3><p>å»ºç«‹æ•°æ®æ¨¡å‹</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoodsModel</span> <span class="keyword">extends</span> <span class="title">ChangeNotifier</span></span>&#123;<span class="comment">//å…±äº«æ•°æ®çš„æ•°æ®æ¨¡å‹</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; _itemNames = [<span class="comment">//æ¨¡æ‹Ÿæ•°æ®ï¼Œå•†å“åç§°</span></span><br><span class="line">    <span class="string">&#x27;Code Smell&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Control Flow&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Interpreter&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Recursion&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Sprint&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Heisenbug&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Spaghetti&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Hydra Code&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Off-By-One&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Scope&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Callback&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Closure&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Automata&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Bit Shift&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Currying&#x27;</span>,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">bool</span>&gt; _isSelected=<span class="built_in">List</span>.generate(<span class="number">15</span>, (index) =&gt; <span class="keyword">false</span>);<span class="comment">//éƒ½è®¾ç½®ä¸ºæœªåŠ å…¥è´­ç‰©è½¦</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; _selectedItems=[];<span class="comment">//å·²é€‰ä¸­çš„å•†å“åç§°</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span> <span class="keyword">get</span> itemNames=&gt;_itemNames;<span class="comment">//æš´éœ²ä»¥ä¸Šç§æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line">  <span class="built_in">List</span> <span class="keyword">get</span> selectedItems=&gt;_selectedItems;</span><br><span class="line">  <span class="built_in">List</span> <span class="keyword">get</span> isSelected=&gt;_isSelected;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> selectItem(<span class="built_in">int</span> id)&#123;<span class="comment">//åŠ å…¥è´­ç‰©è½¦</span></span><br><span class="line">    _selectedItems.add(_itemNames[id]);</span><br><span class="line">    _isSelected[id]=<span class="keyword">true</span>;</span><br><span class="line">    notifyListeners();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> unselectItem(<span class="built_in">int</span> id)&#123;<span class="comment">//ç§»å‡ºè´­ç‰©è½¦</span></span><br><span class="line">    _selectedItems.remove(_itemNames[id]);</span><br><span class="line">    _isSelected[id]=<span class="keyword">false</span>;</span><br><span class="line">    notifyListeners();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†æ•°æ®æ¨¡å‹æ”¾ç½®åœ¨é«˜çº§èŠ‚ç‚¹ä¸Šï¼Œä½¿å…¶å­å­™ç»„ä»¶éƒ½èƒ½è®¿é—®å…±äº«æ•°æ®ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> MyApp(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ChangeNotifierProvider(<span class="comment">//ä½¿ç”¨å…±äº«æ•°æ®</span></span><br><span class="line">      create: (context)=&gt;GoodsModel(),</span><br><span class="line">      child: MaterialApp(</span><br><span class="line">        title: <span class="string">&quot;Store&quot;</span>,</span><br><span class="line">        debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">        routes: routes,<span class="comment">//è®¾ç½®è·¯ç”±</span></span><br><span class="line">        initialRoute: <span class="string">&#x27;login&#x27;</span>,<span class="comment">//é»˜è®¤è·¯ç”±ï¼Œå³appé¦–é¡µ</span></span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h3><p>ç®€å•çš„ç™»å½•ç•Œé¢å®ç°ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> Login(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(<span class="comment">//æ ‡å‡†ç»“æ„</span></span><br><span class="line">      body: Center(<span class="comment">//æ•´ä½“å±…ä¸­ï¼Œå½“ç„¶äº†ï¼Œåªæ˜¯å®ƒçš„å­ç»„ä»¶å±…ä¸­ï¼Œæ°´å¹³å’Œå‚ç›´</span></span><br><span class="line">        child: Container(<span class="comment">//æœ‰å­ç»„ä»¶åˆ™åŒ¹é…å­ç»„ä»¶çš„å¤§å°ï¼Œæ²¡æœ‰å­ç»„ä»¶åˆ™çœ‹çˆ¶çº§æœ‰æ— ä¼ é€’çº¦æŸï¼Œæœ‰çº¦æŸåˆ™éƒ½å°½å¯èƒ½å¤§ï¼Œå¦‚æœè¿™ä¸ªçº¦æŸæ˜¯æ— é™ï¼Œé‚£å°±å°½å¯èƒ½å°ã€‚è‡ªå·±è®¾å®šçš„å®½é«˜ä¼šè¦†ç›–å‰é¢æ‰€è¯´çš„å¤§å°ã€‚</span></span><br><span class="line">          padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">50</span>),<span class="comment">//åŠ ä¸ªå†…è¾¹è·</span></span><br><span class="line">          color: Colors.white70,</span><br><span class="line">          child: Column(<span class="comment">//Columnä¼šå æ»¡å¯ç”¨ç©ºé—´</span></span><br><span class="line">            mainAxisAlignment: MainAxisAlignment.center,<span class="comment">//æƒ³è®©ç™»å½•ä¿¡æ¯çš„éƒ¨åˆ†å±…ä¸­å°±è¦è¿™æ ·åšè®¾ç½®ï¼Œå› ä¸ºä¸Šé¢çš„Centeråªæ˜¯è®©Columnçš„çˆ¶çº§å±…ä¸­äº†</span></span><br><span class="line">              children: [</span><br><span class="line">                <span class="keyword">const</span> Text(</span><br><span class="line">                  <span class="string">&#x27;Welcome&#x27;</span>,</span><br><span class="line">                  style: TextStyle(</span><br><span class="line">                    color: Colors.black,</span><br><span class="line">                    fontSize: <span class="number">30</span>,</span><br><span class="line">                    fontWeight: FontWeight.bold,<span class="comment">//æ ‡é¢˜åŠ ç²—</span></span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                TextFormField(</span><br><span class="line">                  decoration: <span class="keyword">const</span> InputDecoration(</span><br><span class="line">                    hintText: <span class="string">&#x27;Username&#x27;</span>,<span class="comment">//è®¾ç½®å ä½ä¿¡æ¯</span></span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                TextFormField(</span><br><span class="line">                  decoration: <span class="keyword">const</span> InputDecoration(</span><br><span class="line">                    hintText: <span class="string">&#x27;Password&#x27;</span>,</span><br><span class="line">                  ),</span><br><span class="line">                  obscureText: <span class="keyword">true</span>,<span class="comment">//æ¨¡ç³Šæ–‡æœ¬ï¼Œä¹Ÿå°±æ˜¯éšè—æ–‡æœ¬ä¿¡æ¯ï¼Œå¯†ç æ¡†å˜›</span></span><br><span class="line">                ),</span><br><span class="line">                <span class="keyword">const</span> SizedBox(<span class="comment">//å ä½çš„ç©ºç™½ç»„ä»¶</span></span><br><span class="line">                  height: <span class="number">24</span>,</span><br><span class="line">                ),</span><br><span class="line">                ElevatedButton(<span class="comment">//æ™®é€šçš„æŒ‰é’®</span></span><br><span class="line">                  onPressed: () &#123;</span><br><span class="line">                    Navigator.pushNamed(context, <span class="string">&#x27;catalog&#x27;</span>);<span class="comment">//ç™»å½•è·³è½¬</span></span><br><span class="line">                  &#125;,</span><br><span class="line">                  style: ButtonStyle(</span><br><span class="line">                    backgroundColor: MaterialStateProperty.all(Colors.black)<span class="comment">//è®¾ç½®èƒŒæ™¯è‰²</span></span><br><span class="line">                  ),</span><br><span class="line">                  child: <span class="keyword">const</span> Text(<span class="string">&#x27;ENTER&#x27;</span>),</span><br><span class="line">                )</span><br><span class="line">              ],</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line"></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img1.imgtp.com/2022/09/29/iVZdZmjK.png" alt="ç™»å½•ç•Œé¢"></p><h3 id="Catalog"><a href="#Catalog" class="headerlink" title="Catalog"></a>Catalog</h3><p>å•†å“ç›®å½•ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dayly/main.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:provider/provider.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Catalog</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> Catalog(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; itemNames = context.read&lt;GoodsModel&gt;().itemNames <span class="keyword">as</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;;<span class="comment">//è·å–å…±äº«æ•°æ®ä¸­çš„å•†å“åç§°</span></span><br><span class="line">    <span class="comment">//æ ¹æ®å•†å“åç§°ç”Ÿæˆæ¯ä¸€è¡Œçš„å•†å“ä¿¡æ¯ã€‚åŒ…æ‹¬äº†å•†å“çš„å›¾ç‰‡ï¼ˆè¿™é‡Œç”¨éšæœºé¢œè‰²ä»£æ›¿ï¼‰ï¼Œå•†å“idï¼Œå•†å“åç§°ã€‚å•†å“ç±»æ˜¯è‡ªå®šä¹‰çš„ã€‚</span></span><br><span class="line">    <span class="built_in">List</span>&lt;Good&gt; goods=<span class="built_in">List</span>.generate(itemNames.length, (index) =&gt; Good(color: Colors.primaries[index],id: index,name: itemNames[index],));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        backgroundColor: Colors.black,</span><br><span class="line">        title: <span class="keyword">const</span> Text(<span class="string">&quot;Catalog&quot;</span>),</span><br><span class="line">        centerTitle: <span class="keyword">true</span>,</span><br><span class="line">        actions: [IconButton(</span><br><span class="line">            onPressed: ()&#123;</span><br><span class="line">              Navigator.pushNamed(context, <span class="string">&#x27;cart&#x27;</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            icon: <span class="keyword">const</span> Icon(Icons.shopping_cart)</span><br><span class="line">        )],</span><br><span class="line">      ),</span><br><span class="line">      body: GridView(<span class="comment">//è¿™é‡Œä¹‹æ‰€ä»¥ä½¿ç”¨ç½‘æ ¼åˆ—è¡¨ï¼Œæ˜¯å› ä¸ºç½‘æ ¼åˆ—è¡¨å¯ä»¥æ»šåŠ¨ï¼Œä¸”è®¾ç½®å‚ç›´é—´è·æ›´æ–¹ä¾¿</span></span><br><span class="line">        gridDelegate: <span class="keyword">const</span> SliverGridDelegateWithFixedCrossAxisCount(</span><br><span class="line">          crossAxisCount: <span class="number">1</span>,<span class="comment">//ä¸€åˆ—</span></span><br><span class="line">          mainAxisSpacing: <span class="number">0</span>,<span class="comment">//æ¯ä¸€è¡Œä¹‹é—´çš„è·ç¦»</span></span><br><span class="line">          mainAxisExtent: <span class="number">80</span><span class="comment">//æ¯ä¸€è¡Œçš„é«˜åº¦</span></span><br><span class="line">        ),</span><br><span class="line">        children: goods,<span class="comment">//åˆšåˆšç”Ÿæˆæ˜¯å•†å“ä»¬</span></span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Good</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;<span class="comment">//è‡ªå®šä¹‰çš„å•†å“ç»„ä»¶</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> id;<span class="comment">//å•†å“id</span></span><br><span class="line">  <span class="keyword">final</span> Color color;<span class="comment">//å•†å“å›¾ç‰‡ï¼ˆé¢œè‰²æ›¿ä»£ï¼‰</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> name;<span class="comment">//å•†å“åç§°</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> Good(&#123;Key? key, <span class="keyword">required</span> <span class="keyword">this</span>.color, <span class="keyword">required</span> <span class="keyword">this</span>.id, <span class="keyword">required</span> <span class="keyword">this</span>.name&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">bool</span> selected=context.watch&lt;GoodsModel&gt;().isSelected[id];<span class="comment">//ç¡®è®¤å•†å“æ˜¯å¦é€‰ä¸­å†åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">return</span>  Padding(</span><br><span class="line">      padding: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">16</span>,vertical: <span class="number">8</span>),</span><br><span class="line">      child: Row(<span class="comment">//æ¯ä¸ªå•†å“å°±æ˜¯ä¸€è¡Œ</span></span><br><span class="line">        <span class="comment">// mainAxisAlignment: MainAxisAlignment.spaceEvenly,</span></span><br><span class="line">        children: [<span class="comment">//ä¸€è¡Œä¸­çš„æ‰€æœ‰åˆ—</span></span><br><span class="line">          Container(<span class="comment">//é¢œè‰²å—</span></span><br><span class="line">            width: <span class="number">50</span>,</span><br><span class="line">            height: <span class="number">50</span>,</span><br><span class="line">            color: color,</span><br><span class="line">          ),</span><br><span class="line">          <span class="keyword">const</span> SizedBox(width: <span class="number">24</span>),<span class="comment">//ç©ºç™½å—åˆ†éš”</span></span><br><span class="line">           Expanded(<span class="comment">//æ‹“å±•åŒºï¼Œè‡ªåŠ¨å æ»¡å‰©ä½™æœªåˆ†é…åŒºåŸŸ</span></span><br><span class="line">            child: Text(name,style: <span class="keyword">const</span> TextStyle(</span><br><span class="line">                fontSize: <span class="number">24</span></span><br><span class="line">            ),),</span><br><span class="line">          ),</span><br><span class="line">          TextButton(<span class="comment">//æ·»åŠ è´­ç‰©è½¦æŒ‰é’®</span></span><br><span class="line">            onPressed: ()&#123;</span><br><span class="line">              <span class="keyword">if</span>(selected==<span class="keyword">true</span>)&#123;<span class="comment">//ç§»å‡ºè´­ç‰©è½¦</span></span><br><span class="line">                selected=!selected;</span><br><span class="line">                context.read&lt;GoodsModel&gt;().unselectItem(id);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">else</span>&#123;<span class="comment">//åŠ å…¥è´­ç‰©è½¦</span></span><br><span class="line">                selected=!selected;</span><br><span class="line">                context.read&lt;GoodsModel&gt;().selectItem(id);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            child: selected</span><br><span class="line">                ?<span class="keyword">const</span> Icon(Icons.check,size: <span class="number">20</span>,)<span class="comment">//å·²ç»é€‰ä¸­ï¼Œåˆ™å˜æˆå‹¾å‹¾å›¾æ ‡</span></span><br><span class="line">                :<span class="keyword">const</span> Text(<span class="comment">//æœªé€‰ä¸­ï¼Œåˆ™æ–‡å­—ADD</span></span><br><span class="line">              <span class="string">&quot;ADD&quot;</span>,</span><br><span class="line">              style: TextStyle(</span><br><span class="line">                color: Colors.black,</span><br><span class="line">                fontSize: <span class="number">20</span></span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          <span class="keyword">const</span> SizedBox(width: <span class="number">24</span>),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img1.imgtp.com/2022/09/29/XUcRuMDR.png" alt="å•†å“ç•Œé¢"></p><h3 id="Cart"><a href="#Cart" class="headerlink" title="Cart"></a>Cart</h3><p>è´­ç‰©è½¦ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dayly/main.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:provider/provider.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cart</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> Cart(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        backgroundColor: Colors.black,</span><br><span class="line">        title: <span class="keyword">const</span> Text(<span class="string">&quot;Cart&quot;</span>),</span><br><span class="line">        centerTitle: <span class="keyword">true</span>,</span><br><span class="line">      ),</span><br><span class="line">      body: MyCart(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCart</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> MyCart(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; texts=context.watch&lt;GoodsModel&gt;().selectedItems <span class="keyword">as</span> <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;;<span class="comment">//è·å–å…±äº«æ•°æ®ä¸­å·²ç»é€‰æ‹©çš„å•†å“</span></span><br><span class="line">    <span class="built_in">List</span>&lt;Text&gt; goods=<span class="built_in">List</span>.generate(texts.length, (index) =&gt; Text(<span class="comment">//ç”Ÿæˆè´­ç‰©è½¦æ¸…å•</span></span><br><span class="line">        texts[index],</span><br><span class="line">      style: <span class="keyword">const</span> TextStyle(</span><br><span class="line">        fontSize: <span class="number">30</span></span><br><span class="line">      ),</span><br><span class="line">    ));</span><br><span class="line">    <span class="built_in">int</span> price=texts.length*<span class="number">42</span>;<span class="comment">//æ¯ä»¶å•†å“æŒ‰42ç¾å…ƒè®¡ç®—</span></span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      color: Colors.orange,</span><br><span class="line">      child: Padding(</span><br><span class="line">        padding: <span class="keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="number">20</span>,vertical: <span class="number">16</span>),</span><br><span class="line">        child: Column(</span><br><span class="line">          children: [</span><br><span class="line">            Container(</span><br><span class="line">              height: <span class="number">400</span>,</span><br><span class="line">              child: Row(</span><br><span class="line">                children: [</span><br><span class="line">                  Column(</span><br><span class="line">                    mainAxisAlignment: MainAxisAlignment.start,</span><br><span class="line">                    crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">                    children: goods,</span><br><span class="line">                  )</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            Container(</span><br><span class="line">              height: <span class="number">150</span>,</span><br><span class="line">              decoration: <span class="keyword">const</span> BoxDecoration(</span><br><span class="line">                  border: Border.symmetric(horizontal: BorderSide(</span><br><span class="line">                      style: BorderStyle.solid</span><br><span class="line">                  ))</span><br><span class="line">              ),</span><br><span class="line">              child: Row(</span><br><span class="line">                children: [</span><br><span class="line">                  <span class="keyword">const</span> SizedBox(width: <span class="number">40</span>,),</span><br><span class="line">                  <span class="keyword">const</span> Text(<span class="string">&quot;\$&quot;</span>,style: TextStyle(fontSize: <span class="number">50</span>),),</span><br><span class="line">                  Text(<span class="string">&quot;<span class="subst">$price</span>&quot;</span>,style: <span class="keyword">const</span> TextStyle(fontSize: <span class="number">50</span>),),</span><br><span class="line">                  <span class="keyword">const</span> SizedBox(width: <span class="number">50</span>,),</span><br><span class="line">                  TextButton(</span><br><span class="line">                    onPressed: ()&#123;&#125;,</span><br><span class="line">                    style: ButtonStyle(</span><br><span class="line">                      backgroundColor:MaterialStateProperty.all(Colors.white),</span><br><span class="line">                      minimumSize: MaterialStateProperty.all(<span class="keyword">const</span> Size(<span class="number">120</span>, <span class="number">50</span>))</span><br><span class="line">                    ),</span><br><span class="line">                    child: <span class="keyword">const</span> Text(<span class="string">&quot;BUY&quot;</span>),</span><br><span class="line">                  )</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            )</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img1.imgtp.com/2022/09/29/JQ9DN2GD.png" alt="è´­ç‰©è½¦ç•Œé¢"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>éš¾èƒ½å¯è´µçš„ç»¼åˆè¿ç”¨</li><li>å¸ƒå±€çš„æ€ç»´æ¨¡å¼å’Œç†Ÿç»ƒåº¦æœ‰å¾…æå‡</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt; åœ¨å­¦ä¹  Provider çš„æ—¶å€™ï¼Œæˆ‘åœ¨ flutter çš„å®˜æ–¹å°æ•™ç¨‹ä¸­ï¼Œçœ‹åˆ°äº†ä¸€ä¸ª demoï¼Œæœ‰å…³è´­ä¹°å•†å“ï¼ŒåŠ å…¥è´­ç‰©è½¦çš„ã€‚åˆšå­¦ä¹  Provider çš„æ—¶å€™ï¼Œå¾ˆå¤šåœ°æ–¹ä¸æ˜ç™½ï¼Œæ‰€ä»¥é‚£ä¸ªæ¡ˆä¾‹ä¹Ÿæ²¡æœ‰èƒ½å¤Ÿç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©çš„æˆ‘å·²ç»èƒ½ä½¿ç”¨ Navigator å’Œ Provider çš„çŸ¥è¯†äº†ã€‚åˆ©ç”¨æˆ‘å·²æœ‰çš„çŸ¥è¯†ï¼Œå¯ä»¥å¤§æ¦‚æ¨¡ä»¿å‡ºå®˜æ–¹ demo çš„æ ·å­äº†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è·¯ç”±åˆ†æ&quot;&gt;&lt;a href=&quot;#è·¯ç”±åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;è·¯ç”±åˆ†æ&quot;&gt;&lt;/a&gt;è·¯ç”±åˆ†æ&lt;/h3&gt;&lt;p&gt;è¿™ä¸ª demo æ¶‰åŠåˆ°ä¸‰ä¸ªé¡µé¢ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç™»å½•ç•Œé¢ï¼Œç¬¬äºŒä¸ªæ˜¯å•†å“ç•Œé¢ï¼Œç¬¬ä¸‰ä¸ªæ˜¯è´­ç‰©è½¦ç•Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;åˆ†åˆ«å‘½åä¸ºï¼šLogin, Catalog, Cart&lt;/p&gt;
&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;package:dayly/Login.dart&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;package:dayly/Catalog.dart&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;package:dayly/Cart.dart&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; routes=&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&amp;#x27;login&amp;#x27;&lt;/span&gt;:(context) =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Login(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&amp;quot;catalog&amp;quot;&lt;/span&gt;:(context) =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Catalog(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&amp;quot;cart&amp;quot;&lt;/span&gt;:(context) =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; Cart(),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="å®è·µ" scheme="https://blog.kahvia.cn/categories/%E5%AE%9E%E8%B7%B5/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-BottomNavigatorBar</title>
    <link href="https://blog.kahvia.cn/2022/09/29/FlutterBottomNavigatorBar.html"/>
    <id>https://blog.kahvia.cn/2022/09/29/FlutterBottomNavigatorBar.html</id>
    <published>2022-09-29T04:51:39.100Z</published>
    <updated>2022-10-24T04:13:33.003Z</updated>
    
    <content type="html"><![CDATA[<p>ottomNavigatorBar æ˜¯ Scaffold ç»„ä»¶ä¸­çš„ï¼Œåº•éƒ¨çš„å¯¼èˆªæ ã€‚</p><h3 id="BottomNavigatorBar"><a href="#BottomNavigatorBar" class="headerlink" title="BottomNavigatorBar"></a>BottomNavigatorBar</h3><ul><li>itemsï¼šBottomNavigatorBarItemï¼ˆï¼‰<ul><li>labelï¼šæ ‡ç­¾åç§°</li><li>iconï¼šå›¾æ ‡</li><li>backgroundColorï¼šèƒŒæ™¯é¢œè‰²ï¼Œåœ¨ BottomNavigatorBar  çš„typeè®¾ç½®ä¸ºBottomNavigationBarType.shiftingæ—¶ç”Ÿæ•ˆ</li></ul></li><li>currentIndexï¼šå½“å‰é€‰é¡¹å¡çš„ç´¢å¼•ï¼Œå½“å‰é€‰é¡¹å¡ä¼šé«˜äº®</li><li>backgroundColorï¼šå¯¼èˆªæ èƒŒæ™¯å›¾ç‰‡</li><li>elevationï¼šé˜´å½±</li><li>fixedColorï¼šé€‰ä¸­çš„ item å­—ä½“é¢œè‰²å’Œå›¾æ ‡é¢œè‰²</li><li>onTapï¼šç‚¹å‡»é€‰é¡¹æ—¶è§¦å‘çš„å‡½æ•°ï¼Œéœ€è¦ä¼ å…¥ index ï¼ˆç‚¹å‡»é€‰é¡¹çš„ç´¢å¼•ï¼‰ï¼Œï¼ˆindexï¼‰{xxx}ï¼Œç”¨äºæ›´æ–°å½“å‰ç´¢å¼•</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ottomNavigatorBar æ˜¯ Scaffold ç»„ä»¶ä¸­çš„ï¼Œåº•éƒ¨çš„å¯¼èˆªæ ã€‚&lt;/p&gt;
&lt;h3 id=&quot;BottomNavigatorBar&quot;&gt;&lt;a href=&quot;#BottomNavigatorBar&quot; class=&quot;headerlink&quot; title=&quot;BottomN</summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-Navigator</title>
    <link href="https://blog.kahvia.cn/2022/09/28/Navigator.html"/>
    <id>https://blog.kahvia.cn/2022/09/28/Navigator.html</id>
    <published>2022-09-28T06:02:17.390Z</published>
    <updated>2022-10-24T04:13:33.071Z</updated>
    
    <content type="html"><![CDATA[<p>Navigatorç”¨äºç®¡ç†è·¯ç”±ã€‚</p><h3 id="ä¸‰ç§è·¯ç”±ï¼ˆçœç•¥åŠ¨æ€è·¯ç”±ï¼‰"><a href="#ä¸‰ç§è·¯ç”±ï¼ˆçœç•¥åŠ¨æ€è·¯ç”±ï¼‰" class="headerlink" title="ä¸‰ç§è·¯ç”±ï¼ˆçœç•¥åŠ¨æ€è·¯ç”±ï¼‰"></a>ä¸‰ç§è·¯ç”±ï¼ˆçœç•¥åŠ¨æ€è·¯ç”±ï¼‰</h3><ul><li><p>åŒ¿åè·¯ç”±</p><ul><li><pre><code class="dart">Navigator.push(context, MaterialPageRoute(build:(context)=&gt;diyWidget()))<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* å‘½åè·¯ç”±</span><br><span class="line"></span><br><span class="line">  * ``` dart</span><br><span class="line">    Navigator.pushNamed(context, name)</span><br></pre></td></tr></table></figure></code></pre></li><li><p>name æŒ‡åˆ›å»ºçš„è·¯ç”±è¡¨ä¸­çš„ keyï¼Œå¦‚ä¸‹æ‰€ç¤º</p></li><li><pre><code class="dart">var routes=&#123;  &#39;home&#39;:(context)=&gt; const IndexPage(),  &#39;OfficialDemo&#39;:(context)=&gt;const OfficialDemo(),  &#39;Container&#39;:(context)=&gt;const ContainerDemo(),  &#39;ColumnRow&#39;:(context)=&gt;const ColumnAndRow(),  &#39;Flex&#39;:(context)=&gt;const FlexPage(),  &#39;Wrap&#39;:(context)=&gt;const WrapPage(),  &#39;Stack&#39;:(context)=&gt;const StackPage(),  &#39;Card&#39;:(context)=&gt;const CardPage(),  &#39;LayoutTest&#39;:(context)=&gt;const LayoutTest(),  &#39;StatefulWidget&#39;:(context)=&gt;const StatefulWidgetPage(),  &#39;Button&#39;:(context)=&gt;const ButtonPage(),  &#39;SingleChildScrollViewPage&#39;:(context)=&gt;const SingleChildScrollViewPage(),  &#39;ListView&#39;:(context)=&gt;const ListViewPage(),  &#39;GridView&#39;:(context)=&gt;const GridViewPage(),&#125;;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### è·¯ç”±ä¼ å‚</span><br><span class="line"></span><br><span class="line">* åŒ¿åè·¯ç”±</span><br><span class="line"></span><br><span class="line">  * åœ¨è¦è·³è½¬çš„é¡µé¢å¯¹åº”çš„ç»„ä»¶ä¸­ï¼Œå†™ä¸Šå¯¹åº”çš„å±æ€§ï¼Œæ ‡è®°ä¸º requiredï¼Œåœ¨è·³è½¬é¡µé¢çš„æ—¶å€™ï¼Œä¼ é€’æœ‰å…³å‚æ•°å³å¯ã€‚</span><br><span class="line">  * ç®€å•æ¥è¯´ï¼Œå°±æ˜¯é é¡µé¢å¯¹åº”ç»„ä»¶è‡ªèº«çš„å±æ€§å’Œæ„é€ å‡½æ•°æ¥è¿›è¡Œè·¯ç”±ä¼ å‚ã€‚</span><br><span class="line"></span><br><span class="line">* å‘½åè·¯ç”±</span><br><span class="line"></span><br><span class="line">  * ```dart</span><br><span class="line">    Navigator.pushNamed(context, name, &#123;arguments&#125;)//æºå¸¦å‚æ•°çš„è·¯ç”±è·³è½¬</span><br></pre></td></tr></table></figure></code></pre></li><li><p>arguments æ˜¯ä¸€ä¸ª map å¯¹è±¡ï¼Œå°±åƒä¸Šé¢çš„è·¯ç”±è¡¨ä¸€æ ·ã€‚</p></li><li><pre><code class="dart">ModalRoute.of(context).settings.arguments;//è·å–ä¼ é€’è¿‡æ¥çš„arguments</code></pre></li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Navigatorç”¨äºç®¡ç†è·¯ç”±ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¸‰ç§è·¯ç”±ï¼ˆçœç•¥åŠ¨æ€è·¯ç”±ï¼‰&quot;&gt;&lt;a href=&quot;#ä¸‰ç§è·¯ç”±ï¼ˆçœç•¥åŠ¨æ€è·¯ç”±ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;ä¸‰ç§è·¯ç”±ï¼ˆçœç•¥åŠ¨æ€è·¯ç”±ï¼‰&quot;&gt;&lt;/a&gt;ä¸‰ç§è·¯ç”±ï¼ˆçœç•¥åŠ¨æ€è·¯ç”±ï¼‰&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;</summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-InheritedWidget</title>
    <link href="https://blog.kahvia.cn/2022/09/26/InheritedWidget.html"/>
    <id>https://blog.kahvia.cn/2022/09/26/InheritedWidget.html</id>
    <published>2022-09-26T13:58:19.394Z</published>
    <updated>2022-10-24T04:13:33.063Z</updated>
    
    <content type="html"><![CDATA[<h3 id="InheritedWidget"><a href="#InheritedWidget" class="headerlink" title="InheritedWidget"></a>InheritedWidget</h3><ul><li>flutterä¸­ç”¨äºæ•°æ®å…±äº«çš„ç»„ä»¶ã€‚</li><li>åˆ›å»ºè‡ªå®šä¹‰ç±»ï¼Œç»§æ‰¿ InheritedWidget ï¼Œç”¨è¿™ä¸ªè‡ªå®šä¹‰ç±»çš„ç»„ä»¶å®ä¾‹åŒ…è£¹å­ç»„ä»¶ï¼Œä½¿å¾—å­ç»„ä»¶åŠå…¶åä»£éƒ½å¯ä»¥è®¿é—®è‡ªå®šä¹‰ç±»å®ä¾‹ä¸­çš„å…±äº«æ•°æ®ã€‚</li></ul><h3 id="è‡ªå®šä¹‰ç±»"><a href="#è‡ªå®šä¹‰ç±»" class="headerlink" title="è‡ªå®šä¹‰ç±»"></a>è‡ªå®šä¹‰ç±»</h3><p>ä½¿ç”¨ inh ç®€å†™å¿«é€Ÿç”Ÿæˆè‡ªå®šä¹‰ç±»å¹¶ç»§æ‰¿æ•°æ®å…±äº«ç»„ä»¶ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WaitingData</span> <span class="keyword">extends</span> <span class="title">InheritedWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">String</span> name; <span class="comment">//è‡ªå®šä¹‰å…±äº«æ•°æ®ï¼Œéœ€è¦finalå‰ç¼€</span></span><br><span class="line">  <span class="keyword">const</span> WaitingData(&#123;</span><br><span class="line">    Key? key,</span><br><span class="line">    <span class="keyword">required</span> Widget child,</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.name</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key, child: child);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> WaitingData of(BuildContext context) &#123;<span class="comment">//é™æ€æ–¹æ³•ï¼Œç®€åŒ–äº†è·å–å…±äº«æ•°æ®çš„æ–¹å¼ã€‚ä¸ç”¨è¿™ç§å°±ç”¨ä¸‹é¢è¿™è¡Œå¤æ‚æ–¹å¼</span></span><br><span class="line">    <span class="keyword">final</span> WaitingData? result = context.dependOnInheritedWidgetOfExactType&lt;WaitingData&gt;();</span><br><span class="line">    <span class="keyword">assert</span>(result != <span class="keyword">null</span>, <span class="string">&#x27;No WaitingData found in context&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> result!;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> updateShouldNotify(WaitingData old) &#123;<span class="comment">//æŒ‡æ˜ä»€ä¹ˆæ—¶å€™é‡æ–°æ¸²æŸ“ç»„ä»¶</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;<span class="comment">//trueåˆ™å½“æ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œæ¯æ¬¡éƒ½é‡æ–°æ¸²æŸ“ã€‚å¯ä»¥å†™ç®­å¤´å‡½æ•°æ¥æŒ‡æ˜æ¡ä»¶ã€‚</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><span id="more"></span><h3 id="è‡ªå®šä¹‰ç±»å®ä¾‹çš„ä½¿ç”¨"><a href="#è‡ªå®šä¹‰ç±»å®ä¾‹çš„ä½¿ç”¨" class="headerlink" title="è‡ªå®šä¹‰ç±»å®ä¾‹çš„ä½¿ç”¨"></a>è‡ªå®šä¹‰ç±»å®ä¾‹çš„ä½¿ç”¨</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> MyPage(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;MyPage&gt; createState() =&gt; _MyPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyPage</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span>  WaitingData(</span><br><span class="line">        name: <span class="string">&quot;Kahvia!&quot;</span>,</span><br><span class="line">        child: Builder(<span class="comment">//ç”¨Builderæ‰èƒ½è·å–åˆ°ä¸Šä¸‹æ–‡</span></span><br><span class="line">            builder: (BuildContext centerContext)&#123;<span class="comment">//è¿™ä¸ªä¸Šä¸‹æ–‡çš„å†…å®¹åŒ…æ‹¬Builderï¼ˆï¼‰å¤–é¢çš„ä¸œè¥¿ï¼Œå³åŒ…å«äº†name</span></span><br><span class="line">              <span class="keyword">return</span> Center(</span><br><span class="line">                child: Text(</span><br><span class="line">                    <span class="string">&quot;Hello,<span class="subst">$&#123;WaitingData.of(centerContext).name&#125;</span>&quot;</span>,<span class="comment">//å¦‚æœç”¨çš„çš„contextï¼Œé‚£contextä¸Šä¸‹æ–‡ä¸­åˆ™æ²¡æœ‰nameï¼Œä¼šæŠ¥é”™</span></span><br><span class="line">                    style: <span class="keyword">const</span> TextStyle(</span><br><span class="line">                      fontSize: <span class="number">25</span>,</span><br><span class="line">                      color: Colors.blue</span><br><span class="line">                    ),</span><br><span class="line">                ),</span><br><span class="line">              );</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><ul><li>æ˜ç¡®ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ï¼Œæƒ³è¦è·å–å…±äº«æ•°æ®ï¼Œå°±éœ€è¦ä½¿ç”¨<font color=#66AFE)><strong>å…±äº«æ•°æ®ç»„ä»¶çš„å­ç»„ä»¶çš„ä¸Šä¸‹æ–‡</strong></font></li><li>è·å–ä¸Šä¸‹æ–‡å¯ä»¥ç”¨Builderï¼ˆï¼‰</li></ul>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;InheritedWidget&quot;&gt;&lt;a href=&quot;#InheritedWidget&quot; class=&quot;headerlink&quot; title=&quot;InheritedWidget&quot;&gt;&lt;/a&gt;InheritedWidget&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;flutterä¸­ç”¨äºæ•°æ®å…±äº«çš„ç»„ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºè‡ªå®šä¹‰ç±»ï¼Œç»§æ‰¿ InheritedWidget ï¼Œç”¨è¿™ä¸ªè‡ªå®šä¹‰ç±»çš„ç»„ä»¶å®ä¾‹åŒ…è£¹å­ç»„ä»¶ï¼Œä½¿å¾—å­ç»„ä»¶åŠå…¶åä»£éƒ½å¯ä»¥è®¿é—®è‡ªå®šä¹‰ç±»å®ä¾‹ä¸­çš„å…±äº«æ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;è‡ªå®šä¹‰ç±»&quot;&gt;&lt;a href=&quot;#è‡ªå®šä¹‰ç±»&quot; class=&quot;headerlink&quot; title=&quot;è‡ªå®šä¹‰ç±»&quot;&gt;&lt;/a&gt;è‡ªå®šä¹‰ç±»&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨ inh ç®€å†™å¿«é€Ÿç”Ÿæˆè‡ªå®šä¹‰ç±»å¹¶ç»§æ‰¿æ•°æ®å…±äº«ç»„ä»¶ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight dart&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;WaitingData&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;InheritedWidget&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;String&lt;/span&gt; name; &lt;span class=&quot;comment&quot;&gt;//è‡ªå®šä¹‰å…±äº«æ•°æ®ï¼Œéœ€è¦finalå‰ç¼€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; WaitingData(&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Key? key,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;required&lt;/span&gt; Widget child,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;required&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.name&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;) : &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(key: key, child: child);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; WaitingData of(BuildContext context) &amp;#123;&lt;span class=&quot;comment&quot;&gt;//é™æ€æ–¹æ³•ï¼Œç®€åŒ–äº†è·å–å…±äº«æ•°æ®çš„æ–¹å¼ã€‚ä¸ç”¨è¿™ç§å°±ç”¨ä¸‹é¢è¿™è¡Œå¤æ‚æ–¹å¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; WaitingData? result = context.dependOnInheritedWidgetOfExactType&amp;lt;WaitingData&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt;(result != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;#x27;No WaitingData found in context&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; result!;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;bool&lt;/span&gt; updateShouldNotify(WaitingData old) &amp;#123;&lt;span class=&quot;comment&quot;&gt;//æŒ‡æ˜ä»€ä¹ˆæ—¶å€™é‡æ–°æ¸²æŸ“ç»„ä»¶&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;span class=&quot;comment&quot;&gt;//trueåˆ™å½“æ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œæ¯æ¬¡éƒ½é‡æ–°æ¸²æŸ“ã€‚å¯ä»¥å†™ç®­å¤´å‡½æ•°æ¥æŒ‡æ˜æ¡ä»¶ã€‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-Provider</title>
    <link href="https://blog.kahvia.cn/2022/09/26/FlutterProvider.html"/>
    <id>https://blog.kahvia.cn/2022/09/26/FlutterProvider.html</id>
    <published>2022-09-26T13:57:14.479Z</published>
    <updated>2022-10-24T04:13:33.041Z</updated>
    
    <content type="html"><![CDATA[<p>Provideræ˜¯ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†çš„åº“ã€‚å°±æˆ‘ç›®å‰çš„æ°´å¹³æ¥çœ‹ï¼Œå®ƒè²Œä¼¼èƒ½ä»£æ›¿ StatefulWidget å’Œ InheritedWidget ã€‚</p><h3 id="å®‰è£…ï¼ˆå¸¦-è¡¨ç¤ºå¯ä»¥è‡ªåŠ¨æ›´æ–°ï¼‰"><a href="#å®‰è£…ï¼ˆå¸¦-è¡¨ç¤ºå¯ä»¥è‡ªåŠ¨æ›´æ–°ï¼‰" class="headerlink" title="å®‰è£…ï¼ˆå¸¦^è¡¨ç¤ºå¯ä»¥è‡ªåŠ¨æ›´æ–°ï¼‰"></a>å®‰è£…ï¼ˆå¸¦^è¡¨ç¤ºå¯ä»¥è‡ªåŠ¨æ›´æ–°ï¼‰</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">provider:</span> <span class="string">^6.0.3</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><ul><li><p>åˆ›å»ºæ•°æ®æ¨¡å‹ï¼ˆè‡ªå®šä¹‰ç±»ï¼‰ï¼Œç»§æ‰¿ ChangeNotifier ï¼Œæš´éœ²æƒ³è¦å…±äº«çš„æ•°æ®, ä»¥åŠåˆ›å»ºå¯é€‰çš„ä¿®æ”¹æ•°æ®çš„æ–¹æ³•ã€‚</p></li><li><p>åˆ›å»ºè§‚å¯Ÿè€…ï¼Œæˆ–è€…è¯´æ•°æ®æ¨¡å‹çš„æä¾›è€…â€”â€”Providerã€‚</p><ul><li>é€šè¿‡Providerï¼ˆï¼‰æä¾›çš„æ•°æ®é€šå¸¸æ˜¯ä¸å¯å˜çš„ã€‚</li><li>é€šè¿‡ChangeNotifierProviderï¼ˆï¼‰æä¾›çš„æ•°æ®å¯ä»¥æ”¹å˜ï¼Œå¹¶å¯ä»¥é€šè¿‡è°ƒç”¨notifyListenersï¼ˆï¼‰æ¥æ›´æ–°ä½¿ç”¨åˆ°å…±äº«æ•°æ®çš„ç»„ä»¶ã€‚<ul><li>å’Œ InheritedWidget ç±»ä¼¼ï¼ŒåŒ…è£¹éœ€è¦ä½¿ç”¨å…±äº«æ•°æ®çš„å­å­™ç»„ä»¶ã€‚åŒ…è£¹ä¸€æ¬¡ï¼Œå­å­™ç»„ä»¶éƒ½å¯ä»¥ä½œä¸ºç›‘å¬è€…ï¼ˆlistenerï¼‰ä½¿ç”¨æ•°æ®ã€‚</li><li>ä¸º create å±æ€§æä¾›æ„é€ å™¨ï¼Œéœ€è¦ä¼ å…¥ä¸Šä¸‹æ–‡context</li><li>child å­ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯åŒ…è£¹çš„å­å­™ç»„ä»¶</li></ul></li></ul></li><li><p>ä½œä¸º Listener ä½¿ç”¨å…±äº«æ•°æ®ã€‚å› ä¸ºæ—¶å¸¸éœ€è¦å“åº”æ•°æ®çš„å˜åŒ–ï¼Œæ‰€ä»¥å«ç›‘å¬è€…ã€‚</p><ul><li><p>context.watch &lt; Type &gt;( ).atributeNameï¼Œé€šè¿‡ä¸Šä¸‹æ–‡çš„æ³¨å…¥æ–¹æ³•ï¼ˆç”±providerè‡ªåŠ¨æ³¨å…¥ï¼Œä¹Ÿå°±æ˜¯é™„åŠ æ–¹æ³•ï¼‰æ¥è·å–æ•°æ®ã€‚</p></li><li><p>Provider.Of&lt; Type &gt;(context).atributeName, é€šè¿‡Providerçš„é™æ€æ–¹æ³•æ¥è·å–æ•°æ®ã€‚</p></li><li><p>æŸ¥çœ‹æºç å‘ç°ï¼Œç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯å°è£…åçš„ç¬¬äºŒç§æ–¹æ³•</p></li><li><p>&#96;&#96;&#96;dart<br>T watch<T>() {<br>  return Provider.of<T>(this);<br>}</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!--more--&gt;</span><br><span class="line"></span><br><span class="line">### ä»£ç åŒº</span><br><span class="line"></span><br><span class="line">#### æ•°æ®æ¨¡å‹</span><br><span class="line"></span><br><span class="line">```dart</span><br><span class="line">class LikeData extends ChangeNotifier&#123;</span><br><span class="line">  int _number=520;</span><br><span class="line">  bool _liking=true;</span><br><span class="line"></span><br><span class="line">  int get number =&gt; _number;//æš´éœ²ç§æœ‰å˜é‡ï¼Œè®©å¤–éƒ¨è®¿é—®ã€‚</span><br><span class="line">  bool get liking =&gt; _liking;</span><br><span class="line"></span><br><span class="line">  void changeLikeState()&#123;//æ”¹å˜æ”¶è—çŠ¶æ€çš„å‡½æ•°</span><br><span class="line">    if(_liking==true)&#123;</span><br><span class="line">      _liking=false;</span><br><span class="line">      _number--;</span><br><span class="line">      notifyListeners();//æ•°æ®æ”¹å˜äº†ï¼Œé€šçŸ¥æ•°æ®ç›‘å¬è€…ï¼ˆproviderï¼‰å»æ”¹å˜å€¼</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">      _liking=true;</span><br><span class="line">      _number++;</span><br><span class="line">      notifyListeners();//æ•°æ®æ”¹å˜äº†ï¼Œé€šçŸ¥æ•°æ®ç›‘å¬è€…ï¼ˆproviderï¼‰å»æ”¹å˜å€¼</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="è§‚å¯Ÿè€…"><a href="#è§‚å¯Ÿè€…" class="headerlink" title="è§‚å¯Ÿè€…"></a>è§‚å¯Ÿè€…</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> Home(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ChangeNotifierProvider(<span class="comment">//åŒ…è£¹éœ€è¦æ•°æ®çš„å­å­™ç»„ä»¶</span></span><br><span class="line">      create: (BuildContext context)=&gt;LikeData(),<span class="comment">//æ„é€ å™¨æ„é€ æ•°æ®æ¨¡å‹</span></span><br><span class="line">      child: Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: <span class="keyword">const</span> Text(<span class="string">&#x27;Provider&#x27;</span>),</span><br><span class="line">          leading: <span class="keyword">const</span> Icon(Icons.menu),</span><br><span class="line">          actions: <span class="keyword">const</span>[Icon(Icons.settings)],</span><br><span class="line">        ),</span><br><span class="line">        body:  MyPage(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç›‘å¬è€…ï¼ˆä½¿ç”¨åˆ°å…±äº«æ•°æ®çš„é‚£ä¸€éƒ¨åˆ†ï¼‰"><a href="#ç›‘å¬è€…ï¼ˆä½¿ç”¨åˆ°å…±äº«æ•°æ®çš„é‚£ä¸€éƒ¨åˆ†ï¼‰" class="headerlink" title="ç›‘å¬è€…ï¼ˆä½¿ç”¨åˆ°å…±äº«æ•°æ®çš„é‚£ä¸€éƒ¨åˆ†ï¼‰"></a>ç›‘å¬è€…ï¼ˆä½¿ç”¨åˆ°å…±äº«æ•°æ®çš„é‚£ä¸€éƒ¨åˆ†ï¼‰</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Widget titleSection = Builder(</span><br><span class="line">    builder: (BuildContext context)=&gt;Container(<span class="comment">//è‡ªå®šä¹‰ç»„ä»¶ï¼Œæ ‡é¢˜éƒ¨åˆ†ï¼Œå³å¤´éƒ¨éƒ¨åˆ†</span></span><br><span class="line">      padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">32</span>),</span><br><span class="line">      child: Row(<span class="comment">//ä¸€è¡Œ</span></span><br><span class="line">        children: [<span class="comment">//ä¸‰åˆ—</span></span><br><span class="line">          Expanded(<span class="comment">//ç¬¬ä¸€åˆ—ï¼Œæ ‡é¢˜å’Œå‰¯æ ‡é¢˜</span></span><br><span class="line">            child: Column(<span class="comment">//ç¬¬ä¸€åˆ—æœ‰ä¸¤è¡Œ</span></span><br><span class="line">              crossAxisAlignment: CrossAxisAlignment.start,<span class="comment">//äº¤å‰è½´æ–¹å‘ï¼Œæ­¤å¤„å³æ°´å¹³æ–¹å‘å¯¹é½æ–¹å¼ï¼Œåœ¨èµ·ç‚¹å¤„å¯¹é½ï¼Œå³å·¦å¯¹é½</span></span><br><span class="line">              children: [</span><br><span class="line">                <span class="keyword">const</span> Text(<span class="comment">//ç¬¬ä¸€è¡Œ</span></span><br><span class="line">                  <span class="string">&quot;Hello,this is Alice!&quot;</span>,</span><br><span class="line">                  style: TextStyle(</span><br><span class="line">                    fontWeight: FontWeight.bold,<span class="comment">//åŠ ç²—ï¼Œè¡¨æ˜ä¸»ä½“</span></span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                Text(<span class="comment">//ç¬¬äºŒè¡Œ</span></span><br><span class="line">                  <span class="string">&quot;Good evening!&quot;</span>,</span><br><span class="line">                  style: TextStyle(</span><br><span class="line">                    color: Colors.grey[<span class="number">500</span>],<span class="comment">//ç°è‰²</span></span><br><span class="line">                  ),</span><br><span class="line">                )</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">           IconButton(<span class="comment">//ç¬¬äºŒåˆ—ï¼Œæ”¶è—å›¾æ ‡</span></span><br><span class="line">             icon: Icon(context.watch&lt;LikeData&gt;().liking?Icons.star:Icons.star_border),<span class="comment">//è·å–å…±äº«æ•°æ®çš„ç¬¬ä¸€ç§æ–¹æ³•</span></span><br><span class="line">             color: Colors.red,</span><br><span class="line">             onPressed: context.watch&lt;LikeData&gt;().changeLikeState,</span><br><span class="line">          ),</span><br><span class="line">           Text(<span class="comment">//ç¬¬ä¸‰åˆ—ï¼Œæ”¶è—æ•°</span></span><br><span class="line">            <span class="string">&quot;<span class="subst">$&#123;Provider.of&lt;LikeData&gt;(context).number&#125;</span>&quot;</span>,<span class="comment">//è·å–å…±äº«æ•°æ®çš„ç¬¬äºŒç§æ–¹æ³•</span></span><br><span class="line">            <span class="comment">//   &quot;520&quot;</span></span><br><span class="line">          )</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><p>ä»£ç å®ç°çš„åŠŸèƒ½å’Œä¹‹å‰æµ‹è¯•çš„â€œæœ‰çŠ¶æ€ç»„ä»¶â€ä¸€æ ·ï¼Œéƒ½æ˜¯å®ç°æ”¶è—åŠŸèƒ½å’Œå®ƒçš„æ”¶è—æ•°å˜åŒ–ã€‚</p><p>ä¸åŒçš„åœ°æ–¹æ˜¯ï¼Œä½¿ç”¨provideråï¼Œæ²¡æœ‰ä½¿ç”¨çŠ¶æ€ç»„ä»¶è¿›è¡ŒçŠ¶æ€ç®¡ç†ã€‚ä½†æ˜¯å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§å…±äº«æ•°æ®çš„æ¨¡å¼åœ¨å¤šé‡åµŒå¥—ç»„ä»¶ä¸‹ï¼Œå¯ä»¥æ›´å¥½çš„å®ç°çŠ¶æ€ç®¡ç†ï¼Œè€Œä¸ç”¨é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’æ‰€éœ€æ•°æ®ï¼Œä¹Ÿä¸éœ€è¦é€šè¿‡æ‰‹åŠ¨è°ƒç”¨ setStateï¼ˆï¼‰è¿›è¡Œç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Provideræ˜¯ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†çš„åº“ã€‚å°±æˆ‘ç›®å‰çš„æ°´å¹³æ¥çœ‹ï¼Œå®ƒè²Œä¼¼èƒ½ä»£æ›¿ StatefulWidget å’Œ InheritedWidget ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å®‰è£…ï¼ˆå¸¦-è¡¨ç¤ºå¯ä»¥è‡ªåŠ¨æ›´æ–°ï¼‰&quot;&gt;&lt;a href=&quot;#å®‰è£…ï¼ˆå¸¦-è¡¨ç¤ºå¯ä»¥è‡ªåŠ¨æ›´æ–°ï¼‰&quot; class=&quot;heade</summary>
      
    
    
    
    <category term="çŸ¥è¯†" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
</feed>
