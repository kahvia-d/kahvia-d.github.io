<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kahvia&#39;s Home</title>
  
  <subtitle>你站在桥上看风景，看风景人在楼上看你。</subtitle>
  <link href="https://blog.kahvia.cn/atom.xml" rel="self"/>
  
  <link href="https://blog.kahvia.cn/"/>
  <updated>2024-04-19T16:03:12.844Z</updated>
  <id>https://blog.kahvia.cn/</id>
  
  <author>
    <name>Kahvia</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>DaisyUI指南</title>
    <link href="https://blog.kahvia.cn/2024/04/19/DaisyUI.html"/>
    <id>https://blog.kahvia.cn/2024/04/19/DaisyUI.html</id>
    <published>2024-04-19T15:29:10.512Z</published>
    <updated>2024-04-19T16:03:12.844Z</updated>
    
    <content type="html"><![CDATA[<h3 id="主题切换"><a href="#主题切换" class="headerlink" title="主题切换"></a>主题切换</h3><p>参考<a href="https://daisyui.com/components/theme-controller/">主题控制器</a>。以下甄选了几个好看的主题。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;tailwindcss&#x27;).Config</span>&#125; */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">content</span>: [<span class="string">&quot;./src/**/*.&#123;html,js,vue&#125;&quot;</span>],</span><br><span class="line">  <span class="attr">theme</span>: &#123;</span><br><span class="line">    <span class="attr">extend</span>: &#123;&#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="built_in">require</span>(<span class="string">&quot;daisyui&quot;</span>)],</span><br><span class="line">  <span class="attr">daisyui</span>: &#123;</span><br><span class="line">    <span class="attr">themes</span>: [</span><br><span class="line">      <span class="string">&quot;light&quot;</span>,</span><br><span class="line">      <span class="string">&quot;dark&quot;</span>,</span><br><span class="line">      <span class="string">&quot;halloween&quot;</span>,</span><br><span class="line">      <span class="string">&quot;garden&quot;</span>,</span><br><span class="line">      <span class="string">&quot;forest&quot;</span>,</span><br><span class="line">      <span class="string">&quot;lofi&quot;</span>,</span><br><span class="line">      <span class="string">&quot;pastel&quot;</span>,</span><br><span class="line">      <span class="string">&quot;fantasy&quot;</span>,</span><br><span class="line">      <span class="string">&quot;wireframe&quot;</span>,</span><br><span class="line">      <span class="string">&quot;dracula&quot;</span>,</span><br><span class="line">      <span class="string">&quot;cmyk&quot;</span>,</span><br><span class="line">      <span class="string">&quot;autumn&quot;</span>,</span><br><span class="line">    ], <span class="comment">// false: only light + dark | true: all themes | array: specific themes like this [&quot;light&quot;, &quot;dark&quot;, &quot;cupcake&quot;]</span></span><br><span class="line">    <span class="attr">darkTheme</span>: <span class="string">&quot;dark&quot;</span>, <span class="comment">// name of one of the included themes for dark mode</span></span><br><span class="line">    <span class="attr">base</span>: <span class="literal">true</span>, <span class="comment">// applies background color and foreground color for root element by default</span></span><br><span class="line">    <span class="attr">styled</span>: <span class="literal">true</span>, <span class="comment">// include daisyUI colors and design decisions for all components</span></span><br><span class="line">    <span class="attr">utils</span>: <span class="literal">true</span>, <span class="comment">// adds responsive and modifier utility classes</span></span><br><span class="line">    <span class="attr">prefix</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// prefix for daisyUI classnames (components, modifiers and responsive class names. Not colors)</span></span><br><span class="line">    <span class="attr">logs</span>: <span class="literal">true</span>, <span class="comment">// Shows info about daisyUI version and used config in the console when building your CSS</span></span><br><span class="line">    <span class="attr">themeRoot</span>: <span class="string">&quot;:root&quot;</span>, <span class="comment">// The element that receives theme color CSS variables</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="我的主题切换器"><a href="#我的主题切换器" class="headerlink" title="我的主题切换器"></a>我的主题切换器</h4><p>其中 tabindex&#x3D;”0” 代表元素能否通过进行聚焦（用点的或者Tab键），此处第一个tabindex&#x3D;”0”不能省略，因为下面的ul的dropdown-content的底层css样式写的就是：上面那个Theme div聚焦了，下面这个列表才显示。至于第二个ul的聚焦，没啥用，可以删掉，因为input能直接聚焦。</p><p>通过 <strong>:checked&#x3D;”index &#x3D;&#x3D; themeIndex”</strong>来初始化主题选择器的<strong>radio</strong>的选项默认选中。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;dropdown&quot;&gt;</span><br><span class="line">        &lt;div tabindex=&quot;0&quot; role=&quot;button&quot; class=&quot;btn m-1&quot;&gt;</span><br><span class="line">            Theme</span><br><span class="line">            &lt;svg width=&quot;12px&quot; height=&quot;12px&quot; class=&quot;h-2 w-2 fill-current opacity-60 inline-block&quot;</span><br><span class="line">                xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 2048 2048&quot;&gt;</span><br><span class="line">                &lt;path d=&quot;M1799 349l242 241-1017 1017L7 590l242-241 775 775 775-775z&quot;&gt;&lt;/path&gt;</span><br><span class="line">            &lt;/svg&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;ul tabindex=&quot;0&quot; class=&quot;dropdown-content z-[1] p-2 shadow-2xl bg-base-300 rounded-box w-52&quot;&gt;</span><br><span class="line">            &lt;li v-for=&quot;(theme, index) in themeList&quot; @click=&quot;changeTheme(index, theme)&quot;&gt;</span><br><span class="line">                &lt;input type=&quot;radio&quot; name=&quot;theme-dropdown&quot;</span><br><span class="line">                    class=&quot;theme-controller btn btn-sm btn-block btn-ghost justify-start&quot; :aria-label=&quot;theme&quot;</span><br><span class="line">                    :value=&quot;theme&quot; :checked=&quot;index == themeIndex&quot; /&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;;</span><br><span class="line">import &#123; useThemeStore &#125; from &#x27;@/stores/themeStore&#x27;;</span><br><span class="line"></span><br><span class="line">const &#123; changeThemeTo, getCurrentThemeIndex &#125; = useThemeStore();</span><br><span class="line"></span><br><span class="line">const themeIndex = ref(0);</span><br><span class="line">const themeList = ref([</span><br><span class="line">    &quot;light&quot;,</span><br><span class="line">    &quot;dark&quot;,</span><br><span class="line">    &quot;halloween&quot;,</span><br><span class="line">    &quot;garden&quot;,</span><br><span class="line">    &quot;forest&quot;,</span><br><span class="line">    &quot;lofi&quot;,</span><br><span class="line">    &quot;pastel&quot;,</span><br><span class="line">    &quot;fantasy&quot;,</span><br><span class="line">    &quot;wireframe&quot;,</span><br><span class="line">    &quot;black&quot;,</span><br><span class="line">    &quot;luxury&quot;,</span><br><span class="line">    &quot;dracula&quot;,</span><br><span class="line">    &quot;cmyk&quot;,</span><br><span class="line">    &quot;autumn&quot;,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">function changeTheme(index, themeName) &#123;</span><br><span class="line">    themeIndex.value = index;</span><br><span class="line">    changeThemeTo(index, themeName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">    themeIndex.value = getCurrentThemeIndex();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>以下是pinia持久化的内容。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//themeStore.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useThemeStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;theme&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> theme = <span class="title function_">ref</span>(<span class="string">&#x27;light&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> themeIndex = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">initialTheme</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> html = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;html&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line">        html.<span class="title function_">setAttribute</span>(<span class="string">&#x27;data-theme&#x27;</span>, theme.<span class="property">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">changeThemeTo</span>(<span class="params">index, themeName</span>) &#123;</span><br><span class="line">        themeIndex.<span class="property">value</span> = index;</span><br><span class="line">        theme.<span class="property">value</span> = themeName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getCurrentThemeIndex</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> themeIndex.<span class="property">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; theme, themeIndex, initialTheme, changeThemeTo, getCurrentThemeIndex &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">persist</span>: <span class="literal">true</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>即便在控制器中初始化了默认<strong>radio</strong>的默认选中，但是在App.vue的onMounted函数中调用初始化主题仍然是必要的。因为主题控制器大多在导航栏中，而有的登陆界面中没有导航栏，意味着主题控制器未生效，此时需要根据本地数据主动初始化主题。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;主题切换&quot;&gt;&lt;a href=&quot;#主题切换&quot; class=&quot;headerlink&quot; title=&quot;主题切换&quot;&gt;&lt;/a&gt;主题切换&lt;/h3&gt;&lt;p&gt;参考&lt;a href=&quot;https://daisyui.com/components/theme-controller/&quot;&gt;主</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="DaisyUI Tailwind" scheme="https://blog.kahvia.cn/tags/DaisyUI-Tailwind/"/>
    
  </entry>
  
  <entry>
    <title>VueUse</title>
    <link href="https://blog.kahvia.cn/2024/03/16/Vue-use.html"/>
    <id>https://blog.kahvia.cn/2024/03/16/Vue-use.html</id>
    <published>2024-03-16T11:00:29.186Z</published>
    <updated>2024-03-16T11:12:39.088Z</updated>
    
    <content type="html"><![CDATA[<p> 这是 Vue 的一个第三方库，提供了许多意想不到的功能。比如异步 computed 。</p><h3 id="computedAsync"><a href="#computedAsync" class="headerlink" title="computedAsync"></a><a href="https://vueuse.org/core/computedAsync/#computedasync">computedAsync</a></h3><p>Vue 官方的 computed 是同步的，有时并不能满足开发需求。比如我根据“县名”异步查询行政区下的“乡镇”，在 resolve 之前，我希望有个默认值。当然了，我可以定义一个 ref 变量来存放默认值，异步查询后更改 ref 的值。这意味着，我要在选择县之后的回调函数中，手动调用异步函数，然后等待异步函数 resolve ，再修改 ref 的值。这显然很麻烦。</p><p>但是这个库函数，直接传入异步函数和默认值，组件直接使用 computed 的结果即可，自然是方便很多。</p><p>比如。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> towns = <span class="title function_">computedAsync</span>(</span><br><span class="line">    <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (country.<span class="property">value</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> towns = <span class="keyword">await</span> <span class="title function_">getTowns</span>((country.<span class="property">value</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="property">name</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">addIdToDistinct</span>(towns <span class="keyword">as</span> <span class="built_in">any</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> [&#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span> &#125;];</span><br><span class="line">    &#125;,</span><br><span class="line">    [&#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span> &#125;],</span><br><span class="line">    &#123; <span class="attr">lazy</span>: <span class="literal">true</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; 这是 Vue 的一个第三方库，提供了许多意想不到的功能。比如异步 computed 。&lt;/p&gt;
&lt;h3 id=&quot;computedAsync&quot;&gt;&lt;a href=&quot;#computedAsync&quot; class=&quot;headerlink&quot; title=&quot;computedAsync&quot;</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="uniapp" scheme="https://blog.kahvia.cn/tags/uniapp/"/>
    
  </entry>
  
  <entry>
    <title>项目过程中积累的css技巧</title>
    <link href="https://blog.kahvia.cn/2024/03/11/css-skills.html"/>
    <id>https://blog.kahvia.cn/2024/03/11/css-skills.html</id>
    <published>2024-03-11T11:12:59.343Z</published>
    <updated>2024-03-11T11:35:48.420Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Flex布局设置多行首对齐且整体居中"><a href="#Flex布局设置多行首对齐且整体居中" class="headerlink" title="Flex布局设置多行首对齐且整体居中"></a>Flex布局设置多行首对齐且整体居中</h3><p>假定项目中的待展示元素宽高固定，每一行要求左对齐，一行最多五个，在此基础上，依据设备的不同，每一行多余的屏幕空间不同。如何将每行排满后多余的屏幕空间分配给该行的每个元素？</p><p>答：采用一个空盒子对展示元素进行包裹。对于空盒子，采用<strong> flex-bias </strong>设置一行内所占空间为 20% ，同时空盒子也进行 flex 布局，对展示元素进行水平和垂直的居中处理。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;categories&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;wrapper&quot; v-for=&quot;category in categories&quot;&gt;</span><br><span class="line">            &lt;navigator class=&quot;navigator-item&quot; url=&quot;/pages/index/index&quot; open-type=&quot;navigate&quot;</span><br><span class="line">                hover-class=&quot;navigator-hover&quot;&gt;</span><br><span class="line">                &lt;image class=&quot;icon&quot; :src=&quot;category.icon_data&quot; /&gt;</span><br><span class="line">                &lt;text&gt;&#123;&#123; category.name &#125;&#125;&lt;/text&gt;</span><br><span class="line">            &lt;/navigator&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import &#123; getCats &#125; from &#x27;@/services/product&#x27;;</span><br><span class="line">import &#123; useProductStore &#125; from &#x27;@/stores/piniaStores&#x27;;</span><br><span class="line">import &#123; storeToRefs &#125; from &#x27;pinia&#x27;;</span><br><span class="line"></span><br><span class="line">const &#123; categories &#125; = storeToRefs(useProductStore());</span><br><span class="line"></span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">    getCats();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.categories &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-wrap: wrap;</span><br><span class="line">    justify-content: flex-start;</span><br><span class="line">    margin-top: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.wrapper &#123;</span><br><span class="line">    flex-basis: 20%;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.navigator-item &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    width: 50px;</span><br><span class="line">    height: 50px;</span><br><span class="line">    margin-bottom: 25px;</span><br><span class="line">    background-color: #6196A6;</span><br><span class="line">    border-radius: 10px;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.navigator-item text &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    bottom: -20px;</span><br><span class="line">    font-size: x-small;</span><br><span class="line">    font-weight: 500;</span><br><span class="line">    color: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">image &#123;</span><br><span class="line">    width: 30px;</span><br><span class="line">    height: 30px;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><img src="https://pics.kahvia.cn/img/20240311193512.png" alt="效果图"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;Flex布局设置多行首对齐且整体居中&quot;&gt;&lt;a href=&quot;#Flex布局设置多行首对齐且整体居中&quot; class=&quot;headerlink&quot; title=&quot;Flex布局设置多行首对齐且整体居中&quot;&gt;&lt;/a&gt;Flex布局设置多行首对齐且整体居中&lt;/h3&gt;&lt;p&gt;假定项目中的</summary>
      
    
    
    
    <category term="经验" scheme="https://blog.kahvia.cn/categories/%E7%BB%8F%E9%AA%8C/"/>
    
    
    <category term="css" scheme="https://blog.kahvia.cn/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>vue3知识点</title>
    <link href="https://blog.kahvia.cn/2024/03/09/vue3Knowledge.html"/>
    <id>https://blog.kahvia.cn/2024/03/09/vue3Knowledge.html</id>
    <published>2024-03-09T10:28:17.575Z</published>
    <updated>2024-03-16T11:57:50.279Z</updated>
    
    <content type="html"><![CDATA[<h3 id="样式穿透"><a href="#样式穿透" class="headerlink" title="样式穿透"></a>样式穿透</h3><p>使用样式穿透，可以穿透子组件影响到下面的类的样式，做到对第三方组件的样式自定义。</p><h4 id="采用-gt-gt-gt"><a href="#采用-gt-gt-gt" class="headerlink" title="采用&gt;&gt;&gt;"></a>采用&gt;&gt;&gt;</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uni-data-picker&gt;&gt;&gt;<span class="selector-class">.input-value-border</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="采用-x2F-deep-x2F"><a href="#采用-x2F-deep-x2F" class="headerlink" title="采用 &#x2F;deep&#x2F;"></a>采用 &#x2F;deep&#x2F;</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uni-data-picker /deep/ <span class="selector-class">.input-value-border</span> &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="采用-v-deep"><a href="#采用-v-deep" class="headerlink" title="采用 ::v-deep"></a>采用 ::v-deep</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uni-data-picker::v-deep .input-value-border &#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">3px</span> solid orange;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="父组件获取子组件属性"><a href="#父组件获取子组件属性" class="headerlink" title="父组件获取子组件属性"></a>父组件获取子组件属性</h3><p>根据<a href="https://cn.vuejs.org/api/sfc-script-setup.html#defineexpose">官方文档</a>，采用组合式 api 编写的组件，内部定义的属性、方法，都是不对外开放的。可以调用 defineExpose() 方法，暴露需要的属性和方法。外部通过 ref 进行模板引用，即可访问暴露出来的属性和方法。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;uni-popup ref=&quot;popPage&quot; type=&quot;bottom&quot; background-color=&quot;#f7f7f7&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;boxBack&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;box&quot;&gt;</span><br><span class="line">                &lt;input type=&quot;nickname&quot; placeholder=&quot;请输入分类名称&quot; v-model=&quot;catName&quot;&gt;</span><br><span class="line">                &lt;button ref=&quot;nickBtn&quot; @click=&quot;&quot;&gt;确认&lt;/button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/uni-popup&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;;</span><br><span class="line"></span><br><span class="line">const popPage = ref(null);</span><br><span class="line">const catName = ref(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">function popUp() &#123;</span><br><span class="line">    console.log(popPage.value);</span><br><span class="line">    (popPage.value as any).open();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defineExpose(&#123;</span><br><span class="line">    popUp</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 弹出层样式 --&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="props设置默认值"><a href="#props设置默认值" class="headerlink" title="props设置默认值"></a>props设置默认值</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Boolean 类型的未传递 prop 将被转换为 false。————官方文档</span></span><br><span class="line"><span class="keyword">let</span> props = <span class="title function_">defineProps</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">showBack</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="watch-props的值"><a href="#watch-props的值" class="headerlink" title="watch props的值"></a>watch props的值</h3><p>要使用 getter 函数。此处的 props.catName 是一个外部传入常量，如果给 watch 这个东西，那么 watch 调用，生成监视的时候，收到的参数是一个常量，这不对。要给 watch 一个getter 函数，让它自己调用函数去看，这样监视器看到返回值跟之前不一样了，才知道发生了变化。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(<span class="function">() =&gt;</span> props.<span class="property">catName</span>, <span class="keyword">async</span> (oldCatName, newCatName) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> ((productsMap.<span class="property">value</span> <span class="keyword">as</span> <span class="built_in">any</span>)[props.<span class="property">catName</span>].<span class="property">length</span> == <span class="number">0</span>)</span><br><span class="line">        <span class="title function_">getProsByCatName</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://cn.vuejs.org/guide/essentials/watchers.html#watch-source-types">侦听器 | Vue.js (vuejs.org)</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;样式穿透&quot;&gt;&lt;a href=&quot;#样式穿透&quot; class=&quot;headerlink&quot; title=&quot;样式穿透&quot;&gt;&lt;/a&gt;样式穿透&lt;/h3&gt;&lt;p&gt;使用样式穿透，可以穿透子组件影响到下面的类的样式，做到对第三方组件的样式自定义。&lt;/p&gt;
&lt;h4 id=&quot;采用-gt-gt-</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="vue" scheme="https://blog.kahvia.cn/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>MemFireDb</title>
    <link href="https://blog.kahvia.cn/2024/03/06/MemFireDb.html"/>
    <id>https://blog.kahvia.cn/2024/03/06/MemFireDb.html</id>
    <published>2024-03-06T04:41:35.603Z</published>
    <updated>2024-03-07T09:02:09.613Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>以最近的 uniapp 开发微信小程序为例。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install @supabase/supabase-js</span><br><span class="line">npm install supabase-wechat-stable-v2</span><br></pre></td></tr></table></figure><h3 id="配置数据库连接"><a href="#配置数据库连接" class="headerlink" title="配置数据库连接"></a>配置数据库连接</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fireDb.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createClient &#125; <span class="keyword">from</span> <span class="string">&quot;supabase-wechat-stable-v2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//这两个常量可以在MemFireDb官网数据库的api中找到</span></span><br><span class="line"><span class="keyword">const</span> supabaseUrl = <span class="string">&quot;https://xxxx.baseapi.memfiredb.com&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> publicAnonKey = <span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>;</span><br><span class="line"><span class="comment">// Create a single supabase client for interacting with your database</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> supabase = <span class="title function_">createClient</span>(supabaseUrl, publicAnonKey);</span><br></pre></td></tr></table></figure><h3 id="微信授权手机号一键登陆"><a href="#微信授权手机号一键登陆" class="headerlink" title="微信授权手机号一键登陆"></a>微信授权手机号一键登陆</h3><p>在 uniapp 中，设置 button 的 open-type 为 getPhoneNumber，并监听事件getPhoneNumber。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;button class=&quot;btn&quot; open-type=&quot;getPhoneNumber&quot; @getphonenumber=&quot;wxLogin&quot;&gt;</span><br><span class="line">            &lt;image</span><br><span class="line">                src=&quot;data:image/svg+xml;base64,xxx&quot; /&gt;</span><br><span class="line">            &lt;text&gt;微信快捷登录&lt;/text&gt;</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>监听事件发生时，调用 wxLogin 函数，传入一个事件对象，根据 code 值判断是否获取到电话号码。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">wxLogin</span> = <span class="keyword">async</span> (<span class="params">e: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">    wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">async</span> res =&gt; &#123;</span><br><span class="line">            <span class="comment">//在getPhoneNumber事件中,如果code为undefined，则用户未授权，否则用户已经授权，获取到手机号码</span></span><br><span class="line">            <span class="keyword">if</span> (!e.<span class="property">detail</span>.<span class="property">code</span>) &#123;</span><br><span class="line">                wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">&quot;授权失败&quot;</span>,</span><br><span class="line">                    <span class="attr">icon</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">                    <span class="attr">duration</span>: <span class="number">2000</span></span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//微信登录，新用户则自动注册</span></span><br><span class="line">            <span class="keyword">const</span> &#123; data, error &#125; = <span class="keyword">await</span> supabase.<span class="property">auth</span>.<span class="title function_">signInWithWechat</span>(&#123; <span class="attr">code</span>: res.<span class="property">code</span> &#125;)</span><br><span class="line">            <span class="keyword">let</span> &#123; <span class="attr">user</span>: &#123; <span class="attr">data</span>: &#123; user &#125; &#125; &#125; = data <span class="keyword">as</span> <span class="built_in">any</span>;</span><br><span class="line">            <span class="title function_">setProfile</span>(user);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                    <span class="attr">title</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(error) || error?.<span class="property">message</span>,</span><br><span class="line">                    <span class="attr">icon</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">                    <span class="attr">duration</span>: <span class="number">2000</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data) &#123;</span><br><span class="line">                <span class="comment">//获取到用户信息后，绑定电话号码到小程序用户上</span></span><br><span class="line">                <span class="keyword">const</span> &#123; data, error &#125; = <span class="keyword">await</span> supabase.<span class="property">auth</span>.<span class="title function_">wechatBindPhone</span>(&#123;</span><br><span class="line">                    <span class="attr">code</span>: e.<span class="property">detail</span>.<span class="property">code</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                    wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(error) || error?.<span class="property">message</span>,</span><br><span class="line">                        <span class="attr">icon</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">                        <span class="attr">duration</span>: <span class="number">2000</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data) &#123;</span><br><span class="line">                    wx.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                        <span class="attr">title</span>: <span class="string">&#x27;登录成功！&#x27;</span>,</span><br><span class="line">                        <span class="attr">icon</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">                        <span class="attr">duration</span>: <span class="number">1000</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                    wx.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">                        <span class="attr">url</span>: <span class="string">&#x27;/pages/index/index&#x27;</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取微信头像"><a href="#获取微信头像" class="headerlink" title="获取微信头像"></a>获取微信头像</h3><p>操作与获取手机号码类似。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button class=&quot;avatarCoverBtn&quot; open-type=&quot;chooseAvatar&quot; @chooseavatar=&quot;chooseAvatar&quot;&gt;</span><br><span class="line">&lt;image class=&quot;avatar&quot; :src=&quot;profile.avatar&quot; mode=&quot;scaleToFill&quot; /&gt;</span><br><span class="line">&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>在获取到头像的本地路径后，需要转存到对象存储的存储桶中，获取对应的网络地址，然后更新数据库中的头像信息和小程序本地的头像信息。我采用 Pinia 进行状态管理，因此在 updateAvatar 函数中，对 userStore 里的头像信息进行了更新。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">chooseAvatar</span> = (<span class="params">e: <span class="built_in">any</span></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> &#123; avatarUrl &#125; = e.<span class="property">detail</span></span><br><span class="line">    wx.<span class="title function_">getImageInfo</span>(&#123;</span><br><span class="line">        <span class="attr">src</span>: avatarUrl, <span class="comment">// 图片路径，必须是本地路径，可以相对路径或绝对路径</span></span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> file = &#123; <span class="attr">fileType</span>: <span class="string">&quot;image&quot;</span>, <span class="attr">width</span>: res.<span class="property">width</span>, <span class="attr">height</span>: res.<span class="property">height</span>, <span class="attr">tempFilePath</span>: avatarUrl &#125;</span><br><span class="line">            <span class="keyword">const</span> fileExt = avatarUrl.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">pop</span>()</span><br><span class="line">            <span class="keyword">const</span> fileName = <span class="string">`<span class="subst">$&#123;<span class="built_in">Math</span>.random()&#125;</span>.<span class="subst">$&#123;fileExt&#125;</span>`</span></span><br><span class="line">            <span class="keyword">const</span> filePath = <span class="string">`<span class="subst">$&#123;profile.value.id&#125;</span>/<span class="subst">$&#123;fileName&#125;</span>`</span></span><br><span class="line">            <span class="keyword">let</span> &#123; <span class="attr">error</span>: uploadError &#125; = <span class="keyword">await</span> supabase.<span class="property">storage</span></span><br><span class="line">                .<span class="title function_">from</span>(<span class="string">&#x27;avatars&#x27;</span>)</span><br><span class="line">                .<span class="title function_">upload</span>(filePath, file <span class="keyword">as</span> <span class="built_in">any</span>)</span><br><span class="line">            <span class="keyword">if</span> (uploadError) &#123;</span><br><span class="line">                <span class="keyword">throw</span> uploadError</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取具有一年期限的头像url</span></span><br><span class="line">            <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> supabase</span><br><span class="line">                .<span class="property">storage</span></span><br><span class="line">                .<span class="title function_">from</span>(<span class="string">&#x27;avatars&#x27;</span>)</span><br><span class="line">                .<span class="title function_">createSignedUrl</span>(filePath, <span class="number">31556952</span>);</span><br><span class="line">            <span class="comment">//更新头像</span></span><br><span class="line">            <span class="title function_">updateAvatar</span>(data!.<span class="property">signedUrl</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>注：存储桶我设置为私有，且设置了行级安全策略，因此在存储头像的时候，需要存入对应 uid 文件夹下，否则没有权限。</p><blockquote><p><a href="https://document.memfiredb.com/docs/guides/storage#%E5%85%B1%E6%9C%89%E6%A1%B6%E5%92%8C%E7%A7%81%E6%9C%89%E6%A1%B6">存储桶的私有和共有</a>，详细描述了二者的区别，以及对应的获取资源 url 的方式。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h3&gt;&lt;p&gt;以最近的 uniapp 开发微信小程序为例。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="PostgreSQL" scheme="https://blog.kahvia.cn/tags/PostgreSQL/"/>
    
  </entry>
  
  <entry>
    <title>TypeScript</title>
    <link href="https://blog.kahvia.cn/2024/02/29/TypeScript.html"/>
    <id>https://blog.kahvia.cn/2024/02/29/TypeScript.html</id>
    <published>2024-02-29T05:43:41.729Z</published>
    <updated>2024-03-07T09:23:51.225Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g typescript</span><br></pre></td></tr></table></figure><h3 id="编译ts文件"><a href="#编译ts文件" class="headerlink" title="编译ts文件"></a>编译ts文件</h3><p>使用该命令可以将 ts 文件转换成可执行的 js 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc xxx.ts</span><br></pre></td></tr></table></figure><p>通过 node 命令执行相应的 js 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node xxx.js</span><br></pre></td></tr></table></figure><h3 id="直接运行ts文件"><a href="#直接运行ts文件" class="headerlink" title="直接运行ts文件"></a>直接运行ts文件</h3><p>先安装所需工具包。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g ts-node</span><br></pre></td></tr></table></figure><p>使用该工具包直接执行 ts 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ts-node xxx.ts</span><br></pre></td></tr></table></figure><h3 id="使用时的一些小问题"><a href="#使用时的一些小问题" class="headerlink" title="使用时的一些小问题"></a>使用时的一些小问题</h3><h4 id="类型本身定义是错误的"><a href="#类型本身定义是错误的" class="headerlink" title="类型本身定义是错误的"></a>类型本身定义是错误的</h4><p>比如，在使用 MemFireDB 的微信SDK开发小程序的时候，我使用了一个方法用于获取用户信息。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: &#123; user &#125; &#125; = <span class="keyword">await</span> supabase.<span class="property">auth</span>.<span class="title function_">getUser</span>();</span><br></pre></td></tr></table></figure><p>对于 user 对应的官方 type 是 User，如下所示。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">app_metadata</span>: <span class="title class_">UserAppMetadata</span></span><br><span class="line">  <span class="attr">user_metadata</span>: <span class="title class_">UserMetadata</span></span><br><span class="line">  <span class="attr">aud</span>: <span class="built_in">string</span></span><br><span class="line">  confirmation_sent_at?: <span class="built_in">string</span></span><br><span class="line">  recovery_sent_at?: <span class="built_in">string</span></span><br><span class="line">  email_change_sent_at?: <span class="built_in">string</span></span><br><span class="line">  new_email?: <span class="built_in">string</span></span><br><span class="line">  new_phone?: <span class="built_in">string</span></span><br><span class="line">  invited_at?: <span class="built_in">string</span></span><br><span class="line">  action_link?: <span class="built_in">string</span></span><br><span class="line">  email?: <span class="built_in">string</span></span><br><span class="line">  phone?: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">created_at</span>: <span class="built_in">string</span></span><br><span class="line">  confirmed_at?: <span class="built_in">string</span></span><br><span class="line">  email_confirmed_at?: <span class="built_in">string</span></span><br><span class="line">  phone_confirmed_at?: <span class="built_in">string</span></span><br><span class="line">  last_sign_in_at?: <span class="built_in">string</span></span><br><span class="line">  role?: <span class="built_in">string</span></span><br><span class="line">  updated_at?: <span class="built_in">string</span></span><br><span class="line">  identities?: <span class="title class_">UserIdentity</span>[]</span><br><span class="line">  factors?: <span class="title class_">Factor</span>[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然而经过实际打印输出我发现，这个 user 的数据结构如下所示。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;app_metadata&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;xxx&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxxx&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>所以正确的的 User 定义应该是下面这样的。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">data</span>:&#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="built_in">string</span></span><br><span class="line">      <span class="attr">app_metadata</span>: <span class="title class_">UserAppMetadata</span></span><br><span class="line">      <span class="attr">xxx</span>:xxxx</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>虽然我发现了错误，但我业务做一半，也不能不用这个了吧。所以我自己定义了一个 type ，如下所示。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MyUser</span> &#123;</span><br><span class="line">    <span class="attr">data</span>: <span class="title class_">User</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后使用断言 as 进行强制类型转换，先取消原有的类型声明，再声明为新的类型。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myUser = user <span class="keyword">as</span> <span class="built_in">unknown</span> <span class="keyword">as</span> <span class="title class_">MyUser</span>;</span><br></pre></td></tr></table></figure><p>这样一来，我就可以通过 myUser.data.id 这种形式，正常使用数据。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span c</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="ts" scheme="https://blog.kahvia.cn/tags/ts/"/>
    
  </entry>
  
  <entry>
    <title>uniapp知识点</title>
    <link href="https://blog.kahvia.cn/2024/02/29/Uniapp.html"/>
    <id>https://blog.kahvia.cn/2024/02/29/Uniapp.html</id>
    <published>2024-02-29T01:47:57.745Z</published>
    <updated>2024-03-21T10:44:40.402Z</updated>
    
    <content type="html"><![CDATA[<h3 id="在vscode中开发uniapp"><a href="#在vscode中开发uniapp" class="headerlink" title="在vscode中开发uniapp"></a>在vscode中开发uniapp</h3><h4 id="使用命令行创建uniapp项目"><a href="#使用命令行创建uniapp项目" class="headerlink" title="使用命令行创建uniapp项目"></a>使用命令行创建uniapp项目</h4><p>此处是vue3+ts。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx degit dcloudio/uni-preset-vue<span class="comment">#vite-ts my-vue3-project</span></span><br></pre></td></tr></table></figure><h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><ul><li>uni-create-view</li><li>uni-helper</li><li>uniapp小程序扩展</li></ul><h4 id="TS相关"><a href="#TS相关" class="headerlink" title="TS相关"></a>TS相关</h4><p>在根目录创建 <code>tsconfig.json</code> 文件，并进行个性化配置，个性化配置是可选的，没有<code>tsconfig.json</code>时会自动使用默认配置运行。推荐配置如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;esnext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;esnext&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preserve&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipLibCheck&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;importHelpers&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;allowSyntheticDefaultImports&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;useDefineForClassFields&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;esnext&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;dom&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;@dcloudio/types&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;@types/wechat-miniprogram&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;@uni-helper/uni-app-types&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;@uni-helper/uni-ui-types&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;@/*&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;src/*&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;vueCompilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;nativeTags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;block&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;component&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;template&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;slot&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;node_modules&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;unpackage&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;src/**/*.nvue&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>vueCompilerOptions以及nativeTags的配置是必须的。否则uniapp的标签比如view会出现<strong><a href="https://blog.csdn.net/weixin_41844140/article/details/134901640?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-134901640-blog-134186772.235%5Ev43%5Epc_blog_bottom_relevance_base3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-134901640-blog-134186772.235%5Ev43%5Epc_blog_bottom_relevance_base3&utm_relevant_index=2">类型错误</a></strong>。</p><p>baseUrl 和 paths 用于映射@&#x2F;开头的 import 路径。详情参考<a href="https://www.typescriptlang.org/zh/tsconfig#paths">TypeScript: TSConfig</a>。</p></blockquote><p>安装TS类型支持包。前者是微信小程序组件的TS类型，后者是uniapp组件的TS类型。这些类型已在上方配置文件中的types添加。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @types/wechat-miniprogram @uni-helper/uni-app-types</span><br></pre></td></tr></table></figure><h4 id="json文件相关"><a href="#json文件相关" class="headerlink" title="json文件相关"></a>json文件相关</h4><p>在 uniapp 项目中，我们可能会在 json 文件中有注释，vscode 识别 json 文件时，不允许有注释在其中，会报错，如下图所示。</p><p><img src="https://pics.kahvia.cn/img/20240301171803.png" alt="json文件内注释报错"></p><p>解决方法：在 vscode 的设置中，搜索 associations ，添加文件关联键值对，即<strong> xxx.json   jsonc </strong>。如下图所示，报错已消失。</p><p>注：.json 文件是标准的 json 格式，除了不允许有注释以外，还有其它的一些严格规则。.jsonc 文件则是拓展的 json 格式，能有注释在其中，以及可以省略 key 的引号等等。像 package.json 这种文件，最好还是不要加注释在里面。</p><p><img src="https://pics.kahvia.cn/img/20240301174049.png" alt="vscode文件关联"></p><h3 id="uni-ui"><a href="#uni-ui" class="headerlink" title="uni-ui"></a>uni-ui</h3><p><a href="https://uniapp.dcloud.net.cn/component/uniui/uni-ui.html">uni-ui 介绍 | uni-app官网 (dcloud.net.cn)</a></p><h4 id="安装-uni-ui-所需的-sass-预处理器和加载器"><a href="#安装-uni-ui-所需的-sass-预处理器和加载器" class="headerlink" title="安装 uni-ui 所需的 sass 预处理器和加载器"></a>安装 uni-ui 所需的 sass 预处理器和加载器</h4><p>安装 sass</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i sass -D   或   yarn add sass -D  </span><br></pre></td></tr></table></figure><p>安装 sass-loader</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i sass-loader@10.1.1 -D   或   yarn add sass-loader@10.1.1 -D</span><br></pre></td></tr></table></figure><h4 id="安装uni-ui"><a href="#安装uni-ui" class="headerlink" title="安装uni-ui"></a>安装uni-ui</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @dcloudio/uni-ui   或   yarn add @dcloudio/uni-ui</span><br></pre></td></tr></table></figure><h4 id="配置uni-ui组件自动导入"><a href="#配置uni-ui组件自动导入" class="headerlink" title="配置uni-ui组件自动导入"></a>配置uni-ui组件自动导入</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;easycom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;autoscan&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;custom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="comment">// uni-ui 规则如下配置</span></span><br><span class="line"><span class="attr">&quot;^uni-(.*)&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@dcloudio/uni-ui/lib/uni-$1/uni-$1.vue&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 其他内容</span></span><br><span class="line">pages<span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="安装-uni-ui-的-ts-类型包"><a href="#安装-uni-ui-的-ts-类型包" class="headerlink" title="安装 uni-ui 的 ts 类型包"></a>安装 uni-ui 的 ts 类型包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @uni-helper/uni-ui-types</span><br></pre></td></tr></table></figure><p>然后在 tsconfig.json 中的 types 里写上对应的类型。现在就可以在 uni-ui 的组件标签上看到对应的类型了。</p><h3 id="Pinia"><a href="#Pinia" class="headerlink" title="Pinia"></a>Pinia</h3><h4 id="pinia本体"><a href="#pinia本体" class="headerlink" title="pinia本体"></a>pinia本体</h4><p>本人采用 vue 版本 3.4.21, pinia 版本 2.0.36，不会发生依赖冲突以及各种报错。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i pinia@2.0.36</span><br></pre></td></tr></table></figure><p>创建 pinia 实例。</p><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(pinia)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><h5 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h5><p>使用 <a href="https://pinia.vuejs.org/zh/core-concepts/#using-the-store">storeToRefs()</a> 取出 store 中的响应式数据。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&#x27;../../stores/piniaStores&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line"><span class="keyword">const</span> &#123;nickName&#125; = <span class="title function_">storeToRefs</span>(userStore);</span><br></pre></td></tr></table></figure><h4 id="pinia的持久化插件"><a href="#pinia的持久化插件" class="headerlink" title="pinia的持久化插件"></a>pinia的持久化插件</h4><p><a href="https://prazdevs.github.io/pinia-plugin-persistedstate/">Home | pinia-plugin-persistedstate (prazdevs.github.io)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i pinia-plugin-persistedstate</span><br></pre></td></tr></table></figure><p>注意：是 pinia-plugin-persistedstate 这个插件，而非 <a href="https://seb-l.github.io/pinia-plugin-persist/">pinia-plugin-persist</a> 这个坑比插件。后者使用自定义 Storage 的时候，比如我是用的 uni 的storage，会报错说没有sessionStorage，这让我研究了一下午自己的官方文档，怀疑是自己的问题，最后得出结论是插件官方的问题。</p><p>在 main.ts 中配置持久化。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> piniaPluginPersistedstate <span class="keyword">from</span> <span class="string">&#x27;pinia-plugin-persistedstate&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>()</span><br><span class="line">pinia.<span class="title function_">use</span>(piniaPluginPersistedstate)</span><br></pre></td></tr></table></figure><p>我配置完成后是如下所示。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSSRApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Pinia</span> <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> piniaPluginPersistedstate <span class="keyword">from</span> <span class="string">&#x27;pinia-plugin-persistedstate&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">createApp</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="title function_">createSSRApp</span>(<span class="title class_">App</span>);</span><br><span class="line">  <span class="keyword">const</span> pinia = <span class="title class_">Pinia</span>.<span class="title function_">createPinia</span>();</span><br><span class="line">  pinia.<span class="title function_">use</span>(piniaPluginPersistedstate);</span><br><span class="line">  app.<span class="title function_">use</span>(pinia);</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    app,</span><br><span class="line">    <span class="title class_">Pinia</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>因为是为了 uniapp 采用的 pinia ，而 uniapp 没有 sessionStorage ，所以在定义 store 的时候需要自定义 storage。参考代码如下。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">StorageLike</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia-plugin-persistedstate&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">uniStorege</span>: <span class="title class_">StorageLike</span> = &#123;</span><br><span class="line">    <span class="title function_">setItem</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">        uni.<span class="title function_">setStorageSync</span>(key, value);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">getItem</span>(<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> uni.<span class="title function_">getStorageSync</span>(key);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 你可以对 `defineStore()` 的返回值进行任意命名，但最好使用 store 的名字，同时以 `use` 开头且以 `Store` 结尾。(比如 `useUserStore`，`useCartStore`，`useProductStore`)</span></span><br><span class="line"><span class="comment">// 第一个参数是你的应用中 Store 的唯一 ID。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useUserStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;user&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> nickName = <span class="title function_">ref</span>(<span class="string">&quot;Kahvia&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setName</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">        nickName.<span class="property">value</span> = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; nickName, setName &#125;;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">persist</span>: &#123;</span><br><span class="line">        <span class="attr">storage</span>: uniStorege,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>关于插件的其它可选配置，可以参照官方文档。</p><h3 id="为-uniapp-的请求添加拦截器"><a href="#为-uniapp-的请求添加拦截器" class="headerlink" title="为 uniapp 的请求添加拦截器"></a>为 uniapp 的请求添加拦截器</h3><p>拦截器的作用是，在请求发送前拦截请求，或收到请求结果后拦截结果，对请求或结果作一定的处理后，再放行。常用于简化操作，比如发送请求前统一添加域名前缀，或收到请求结果后提取关键数据、展示错误信息等。减少了代码的冗余。ps：比如我以前做项目的时候，都是在一个 js 文件中定义常量 baseUrl，在有请求的页面引入该 js 文件，采用 baseUrl + ‘&#x2F;user&#x2F;upload’ 这种形式的代码，这意味着我有多少个请求，我就写了多少个这样的拼接代码，的确写了很多无用代码。</p><p>以下代码块则展示了如何添加请求发送前的拦截器。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//utils/http.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&quot;@/stores/piniaStores&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">baseUrl</span>: <span class="built_in">string</span> = <span class="string">&quot;https://www.kahvia.cn&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> httpInterceptor = &#123;</span><br><span class="line">    <span class="title function_">invoke</span>(<span class="params">options: UniApp.RequestOptions</span>) &#123;</span><br><span class="line">        <span class="comment">//请求添加前缀</span></span><br><span class="line">        <span class="keyword">if</span> (!options.<span class="property">url</span>.<span class="title function_">startsWith</span>(<span class="string">&quot;http&quot;</span>))</span><br><span class="line">            options.<span class="property">url</span> = baseUrl + options.<span class="property">url</span>;</span><br><span class="line">        <span class="comment">//设置超时时间</span></span><br><span class="line">        options.<span class="property">timeout</span> = <span class="number">10000</span>;</span><br><span class="line">        <span class="comment">//设置请求头</span></span><br><span class="line">        options.<span class="property">header</span> = &#123;</span><br><span class="line">            <span class="comment">//保留原有请求头</span></span><br><span class="line">            ...options.<span class="property">header</span>,</span><br><span class="line">            <span class="comment">//添加请求来源</span></span><br><span class="line">            <span class="string">&#x27;source-client&#x27;</span>: <span class="string">&#x27;miniapp&#x27;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">const</span> userStore = <span class="title function_">useUserStore</span>();</span><br><span class="line">        <span class="keyword">const</span> token = userStore.<span class="property">profile</span>?.<span class="property">token</span>;</span><br><span class="line">        <span class="keyword">if</span> (token)</span><br><span class="line">            options.<span class="property">header</span>.<span class="property">Authorization</span> = token;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uni.<span class="title function_">addInterceptor</span>(<span class="string">&quot;request&quot;</span>, httpInterceptor);</span><br><span class="line">uni.<span class="title function_">addInterceptor</span>(<span class="string">&quot;uploadFile&quot;</span>, httpInterceptor);</span><br></pre></td></tr></table></figure><p>uniapp 中没有关于请求结果的拦截器，得用 Promise 手动封装。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//utils/http.ts</span></span><br><span class="line"><span class="comment">//接上个拦截器代码块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//自己封装的数据类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Data</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="built_in">number</span>,</span><br><span class="line">    <span class="attr">msg</span>: <span class="built_in">string</span>,</span><br><span class="line">    <span class="attr">data</span>: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//封装uni-request，对数据结果进行统一处理，即拦截请求结果。上面的interceptor是请求发送前拦截。</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> http = &lt;T&gt;<span class="function">(<span class="params">options: UniApp.RequestOptions</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;<span class="title class_">Data</span>&lt;T&gt;&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">            ...options,</span><br><span class="line">            <span class="comment">//服务器有响应结果，不管状态码是200还是401亦或是500，都会走success函数。</span></span><br><span class="line">            <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="comment">//状态码正常，则resolve，axios内部也是如此实现的。</span></span><br><span class="line">                <span class="keyword">if</span> (res.<span class="property">statusCode</span> &gt;= <span class="number">200</span> &amp;&amp; res.<span class="property">statusCode</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line">                    <span class="comment">//用as对返回类型进行断言</span></span><br><span class="line">                    <span class="title function_">resolve</span>(res.<span class="property">data</span> <span class="keyword">as</span> <span class="title class_">Data</span>&lt;T&gt;);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.<span class="property">statusCode</span> == <span class="number">401</span>) &#123;</span><br><span class="line">                    <span class="comment">//401代表token无效，身份验证失败</span></span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Authorization error&quot;</span>);</span><br><span class="line">                    uni.<span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&quot;身份验证失效，请重新登录&quot;</span> &#125;);</span><br><span class="line">                    <span class="title function_">reject</span>(res);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    uni.<span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&quot;服务器异常&quot;</span> &#125;);</span><br><span class="line">                    <span class="title function_">reject</span>(res);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//服务器没有返回结果，代表请求未成功发送，即网络异常。</span></span><br><span class="line">            <span class="title function_">fail</span>(<span class="params">err</span>) &#123;</span><br><span class="line">                uni.<span class="title function_">showToast</span>(&#123; <span class="attr">title</span>: <span class="string">&quot;网络异常，请检查网络&quot;</span> &#125;)</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样一来，自己封装的网络请求模块就完成了。在需要的地方导入使用即可。</p><p>注：泛型 T 的使用是为了更好地处理数据。每个请求返回的 data 部分都是变化的，有的是字符数组，有的是对象数组，根据选择使用。</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;http&#125; <span class="keyword">from</span> <span class="string">&#x27;@/utils/http&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">clickTest</span>(<span class="params"></span>)&#123;</span><br><span class="line">    userStore.<span class="title function_">setName</span>(<span class="string">&quot;Adong&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> http&lt;<span class="built_in">string</span>[]&gt;(&#123;</span><br><span class="line">      <span class="attr">method</span>:<span class="string">&quot;GET&quot;</span>,</span><br><span class="line">      <span class="attr">url</span>:<span class="string">&quot;/test&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当请求的结果有效，即 resolve 后，该 Promise 对象的状态会变成 fulfilled（已兑现），变量 res 有了有效值，继续执行下面的 log 语句。当请求的结果无效，即 reject 后，该 Promise 对象的状态变为 rejected（已拒绝），此时异步函数直接结束，不会执行下面的 log 语句。</p><p>注：Promise 对象的初始状态为 pending（待定）。</p><h3 id="uniapp知识点"><a href="#uniapp知识点" class="headerlink" title="uniapp知识点"></a>uniapp知识点</h3><h4 id="svg"><a href="#svg" class="headerlink" title="svg"></a>svg</h4><p>uniapp 中不支持 svg 标签，所以涉及到的 svg 图片可以转换成 base64 进行使用。</p><p><a href="https://www.zhangxinxu.com/sp/svgo/">SVG在线工具</a>。通过这个工具我们可以实现上述操作。我就用这个工具将 iconfont 上面的图标转换成了 base64 ，用 img 标签进行了插入。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;searchIcon&quot;</span>           <span class="attr">src</span>=<span class="string">&quot;data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PHBhdGggZD0iTTEwMjQgOTYzLjdMNzU2LjggNjk2LjVjNjAuMi03My42IDk2LjUtMTY3LjUgOTYuNS0yNjkuOEM4NTMuMyAxOTEuNCA2NjEuOSAwIDQyNi43IDBTMCAxOTEuNCAwIDQyNi43czE5MS40IDQyNi43IDQyNi43IDQyNi43YzEwMi4zIDAgMTk2LjMtMzYuMyAyNjkuOC05Ni41TDk2My43IDEwMjRsNjAuMy02MC4zek00MjYuNyA3NjhDMjM4LjUgNzY4IDg1LjMgNjE0LjkgODUuMyA0MjYuN1MyMzguNSA4NS4zIDQyNi43IDg1LjMgNzY4IDIzOC41IDc2OCA0MjYuNyA2MTQuOSA3NjggNDI2LjcgNzY4eiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="自定义导航栏"><a href="#自定义导航栏" class="headerlink" title="自定义导航栏"></a>自定义导航栏</h4><p>设置 navigationStyle 为 custom 以取消默认导航栏。然后手写导航栏组件添加到页面中使用即可。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;easycom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;autoscan&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;custom&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="comment">// uni-ui 规则如下配置</span></span><br><span class="line"><span class="attr">&quot;^uni-(.*)&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@dcloudio/uni-ui/lib/uni-$1/uni-$1.vue&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">//pages数组中第一项表示应用启动页，参考：https://uniapp.dcloud.io/collocation/pages</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="comment">//取消默认导航栏</span></span><br><span class="line"><span class="attr">&quot;navigationStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;custom&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;首页&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;navigationBarTextStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;white&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;globalStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;navigationBarTextStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uni-app&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment">// &quot;navigationBarBackgroundColor&quot;: &quot;#F8F8F8&quot;,</span></span><br><span class="line"><span class="comment">// &quot;backgroundColor&quot;: &quot;#F8F8F8&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="image标签"><a href="#image标签" class="headerlink" title="image标签"></a>image标签</h4><p>uniapp 中不能使用 img 标签。使用 img 标签后，会被解析成 image 标签，导致为 img 写的 css 样式失效。</p><h4 id="样式隔离"><a href="#样式隔离" class="headerlink" title="样式隔离"></a>样式隔离</h4><p>在某些情况下，比如我写了一个组件，里面用到了 uniapp 提供的内置组件，如 uni-file-picker ，当我尝试通过 vue 的样式穿透去修改内置组件的样式时，怎么改都不行，用上 !important 也不行，在调试的时候看穿透的样式根本没修改成功。这时候或许就是 uniapp 自带的样式隔离起了作用。使用以下代码进行样式隔离的取消，可以解决问题。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    options: &#123;</span><br><span class="line">        styleIsolation: &#x27;shared&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>非常傻逼的一个问题。<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html#%E7%BB%84%E4%BB%B6%E6%A0%B7%E5%BC%8F%E9%9A%94%E7%A6%BB">样式隔离。</a>这个文档是微信官方文档，因此推断是微信小程序的特有设定。</p><h4 id="禁止手指滑动"><a href="#禁止手指滑动" class="headerlink" title="禁止手指滑动"></a>禁止手指滑动</h4><p>在自定义的加载遮罩显示时，需要禁止手指滑动，以防下面的页面被滑动。</p><p>在最外层添加 @touchmove.stop.prevent&#x3D;”() &#x3D;&gt; { }” 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div @touchmove.stop.prevent=&quot;() =&gt; &#123; &#125;&quot; class=&quot;loading&quot; :class=&quot;&#123; alignTop: ifAlignTop, alignBottom: !ifAlignTop &#125;&quot;</span><br><span class="line">        v-if=&quot;isLoading&quot;&gt;</span><br><span class="line">        &lt;uni-load-more icon-type=&quot;circle&quot; color=&quot;white&quot; status=&quot;loading&quot; :icon-size=&quot;30&quot;</span><br><span class="line">            :content-text=&quot;&#123; contentrefresh: content, contentdown: &#x27;&#x27;, contentnomore: &#x27;&#x27; &#125;&quot; /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h4 id="自定义遮罩的位置问题"><a href="#自定义遮罩的位置问题" class="headerlink" title="自定义遮罩的位置问题"></a>自定义遮罩的位置问题</h4><p>在 uniapp 中，App.vue 文件中并不能写 template ，所以全局遮罩并不方便实现。 所以需要定义一个遮罩组件，在每个页面分别引入使用。</p><p>然而，遮罩放在每个页面的根节点下有时也并不方便。举个例子，遮罩的高度一般是100vh，假设我通过绝对定位对页面进行上左对齐，当页面可以滚动的时候，即页面高度大于100vh的时候，如果我在页面底部触发了遮罩，由于遮罩高度不够，页面底部就是无遮罩状态。如果我对遮罩的高度预设成300vh，可以达到遮住底部的效果，但是遮罩中间的加载用的提示信息又跑到了别处，而不在屏幕中间。想要动态控制遮罩的高度或者其中的文字位置是不现实的，每个页面的高度都不一样，而 uniapp 中又不容易获取滚动高度。</p><p><del>因此，固定遮罩的高度为100vh，尝试调整遮罩的引入位置以及对齐位置才是更合理的做法。比如我在页面底部触发了从底部弹出的弹出层，那么封装一个组件，引入弹出层和遮罩层，将自定义组件标记为相对定位，遮罩层标记为绝对定位，并使遮罩下左对齐。</del></p><h4 id="scroll-view-滚动条问题"><a href="#scroll-view-滚动条问题" class="headerlink" title="scroll-view 滚动条问题"></a>scroll-view 滚动条问题</h4><p>在微信小程序中，仅设置 show-scrollbar &#x3D; “false” 是没用的，同时还要设置 enhanced &#x3D; “true”。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;scroll-view :scroll-y=&quot;true&quot; class=&quot;cats&quot; :show-scrollbar=&quot;false&quot; :enhanced=&quot;true&quot;&gt;</span><br><span class="line">        &lt;div :key=&quot;index&quot; v-for=&quot;(cat, index) in categories&quot; class=&quot;cat&quot; :class=&quot;&#123; catActive: catIsActive(index) &#125;&quot;</span><br><span class="line">            @click=setActive(index)&gt;</span><br><span class="line">            &lt;text&gt;&#123;&#123; cat.name &#125;&#125;&lt;/text&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">&lt;/scroll-view&gt;</span><br></pre></td></tr></table></figure><p>别用uniapp的这个组件写 flex 布局。因为flex布局中的 align-content 会无效，调了一下午没吊用。🐕都不用。自己写的 flex 布局盒子好用的一批。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;在vscode中开发uniapp&quot;&gt;&lt;a href=&quot;#在vscode中开发uniapp&quot; class=&quot;headerlink&quot; title=&quot;在vscode中开发uniapp&quot;&gt;&lt;/a&gt;在vscode中开发uniapp&lt;/h3&gt;&lt;h4 id=&quot;使用命令行创建un</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="uniapp" scheme="https://blog.kahvia.cn/tags/uniapp/"/>
    
  </entry>
  
  <entry>
    <title>使用nrm管理npm镜像源</title>
    <link href="https://blog.kahvia.cn/2024/02/04/NpmMirrorManage.html"/>
    <id>https://blog.kahvia.cn/2024/02/04/NpmMirrorManage.html</id>
    <published>2024-02-04T09:58:19.119Z</published>
    <updated>2024-02-04T10:11:02.834Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装nrm"><a href="#安装nrm" class="headerlink" title="安装nrm"></a>安装nrm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g nrm</span><br></pre></td></tr></table></figure><h3 id="查看镜像源"><a href="#查看镜像源" class="headerlink" title="查看镜像源"></a>查看镜像源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm <span class="built_in">ls</span></span><br></pre></td></tr></table></figure><h3 id="选用镜像源"><a href="#选用镜像源" class="headerlink" title="选用镜像源"></a>选用镜像源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nrm use xxx</span><br></pre></td></tr></table></figure><p>比如<strong>nrm use taobao</strong>。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;安装nrm&quot;&gt;&lt;a href=&quot;#安装nrm&quot; class=&quot;headerlink&quot; title=&quot;安装nrm&quot;&gt;&lt;/a&gt;安装nrm&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="node.js" scheme="https://blog.kahvia.cn/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>基础算法</title>
    <link href="https://blog.kahvia.cn/2024/01/15/AlgorithmAcBase1.html"/>
    <id>https://blog.kahvia.cn/2024/01/15/AlgorithmAcBase1.html</id>
    <published>2024-01-15T10:16:23.498Z</published>
    <updated>2024-01-28T14:27:25.713Z</updated>
    
    <content type="html"><![CDATA[<h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><ol><li>选取基准值（分界值）x，可以是数组的第一个元素，也可以是数组的最后一个元素，中间元素亦可。</li><li>使用双指针<strong> i  </strong>和 <strong>j</strong> 从数组的两端开始扫描，从左端找到一个<strong>&gt;&#x3D;x</strong>的值a，从右端找到一个<strong>&lt;&#x3D;x</strong>的值b，交换ab的值，交换后<strong>i以及i之前的元素</strong>都小于等于x，<strong>j以及j之后的元素</strong>都大于等于x。交换后i应递增，j应递减，继续查找可以交换的值，知道ij相遇甚至错开（i &gt; j）。</li><li>当数组成功划分两部分，左部分小于等于x，右部分大于等于x的时候，左右两部分分别递归调用快速排序。</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/4.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> t[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> i = l - <span class="number">1</span>, j = r + <span class="number">1</span>, x = t[(l + r) / <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(i &lt; j)&#123;</span><br><span class="line">        <span class="comment">//基准值元素也可以交换，在左区间或者右区间都可以，因此while (t[i] &lt; x);没有等号=。</span></span><br><span class="line">        <span class="comment">//如果是不能交换，即while (t[i] &lt;= x);</span></span><br><span class="line">        <span class="comment">//那么比如6 2 3，基准值为2时。从左边找到了一个比2大的值6，但是从右边找不到比2小的，j--会一直执行，死循环了。</span></span><br><span class="line">        <span class="keyword">do</span> i++; <span class="keyword">while</span> (t[i] &lt; x);</span><br><span class="line">        <span class="keyword">do</span> j--; <span class="keyword">while</span> (t[j] &gt; x);</span><br><span class="line">        <span class="keyword">if</span>(i &lt; j) <span class="built_in">swap</span>(t[i],t[j]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*在划分区间递归调用快排的时候，i==j或者i&gt;j</span></span><br><span class="line"><span class="comment">     ①当i==j时，举例数组为2 1. l==0，r==1。区间为[0,1]。</span></span><br><span class="line"><span class="comment">        x = t[(l + r) / 2];取值为x=2，相当于取数组首元素为基准值，经过循环后i==j==0。</span></span><br><span class="line"><span class="comment">        正确的分法：划分区间应为[0,0]和[1,1]，即[l, j]和[j + 1, r]，或者将j换成i。</span></span><br><span class="line"><span class="comment">        也就是将相遇处的元素划分给右区间。</span></span><br><span class="line"><span class="comment">        错误的分法：如果划分给左区间，即[l, j - 1]和[j, r]的话，区间为[0,-1]和[0,1]。</span></span><br><span class="line"><span class="comment">        右区间的快排与当前快排区间相同，导致右区间递归与当前相同，陷入死循环。</span></span><br><span class="line"><span class="comment">        若想使得该分法正确，应当x = t[(l + r + 1) / 2]，即取数组尾元素为基准值。</span></span><br><span class="line"><span class="comment">     ②当i&gt;j时。举例，在上一轮while中交换ij元素后，进入下一轮while循环前，</span></span><br><span class="line"><span class="comment">        i == 1, j == 2，进入循环后，i++变成2，j--变成1，此时发生i &gt; j的情况。且&lt;2的元素&lt;=x, &gt;1的元素&gt;=x。</span></span><br><span class="line"><span class="comment">        这种情况下划分区间时，根据①的两种分法，为了保证划分的正确性:</span></span><br><span class="line"><span class="comment">        若取数组首元素为基准值，则应采用j,即[l, j]和[j + 1, r]。</span></span><br><span class="line"><span class="comment">        如果采用[l, i]和[i + 1, r]，右区间为[3, r]很显然缺少了下标2对应的&gt;=x的元素，同理左区间会多一个。</span></span><br><span class="line"><span class="comment">        若取数组尾元素为基准值，则应采用i,即[l, i - 1]和[i, r]。原理同上。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     总结：一整个快速排序中包含很多个小快速排序，可能出现i==j和i&gt;j的情况。因此，为了确保两种情况下都正常运行，分类如下。</span></span><br><span class="line"><span class="comment">     ①x = t[(l + r) / 2];或者说取左端点元素为基准值的情况下，递归区间划分[l, j]和[j + 1, r]。</span></span><br><span class="line"><span class="comment">     ②x = t[(l + r + 1) / 2]；或者说取右端点元素为基准值的情况下，递归区间划分[l, i - 1]和[i, r]。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">quick_sort</span>(l,j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(j + <span class="number">1</span>,r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;t[i]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">quick_sort</span>(<span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,t[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h3><ol><li>数组一分为二，递归调用归并排序。</li><li>利用双指针，合并一分为二的数组，将结果存到额外数组 tmp 中。</li><li>合并完成后，将结果数组覆盖至原数组中。</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/16.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> t[N], tmp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//右移等同除以二</span></span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从数组中间一分为二，各自归并排序</span></span><br><span class="line">    <span class="built_in">merge_sort</span>(l, mid), <span class="built_in">merge_sort</span>(mid + <span class="number">1</span>, r);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//k是结果数组的下一个放置元素的位置，ij为数组左右两部分的起始指针</span></span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>, i = l, j = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//比较ij指针值的大小，择其小存于结果中</span></span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid &amp;&amp; j &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(t[i] &lt;= t[j]) tmp[k++] = t[i++];</span><br><span class="line">        <span class="keyword">else</span> tmp[k++] = t[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//当某一部分已经全部加入结果后，另一部分的剩余元素直接加入结果</span></span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid) tmp[k++] = t[i++];</span><br><span class="line">    <span class="keyword">while</span>(j &lt;= r) tmp[k++] = t[j++];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用有序的结果覆盖原来无序的数组</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = l, j = <span class="number">0</span>; i &lt;= r; i++,j++)</span><br><span class="line">        t[i] = tmp[j];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t[i]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">merge_sort</span>(<span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, t[i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="归并排序的应用——求解逆序对数量"><a href="#归并排序的应用——求解逆序对数量" class="headerlink" title="归并排序的应用——求解逆序对数量"></a>归并排序的应用——求解逆序对数量</h4><p>对于任意给定的数字序列，举例如<strong> 4 3 2 1 </strong>，若交换相邻元素，可以减少一个逆序对而不影响这两个元素于其它元素的逆序关系。此处交换<strong> 4 , 3 </strong>会得到<strong> 3 4 2 1 </strong>，可以发现，前半部分元素与后半部分的逆序关系保持不变，前半部分内部消除了一个逆序对。</p><p>因此，我们可以考虑将数组一分为二，左右两部分分别消除内部逆序对，得到两个有序的序列，再消除序列之间的逆序对。若有两个有序序列为<strong> 2 4 6 </strong>和<strong> 1 3 5 </strong>，使用双指针分别指向两个序列开头，将序列2的小元素移到大序列的前面，比如1移到2的前面，越过了2 4 6三个元素，那么就减少了三个逆序对。多次操作，直到大序列整体有序。</p><p>很显然，上述的操作就是归并排序的一种表现。将数组不断地一分为二，当一组只有两个元素的时候，对这一组一分为二成两个序列，每个序列一个元素，使用双指针归并后，表现为逆序的两个元素交换位置。同样长度为2的毗邻序列各自有序，同样可以使用双指针进行逆序对的消除。</p><p>因此，求解逆序对的数量，我们只需要在归并排序中，保存序列2元素越过的序列1元素个数即可。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/17.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//逆序对的数量</span></span><br><span class="line"><span class="comment">//https://www.acwing.com/problem/content/790/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> t[N], tmp[N];</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> counts = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">calculate_reverse_pair</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">calculate_reverse_pair</span>(l, mid), <span class="built_in">calculate_reverse_pair</span>(mid + <span class="number">1</span>, r);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>, i = l, j = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid &amp;&amp; j &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(t[i] &lt;= t[j]) &#123;</span><br><span class="line">            tmp[k++] = t[i++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            tmp[k++] = t[j++];</span><br><span class="line">            <span class="comment">//将后半部分的小元素移到前半部分时，越过的前半部分元素个数即为逆序对个数</span></span><br><span class="line">            counts += (mid - i + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(i &lt;= mid) tmp[k++] = t[i++];</span><br><span class="line">    <span class="keyword">while</span>(j &lt;= r) tmp[k++] = t[j++];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = l, j = <span class="number">0</span>; i &lt;= r; i++, j++)</span><br><span class="line">        t[i] = tmp[j];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%lld&quot;</span>, &amp;t[i]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">calculate_reverse_pair</span>(<span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld&quot;</span>, counts);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="二分"><a href="#二分" class="headerlink" title="二分"></a>二分</h3><p>二分就是寻找一个边界，将整个数组一分为二，一边满足性质，另一边不满足。</p><h4 id="整数二分"><a href="#整数二分" class="headerlink" title="整数二分"></a>整数二分</h4><p><a href="https://www.acwing.com/problem/content/791/">AcWing—数的范围</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/16.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> t[N];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, q;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;t[i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>, r = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">            <span class="type">int</span> mid = l + r &gt;&gt; <span class="number">1</span>;</span><br><span class="line">            <span class="comment">//查找x1位置时，x1以及其后元素都满足&gt;=x这个性质</span></span><br><span class="line">            <span class="comment">//当mid对应元素满足性质时，x1应在mid或者mid前，更新右区间为mid</span></span><br><span class="line">            <span class="keyword">if</span>(t[mid] &gt;= x) r = mid;</span><br><span class="line">            <span class="comment">//当mid对应元素不满足性质时，x1应在mid后，更新左区间为mid + 1.</span></span><br><span class="line">            <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(t[l] != x) <span class="built_in">printf</span>(<span class="string">&quot;-1 -1\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, l);</span><br><span class="line">            <span class="type">int</span> l = <span class="number">0</span>, r = n - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(l &lt; r)&#123;</span><br><span class="line">                <span class="comment">//在l == mid == r - 1时，若是t[mid]满足性质，左区间会更新为mid</span></span><br><span class="line">                <span class="comment">//为防止死循环，mid应上取整</span></span><br><span class="line">                <span class="type">int</span> mid = l + r + <span class="number">1</span> &gt;&gt; <span class="number">1</span>;</span><br><span class="line">                <span class="comment">//查找x_last元素位置时，x_last及其前面元素满足&lt;=x的性质</span></span><br><span class="line">                <span class="comment">//当mid对应元素满足该性质时，x_last应在mid或者mid后，更新左区间为mid</span></span><br><span class="line">                <span class="comment">//当mid对应元素不满足时，x_last应在mid前，更新右区间为mid - 1</span></span><br><span class="line">                <span class="keyword">if</span>(t[mid] &lt;= x) l = mid;</span><br><span class="line">                <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, l);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="浮点数二分"><a href="#浮点数二分" class="headerlink" title="浮点数二分"></a>浮点数二分</h4><p><a href="https://www.acwing.com/problem/content/792/">AcWing—三次方根</a></p><p>在求解次方根的问题中，需要注意，当x处于(0,1)的区间内时，其n次方根的结果会大于x。比如0.01的平方根是0.1。因此在使用二分求解n次方根的时候，我们需要将右边界加1。</p><p>二分结束的条件设置为一定的精度，比如当结果保留6位小数的时候，我们可以设置精度为1e-8，保留7位则1e-9，以此类推。确保结果的准确性。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/16.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">double</span> x;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>, &amp;x);</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> aboveZero = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">0</span>) aboveZero = <span class="literal">false</span>, x = <span class="number">0</span> - x;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> l = <span class="number">0</span>, r = x + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(r - l &gt; <span class="number">1e-8</span>)&#123;</span><br><span class="line">        <span class="type">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(mid*mid*mid &gt;= x) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lf&quot;</span>, !aboveZero?-l:l);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="高精度"><a href="#高精度" class="headerlink" title="高精度"></a>高精度</h3><h4 id="加法"><a href="#加法" class="headerlink" title="加法"></a>加法</h4><p>利用数组存储两个很长很长的数。数的高位存在数组的后面，地位存在数组的前面。这样一来，加法最高位进位的时候，可以方便地在数的最高位前面补上进位数。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/18.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">add</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;A, vector&lt;<span class="type">int</span>&gt; &amp;B)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; C;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; t != <span class="number">0</span> || i &lt; A.<span class="built_in">size</span>() || i &lt; B.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i &lt; A.<span class="built_in">size</span>()) t += A[i];</span><br><span class="line">        <span class="keyword">if</span>(i &lt; B.<span class="built_in">size</span>()) t += B[i];</span><br><span class="line">        C.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t = t &gt;= <span class="number">10</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    string a, b;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; A, B;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = a.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) A.<span class="built_in">push_back</span>(a[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = b.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) B.<span class="built_in">push_back</span>(b[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> C = <span class="built_in">add</span>(A, B);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(C.<span class="built_in">size</span>() != <span class="number">0</span>)&#123;</span><br><span class="line">        cout &lt;&lt; C.<span class="built_in">back</span>();</span><br><span class="line">        C.<span class="built_in">pop_back</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="减法（正减正）"><a href="#减法（正减正）" class="headerlink" title="减法（正减正）"></a>减法（正减正）</h4><p>类似加法，注意借位即可。为了方便，我们可以提前判断运算数的大小，始终用大的减小的。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/18.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//比较两个数的大小</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;A, vector&lt;<span class="type">int</span>&gt; &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(A.<span class="built_in">size</span>() != B.<span class="built_in">size</span>()) <span class="keyword">return</span> A.<span class="built_in">size</span>() &gt;= B.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = A.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">        <span class="keyword">if</span>(A[i] &gt; B[i]) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(A[i] &lt; B[i]) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sub</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;A, vector&lt;<span class="type">int</span>&gt; &amp;B)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; C;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; t != <span class="number">0</span> || i &lt; A.<span class="built_in">size</span>() || i &lt; B.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        <span class="comment">//A位减去被借的位</span></span><br><span class="line">        <span class="keyword">if</span>(i &lt; A.<span class="built_in">size</span>()) t = A[i] - t;</span><br><span class="line">        <span class="comment">//再减B位</span></span><br><span class="line">        <span class="keyword">if</span>(i &lt; B.<span class="built_in">size</span>()) t -= B[i];</span><br><span class="line">        <span class="comment">//若位运算结果为负数，代表需要借位。+10取余为借位后的结果。若不需借位也无妨，+10取余为0。</span></span><br><span class="line">        C.<span class="built_in">push_back</span>((t + <span class="number">10</span>) % <span class="number">10</span>);</span><br><span class="line">        <span class="comment">//保存借位</span></span><br><span class="line">        t = t &lt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//去除最高位前面的0.比如运算结果为003，则去掉00，保留结果为3.</span></span><br><span class="line">    <span class="keyword">while</span>(C.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; C.<span class="built_in">back</span>() == <span class="number">0</span>)</span><br><span class="line">        C.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    string a, b;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; A, B;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = a.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) A.<span class="built_in">push_back</span>(a[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = b.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) B.<span class="built_in">push_back</span>(b[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将小数-大数转换成-（大数-小数）</span></span><br><span class="line">    <span class="type">bool</span> a_greater = <span class="built_in">cmp</span>(A, B);</span><br><span class="line">    <span class="keyword">auto</span> C = a_greater ? <span class="built_in">sub</span>(A, B) : <span class="built_in">sub</span>(B, A);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果是小数-大数，则在结果前面添加负号</span></span><br><span class="line">    <span class="keyword">if</span>(!a_greater) <span class="built_in">printf</span>(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span>(C.<span class="built_in">size</span>() != <span class="number">0</span>)&#123;</span><br><span class="line">        cout &lt;&lt; C.<span class="built_in">back</span>();</span><br><span class="line">        C.<span class="built_in">pop_back</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="乘法"><a href="#乘法" class="headerlink" title="乘法"></a>乘法</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/22.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//乘法的实质就是123 * 4 = 100 * 4 + 20 * 4 + 3 * 4.结果的个位诞生于最低位乘以4，十位诞生于十位乘以4加上个位进的位</span></span><br><span class="line"><span class="comment">//以此类推。</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">mul</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;A, <span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; C;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//大数每一位乘以小数，并加上低位进的位，得到的结果最后一位，为当前位的数，结果的其余位都是进位。</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; A.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        t += A[i] * b;</span><br><span class="line">        C.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(t) C.<span class="built_in">push_back</span>(t);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(C.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; C.<span class="built_in">back</span>() == <span class="number">0</span>) C.<span class="built_in">pop_back</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    string a;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line"></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; A;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = a.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) A.<span class="built_in">push_back</span>(a[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> C = <span class="built_in">mul</span>(A, b);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = C.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, C[i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="除法"><a href="#除法" class="headerlink" title="除法"></a>除法</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/22.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">div</span><span class="params">(vector&lt;<span class="type">int</span>&gt; A, <span class="type">int</span> b)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; C;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从大数高位开始除</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = A.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">        t = t * <span class="number">10</span> + A[i];</span><br><span class="line">        <span class="comment">//能除就除</span></span><br><span class="line">        <span class="keyword">if</span>(t &gt;= b) C.<span class="built_in">push_back</span>(t / b), t = t % b;</span><br><span class="line">        <span class="comment">//不能除，商就置零</span></span><br><span class="line">        <span class="keyword">else</span> C.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//翻转数组，并去除高位0。</span></span><br><span class="line">    <span class="built_in">reverse</span>(C.<span class="built_in">begin</span>(), C.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">while</span>(C.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; C.<span class="built_in">back</span>() == <span class="number">0</span>) C.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="comment">//翻转回来，把最终的余数补在数组最后面</span></span><br><span class="line">    <span class="built_in">reverse</span>(C.<span class="built_in">begin</span>(), C.<span class="built_in">end</span>());</span><br><span class="line">    C.<span class="built_in">push_back</span>(t);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    string a;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; A;</span><br><span class="line"></span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = a.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) A.<span class="built_in">push_back</span>(a[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> C = <span class="built_in">div</span>(A, b);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; C.<span class="built_in">size</span>() - <span class="number">1</span>; i++) <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, C[i]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n%d&quot;</span>, C.<span class="built_in">back</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="前缀与差分"><a href="#前缀与差分" class="headerlink" title="前缀与差分"></a>前缀与差分</h3><h4 id="前缀和（一维）"><a href="#前缀和（一维）" class="headerlink" title="前缀和（一维）"></a>前缀和（一维）</h4><p>对于一个普通的一维数组（从 a1 &#x3D;  a[1] 开始，a[0] &#x3D; 0），前n项和称为前缀和。通过Sn - S(k-1)可以得到S[k,n]的部分和。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/23.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> a[N], s[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) s[i] = s[i - <span class="number">1</span>] + a[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, s[r] - s[l - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="子矩阵的和"><a href="#子矩阵的和" class="headerlink" title="子矩阵的和"></a>子矩阵的和</h4><p><a href="https://www.acwing.com/problem/content/798/">796. 子矩阵的和 - AcWing题库</a></p><p>要求解一个矩阵的子矩阵的元素和，只需要想象一个矩阵，切割成十字形，按需拼凑即可。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/23.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> a[N][N], s[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//n行m列，q个询问</span></span><br><span class="line">    <span class="type">int</span> n, m, q;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;=m; j++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i][j]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++)</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             *  a11 a12 | a13</span></span><br><span class="line"><span class="comment">             *  a21 a22 | a23</span></span><br><span class="line"><span class="comment">             *  --------|----</span></span><br><span class="line"><span class="comment">             *  a31 a32 | a33</span></span><br><span class="line"><span class="comment">             * 比如s[3][3] = s[3][2] + s[2][3] - s[2][2]（这是去除重复加的部分）+ a[3][3]</span></span><br><span class="line"><span class="comment">             * */</span></span><br><span class="line">            s[i][j] = s[i][j - <span class="number">1</span>] + s[i - <span class="number">1</span>][j] - s[i - <span class="number">1</span>][j - <span class="number">1</span>] + a[i][j];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="type">int</span> x1, y1, x2, y2;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;x1, &amp;y1, &amp;x2, &amp;y2);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         *  a11 a12 a13 | a14 a15</span></span><br><span class="line"><span class="comment">         *  a21 a22 a23 | a24 a25</span></span><br><span class="line"><span class="comment">         *  ------------|--------</span></span><br><span class="line"><span class="comment">         *  a31 a32 a33 | a34 a35</span></span><br><span class="line"><span class="comment">         *  a41 a42 a43 | a44 a45</span></span><br><span class="line"><span class="comment">         * s[[3][4], [4][5]] = s[4][5] - s[4][3] - s[2][5] + s[2][3]（补回多减的重叠部分）</span></span><br><span class="line"><span class="comment">         * 实际上，这里的s[[3][4], [4][5]]整体类似于上一个注释位置中的a[3][3]，都是被夹的一部分，只是包含数据个数不同的区别。</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, s[x2][y2] - s[x2][y1 - <span class="number">1</span>] - s[x1 - <span class="number">1</span>][y2] + s[x1 - <span class="number">1</span>][y1 - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="差分"><a href="#差分" class="headerlink" title="差分"></a>差分</h3><h4 id="一维差分"><a href="#一维差分" class="headerlink" title="一维差分"></a>一维差分</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/25.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="comment">//a数组为前缀和数组，b为差分数组</span></span><br><span class="line"><span class="type">int</span> a[N], b[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">    <span class="comment">//对于前缀和数组a而言，要使[l, r]的前缀和+c</span></span><br><span class="line">    <span class="comment">//只需使差分数组b的第l位元素+c，这会让l及其以后的前缀和+c</span></span><br><span class="line">    <span class="comment">//然后第r+1位元素-c，这会让r+1及其以后的前缀和-c，即[r + 1, ?]的前缀和保持不变。</span></span><br><span class="line">    b[l] += c;</span><br><span class="line">    b[r + <span class="number">1</span>] -= c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始时，将a和b都看作全为零的的数组，前缀和和差分都为0。</span></span><br><span class="line">    <span class="comment">//然后输入数组a。</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将输入的数组a看作待添加的元素c，即区间[i,i]上的元素都加上常数c（a[i]）。</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">insert</span>(i, i, a[i]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//同样的执行m次insert即可。</span></span><br><span class="line">    <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">        <span class="type">int</span> l, r, c;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;l, &amp;r, &amp;c);</span><br><span class="line">        <span class="built_in">insert</span>(l, r, c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算前缀和。</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) b[i] += b[i - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, b[i]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="二维差分"><a href="#二维差分" class="headerlink" title="二维差分"></a>二维差分</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2024/1/27.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> a[N][N], b[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> x2, <span class="type">int</span> y2, <span class="type">int</span> c)</span></span>&#123;</span><br><span class="line">    b[x1][y1] += c;</span><br><span class="line">    b[x2 + <span class="number">1</span>][y1] -= c;</span><br><span class="line">    b[x1][y2 + <span class="number">1</span>] -= c;</span><br><span class="line">    b[x2 + <span class="number">1</span>][y2 + <span class="number">1</span>] += c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m, q;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;q);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++)</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i][j]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化差分数组</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++)</span><br><span class="line">            <span class="built_in">insert</span>(i, j, i, j, a[i][j]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新差分数组</span></span><br><span class="line">    <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">        <span class="type">int</span> x1, y1, x2, y2, c;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%d&quot;</span>, &amp;x1, &amp;y1, &amp;x2, &amp;y2, &amp;c);</span><br><span class="line">        <span class="built_in">insert</span>(x1, y1, x2, y2, c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新前缀和数组</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++)</span><br><span class="line">            a[i][j] = a[i][j - <span class="number">1</span>] + a[i - <span class="number">1</span>][j] - a[i - <span class="number">1</span>][j - <span class="number">1</span>] + b[i][j];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j++)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, a[i][j]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;快速排序&quot;&gt;&lt;a href=&quot;#快速排序&quot; class=&quot;headerlink&quot; title=&quot;快速排序&quot;&gt;&lt;/a&gt;快速排序&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;选取基准值（分界值）x，可以是数组的第一个元素，也可以是数组的最后一个元素，中间元素亦可。&lt;/li&gt;
&lt;li&gt;使</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Algorithm" scheme="https://blog.kahvia.cn/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>数据结构——基础问题</title>
    <link href="https://blog.kahvia.cn/2023/11/02/AlgorithmForGraduateTest.html"/>
    <id>https://blog.kahvia.cn/2023/11/02/AlgorithmForGraduateTest.html</id>
    <published>2023-11-02T14:44:06.902Z</published>
    <updated>2023-11-05T14:30:49.237Z</updated>
    
    <content type="html"><![CDATA[<h2 id="六、哈夫曼树"><a href="#六、哈夫曼树" class="headerlink" title="六、哈夫曼树"></a>六、哈夫曼树</h2><h3 id="1-合并果子"><a href="#1-合并果子" class="headerlink" title="1.合并果子"></a>1.合并果子</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2023/10/31.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//https://www.acwing.com/problem/content/150/</span></span><br><span class="line"><span class="comment">//使用哈夫曼树的知识合并果子堆，计算最小花费体力</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//定义一个优先队列，第一个参数是队列元素的类型，第二个是使用的容器类型，第三个是排序方式。</span></span><br><span class="line">    <span class="comment">//此处使用升序排序，即小的元素优先出队。</span></span><br><span class="line">    priority_queue&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;, greater&lt;<span class="type">int</span>&gt;&gt; stones_heap;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">while</span> (n--)&#123;</span><br><span class="line">        <span class="type">int</span> stones;</span><br><span class="line">        cin&gt;&gt;stones;</span><br><span class="line">        stones_heap.<span class="built_in">push</span>(stones);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> strength_used = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (stones_heap.<span class="built_in">size</span>() &gt; <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">//取出最小的两个结点（果子堆）</span></span><br><span class="line">        <span class="type">int</span> min1 = stones_heap.<span class="built_in">top</span>();</span><br><span class="line">        stones_heap.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">int</span> min2 = stones_heap.<span class="built_in">top</span>();</span><br><span class="line">        stones_heap.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="comment">//将这两个果子堆合并</span></span><br><span class="line">        stones_heap.<span class="built_in">push</span>(min1 + min2);</span><br><span class="line">        <span class="comment">//累计合并果子堆花费的体力</span></span><br><span class="line">        strength_used += (min1 + min2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout&lt;&lt;strength_used;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-荷马史诗"><a href="#2-荷马史诗" class="headerlink" title="2.荷马史诗"></a>2.荷马史诗</h3><p>​K叉哈夫曼树的问题类似于二叉哈夫曼树。需要注意的点是，在K叉哈夫曼树中，我们每次合并结点都会取出最小的K个结点，在我们进行最后一次合并的时候，可能存在的结点个数不足K个。</p><p>​如1，2，3，4，5，6  ——&gt; 6（1，2，3），4，5，6 ——&gt; 6（1，2，3），15（4，5，6）.</p><p>​这时候我们需要补充零结点进去充数。 6（1，2，3），15（4，5，6），0 ——&gt; 21（6，15）.然后我们会发现，将二层的0和底部的6交换，会让K叉树的结果变好。所以，我们应在开始合并前就补充零结点，使得刚好其元素个数刚好能构建K叉哈夫曼树。</p><p>​这时候我们可以分析什么时候该补充零结点。我们每次合并结点都会将K个结点合并成一个结点，减少了K-1个结点。刚开始N个元素，全部合并后仅剩1个元素，减少了N-1个结点。每次合并减少K-1个，共需减少N-1个，合并次数为（N-1）&#x2F; (K-1)。即不能整除的时候，说明需要补充零结点。</p><p>​由于荷马史诗的编码要求编码树的高度最小，所以在合并结点的时候，除了选择最小的K个结点，还要在节点值相同的时候，优先选择结点展开的子树高度（深度）最小的结点。</p><p>​比如，1，3，4，3 ——&gt; 4（1，3），4，3 。根据值最小原则，可以选第一个4，也可以选第二个4，与3合并。很显然，前者合并到最后的高度为3，后者为2。所以在合并的时候，我们应尽量往矮的结点上合并。就像俄罗斯方块，合并的恰到好处才不容易到达顶端。我想大多数人都是优先平铺方块再垂直放的吧。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2023/11/1.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//https://www.acwing.com/problem/content/151/</span></span><br><span class="line"><span class="comment">//荷马史诗</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;iostream&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;algorithm&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;queue&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;vector&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//define a pair of data. long long for word_code and int for Huffman coding node depth.</span></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">long</span> <span class="type">long</span>, <span class="type">int</span>&gt; PLI;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    priority_queue&lt;PLI, vector&lt;PLI&gt;, greater&lt;&gt;&gt; words;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//k is the system of numeration</span></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> words_num, k;</span><br><span class="line">    cin&gt;&gt;words_num&gt;&gt;k;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (words_num--)&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> word;</span><br><span class="line">        cin&gt;&gt;word;</span><br><span class="line">        words.<span class="built_in">push</span>(&#123;word, <span class="number">0</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//every loop for merge will delete k nodes and add a combined node,</span></span><br><span class="line">    <span class="comment">//so k-1 nodes decrease in each merge.</span></span><br><span class="line">    <span class="comment">//the loop will continues until there is only one node.</span></span><br><span class="line">    <span class="comment">//loop time = (words_num - 1) / (k-1).</span></span><br><span class="line">    <span class="comment">//if the time is not a integer, just add zero node until it can be a integer.</span></span><br><span class="line">    <span class="keyword">while</span> ((words.<span class="built_in">size</span>() - <span class="number">1</span>) % (k - <span class="number">1</span>) != <span class="number">0</span>)</span><br><span class="line">        words.<span class="built_in">push</span>(&#123;<span class="number">0</span>,<span class="number">0</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//the with power length is the new coded book length</span></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> wpl = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (words.<span class="built_in">size</span>() &gt; <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span>  combined_node_val = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> max_depth = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">            <span class="comment">//get the min node</span></span><br><span class="line">            <span class="keyword">auto</span> min_node = words.<span class="built_in">top</span>();</span><br><span class="line">            <span class="comment">//merge</span></span><br><span class="line">            combined_node_val += min_node.first;</span><br><span class="line">            <span class="comment">//save the highest son-tree&#x27;s depth</span></span><br><span class="line">            max_depth = <span class="built_in">max</span>(max_depth, min_node.second);</span><br><span class="line">            <span class="comment">//delete the node</span></span><br><span class="line">            words.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//add the combined node.</span></span><br><span class="line">        words.<span class="built_in">push</span>(&#123;combined_node_val,max_depth + <span class="number">1</span>&#125;);</span><br><span class="line">        <span class="comment">//the new combined node value is a part of the WPL.</span></span><br><span class="line">        wpl += combined_node_val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout&lt;&lt;wpl&lt;&lt;endl&lt;&lt;words.<span class="built_in">top</span>().second;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="七、拓扑排序（有向图问题）"><a href="#七、拓扑排序（有向图问题）" class="headerlink" title="七、拓扑排序（有向图问题）"></a>七、拓扑排序（有向图问题）</h2><h3 id="1-基于广搜（广度优先遍历）的拓扑排序实现方法"><a href="#1-基于广搜（广度优先遍历）的拓扑排序实现方法" class="headerlink" title="1.基于广搜（广度优先遍历）的拓扑排序实现方法"></a>1.基于广搜（广度优先遍历）的拓扑排序实现方法</h3><p>​广度优先遍历（BFS），实际上就是一层一层地遍历。</p><ol><li>将第一个顶点入队</li><li>队列出队，将出队的顶点连接的顶点进行入队，我简称为出队展开。</li><li>重复步骤2直到队列为空</li></ol><ul><li>注意，需要开一个数组保存顶点是否被遍历过。顶点入队的时候，就该标记为被遍历过了，防止重复入队（比如出现回环的时候，A&lt;—&gt;B，A出队会B会入队，B出队A会入队，会出现死循环）。</li></ul><p>​拓扑排序实现方式</p><pre><code> 1. 入队的标准改为：入度为0的顶点才能入队。 2. 当顶点入队的时候，将该顶点可以通往顶点的入度减1（即在图中隐藏该入队的顶点，代表该工程任务结束） 3. 简单来说，就是在BFS出队展开时，只让入度为0的顶点入队（即只有前置任务全部完成，才能将新的任务加入执行清单）。</code></pre><ul><li>需要开一个数组维护每个顶点的入度。</li><li>因为只有入度为0的才能入队，重边，或者回环，都会导致度不为0无法入队，所以不需要BFS那个判断是否被遍历过的数组。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by Kahiva on 2023/11/5.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//https://www.acwing.com/problem/content/850/</span></span><br><span class="line"><span class="comment">//拓扑排序(采用广度遍历实现)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;iostream&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;algorithm&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;queue&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//n个顶点m条边</span></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="comment">//定义一个常量N，即最大可能用到的顶点数。定义入度数组和模拟队列的数组时可以用到。</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> nodeId;</span><br><span class="line">    Node* next;</span><br><span class="line">    <span class="built_in">Node</span>(<span class="type">int</span> id):<span class="built_in">nodeId</span>(id), <span class="built_in">next</span>(<span class="literal">NULL</span>)&#123;&#125;;</span><br><span class="line">&#125;*link[N];</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存各顶点的入度</span></span><br><span class="line"><span class="type">int</span> inDegree[N];</span><br><span class="line"><span class="comment">//采用数组模拟队列，出队移动头索引，入队移动尾索引。这样可以在模拟队列的同时，保留原队列中的元素。</span></span><br><span class="line"><span class="type">int</span> checkQueue[N];</span><br><span class="line"></span><br><span class="line"><span class="comment">//将某个点和另一个点的边加入邻接表表示的图中。</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addLink</span><span class="params">(<span class="type">int</span> fromNodeId, <span class="type">int</span> toNodeId)</span></span>&#123;</span><br><span class="line">    Node* node = <span class="keyword">new</span> <span class="built_in">Node</span>(toNodeId);</span><br><span class="line">    node-&gt;next = link[fromNodeId];</span><br><span class="line">    link[fromNodeId] = node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">topSort</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//head指向队头，rear指向队列最后一个元素</span></span><br><span class="line">    <span class="type">int</span> head = <span class="number">0</span>, rear = <span class="number">-1</span>;</span><br><span class="line">    <span class="comment">//因为顶点编号从1开始，所以入度数组从索引1开始遍历</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="comment">//遍历顶点，如果顶点入度为0，就入队</span></span><br><span class="line">        <span class="keyword">if</span> (!inDegree[i])&#123;</span><br><span class="line">            checkQueue[++rear] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (head &lt;= rear)&#123;</span><br><span class="line">        <span class="comment">//取出队头元素</span></span><br><span class="line">        <span class="keyword">auto</span> top = checkQueue[head++];</span><br><span class="line">        <span class="comment">//遍历它的邻边，将邻边那头对应点的入度减一</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> p = link[top]; p ; p = p-&gt;next)&#123;</span><br><span class="line">            inDegree[p-&gt;nodeId]--;</span><br><span class="line">            <span class="comment">//如果没有了前置结点，代表可以入队(即被遍历，或者说该工程任务可以执行了)</span></span><br><span class="line">            <span class="keyword">if</span> (inDegree[p-&gt;nodeId] == <span class="number">0</span>)&#123;</span><br><span class="line">                checkQueue[++rear] = p-&gt;nodeId;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果队列中的元素个数刚好等于顶点个数，就代表拓扑排序成立，即不存在闭环。</span></span><br><span class="line">    <span class="comment">//因为如果有闭环，闭环上结点的入度始终不为0，无法入队。</span></span><br><span class="line">    <span class="keyword">return</span> n == rear + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (m--)&#123;</span><br><span class="line">        <span class="type">int</span> from, to;</span><br><span class="line">        cin&gt;&gt;from&gt;&gt;to;</span><br><span class="line">        <span class="built_in">addLink</span>(from, to);</span><br><span class="line">        inDegree[to]++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果拓扑排序无效，则输出-1</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">topSort</span>())</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;-1&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</span><br><span class="line">            cout&lt;&lt;checkQueue[i]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;六、哈夫曼树&quot;&gt;&lt;a href=&quot;#六、哈夫曼树&quot; class=&quot;headerlink&quot; title=&quot;六、哈夫曼树&quot;&gt;&lt;/a&gt;六、哈夫曼树&lt;/h2&gt;&lt;h3 id=&quot;1-合并果子&quot;&gt;&lt;a href=&quot;#1-合并果子&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="Algorithm" scheme="https://blog.kahvia.cn/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Clion中Cmake的设置问题</title>
    <link href="https://blog.kahvia.cn/2023/10/15/Clion-cmake.html"/>
    <id>https://blog.kahvia.cn/2023/10/15/Clion-cmake.html</id>
    <published>2023-10-15T08:58:30.017Z</published>
    <updated>2023-10-15T09:14:10.042Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-设置可执行程序输出目录"><a href="#1-设置可执行程序输出目录" class="headerlink" title="1.设置可执行程序输出目录"></a>1.设置可执行程序输出目录</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/bin&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="2-将cpp文件添加为“生成可执行文件”的源文件"><a href="#2-将cpp文件添加为“生成可执行文件”的源文件" class="headerlink" title="2.将cpp文件添加为“生成可执行文件”的源文件"></a>2.将cpp文件添加为“生成可执行文件”的源文件</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(AcWing3375 Acwing/graduate/AcWing3375.cpp)</span><br></pre></td></tr></table></figure><h3 id="完整的cmake设置"><a href="#完整的cmake设置" class="headerlink" title="完整的cmake设置"></a>完整的cmake设置</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.24</span>)</span><br><span class="line"><span class="comment">#指定cmake工程名</span></span><br><span class="line"><span class="keyword">project</span>(algorithm)</span><br><span class="line"></span><br><span class="line"><span class="comment">#c++版本</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">14</span>)</span><br><span class="line"><span class="comment"># 指定可执行程序输出目录</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/bin&quot;</span>)</span><br><span class="line"><span class="keyword">add_executable</span>(AcWing3375 Acwing/graduate/AcWing3375.cpp)</span><br></pre></td></tr></table></figure><h3 id="附：普通的gitignore文件"><a href="#附：普通的gitignore文件" class="headerlink" title="附：普通的gitignore文件"></a>附：普通的gitignore文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/.idea/</span><br><span class="line">/cmake-build-debug/</span><br><span class="line">/bin/</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;1-设置可执行程序输出目录&quot;&gt;&lt;a href=&quot;#1-设置可执行程序输出目录&quot; class=&quot;headerlink&quot; title=&quot;1.设置可执行程序输出目录&quot;&gt;&lt;/a&gt;1.设置可执行程序输出目录&lt;/h3&gt;&lt;figure class=&quot;highlight cmak</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="clion cmake" scheme="https://blog.kahvia.cn/tags/clion-cmake/"/>
    
  </entry>
  
  <entry>
    <title>Vue3使用Echarts</title>
    <link href="https://blog.kahvia.cn/2023/07/19/vue3-echarts.html"/>
    <id>https://blog.kahvia.cn/2023/07/19/vue3-echarts.html</id>
    <published>2023-07-19T01:30:49.148Z</published>
    <updated>2023-07-19T11:13:09.375Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>响应式布局，是为五个不同的屏幕尺寸制定不同的显示比例。这是网页收缩导致网页布局变乱的究极解决方案。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h3&gt;&lt;p&gt;响应式布局，是为五个不同的屏幕尺寸制定不同的显示比例。这是网页收缩导致网页布局变乱的究极解决方案。&lt;/p&gt;
</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="echarts vue3" scheme="https://blog.kahvia.cn/tags/echarts-vue3/"/>
    
  </entry>
  
  <entry>
    <title>响应式布局</title>
    <link href="https://blog.kahvia.cn/2023/07/04/ResponsiveDesign.html"/>
    <id>https://blog.kahvia.cn/2023/07/04/ResponsiveDesign.html</id>
    <published>2023-07-04T11:58:41.653Z</published>
    <updated>2023-07-04T13:58:56.460Z</updated>
    
    <content type="html"><![CDATA[<h3 id="响应式布局"><a href="#响应式布局" class="headerlink" title="响应式布局"></a>响应式布局</h3><p>响应式布局，是为五个不同的屏幕尺寸制定不同的显示比例。这是网页收缩导致网页布局变乱的究极解决方案。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;响应式布局&quot;&gt;&lt;a href=&quot;#响应式布局&quot; class=&quot;headerlink&quot; title=&quot;响应式布局&quot;&gt;&lt;/a&gt;响应式布局&lt;/h3&gt;&lt;p&gt;响应式布局，是为五个不同的屏幕尺寸制定不同的显示比例。这是网页收缩导致网页布局变乱的究极解决方案。&lt;/p&gt;
</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="html element" scheme="https://blog.kahvia.cn/tags/html-element/"/>
    
  </entry>
  
  <entry>
    <title>Nodejs-包</title>
    <link href="https://blog.kahvia.cn/2023/06/28/NodeJsPackage.html"/>
    <id>https://blog.kahvia.cn/2023/06/28/NodeJsPackage.html</id>
    <published>2023-06-28T06:31:43.686Z</published>
    <updated>2023-06-29T07:59:06.907Z</updated>
    
    <content type="html"><![CDATA[<h3 id="包的类型"><a href="#包的类型" class="headerlink" title="包的类型"></a>包的类型</h3><ul><li>项目包：用于编写项目和和业务逻辑</li><li>软件包：封装工具和方法进行使用<ul><li>本地软件包：当前项目内使用，封装<strong>属性和方法</strong>，存在于 node_modules中。</li><li>全局软件包：本机所有项目使用，封装<strong>命令和工具</strong>，存在于系统设置的位置。</li></ul></li></ul><h3 id="软件包的结构"><a href="#软件包的结构" class="headerlink" title="软件包的结构"></a>软件包的结构</h3><p>如下图所示。整个util包由三部分组成，libs、index.js、package.json。</p><ul><li>libs中，存放工具包的源代码 js 文件。</li><li>index.js文件作为入口文件，通过这个文件统一暴露对外工具方法等。</li><li>package.json文件，描述包的一些信息。</li></ul><p><img src="https://pics.kahvia.cn/img/image-20230628145428487.png" alt="包的结构图"></p><h3 id="libs示例"><a href="#libs示例" class="headerlink" title="libs示例"></a>libs示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//printHello.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">printHello</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello,Adong. It&#x27;s your first tools package.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> words = <span class="string">&quot;How old are you?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    printHello,</span><br><span class="line">    words</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="index-js示例"><a href="#index-js示例" class="headerlink" title="index.js示例"></a>index.js示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//下面这用法叫做解析重构</span></span><br><span class="line"><span class="keyword">let</span> &#123; printHello, words &#125; = <span class="built_in">require</span>(<span class="string">&quot;./libs/printHello&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> resHeaderUtil = <span class="built_in">require</span>(<span class="string">&quot;./libs/resHeaderUtil-commonjs&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//对libs中的工具，统一作模块暴露</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    printHello,</span><br><span class="line">    words,</span><br><span class="line">    resHeaderUtil</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="package-json示例"><a href="#package-json示例" class="headerlink" title="package.json示例"></a>package.json示例</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;kahvia_tools&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Kahvia&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;包含了设置http请求的响应头的工具和输出你好的工具函数&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MIT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>其中，main表示工具包的入口文件，version代表版本，license表示许可证。</p><h3 id="软件包的使用"><a href="#软件包的使用" class="headerlink" title="软件包的使用"></a>软件包的使用</h3><p>在使用软件包时，路径只需要到软件包的根目录即可。无需指定更详细的路径。它会自动寻找index.js，若无则查找package.json中的main入口。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> kahvia_utils = <span class="built_in">require</span>(<span class="string">&quot;./util&quot;</span>)</span><br><span class="line"></span><br><span class="line">kahvia_utils.<span class="title function_">printHello</span>()</span><br></pre></td></tr></table></figure><p>结果如下所示。</p><p><img src="https://pics.kahvia.cn/img/image-20230628150604791.png" alt="工具包使用结果"></p><h3 id="NPM"><a href="#NPM" class="headerlink" title="NPM"></a>NPM</h3><p>npm是nodejs的包管理器。</p><p>若项目中没有package.json，可以通过以下命令执行初始化。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure><p>若我们需要安装某个软件包，则通过以下命令执行安装，软件包会存放在node_modules目录下，软件包的版本则会保存在package-lock.json文件中，用作固化版本。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i package-name</span><br></pre></td></tr></table></figure><p>我们使用下载的软件包时，可以<strong>直接通过包名引入</strong>，而不用通过路径。</p><p>当我们协同开发时，git不会同步我们的node_modules文件夹。可能别人使用了某个包，但是我们自己没有使用，所以本地没有这个包。我们可以通过以下命令，根据package.json文件，安装本地缺少的包。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i</span><br></pre></td></tr></table></figure><h3 id="常用的软件包"><a href="#常用的软件包" class="headerlink" title="常用的软件包"></a>常用的软件包</h3><h4 id="nodemon"><a href="#nodemon" class="headerlink" title="nodemon"></a>nodemon</h4><p>一个全局软件包，需要全局安装。通过这个nodemon启动 js 文件，可以检测代码更改，自动重启程序。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i nodemon -g</span><br></pre></td></tr></table></figure><h4 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h4><p>一个常用的打包工具，安装在项目的dev环境中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack webpack-cli --save-dev</span><br></pre></td></tr></table></figure><p>在项目的package.json中添加自定义脚本命令。其中，build是自定义的名称，什么都可以，其后面的值即webpack才是真正执行的命令。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span><span class="string">&quot;webpack&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>将要打包的文件放在根目录的src目录中，通过npm run build，实现项目打包。不过这里的打包只能实现<strong>部分</strong> js 文件的打包，至于为什么是<strong>部分</strong>，因为打包那种nodejs写的后端项目，会报很多错误，而我暂时还不太懂问题出在哪里。目前打包给前端页面引用的js文件是没有问题的。</p><p>通过配置项目根目录的webpack.config.js文件，可以配置打包的参数，比如入口、出口、插件等。其中，entry是入口，output是出口，path是输出路径，filename是打包后的文件名。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getRecentDir &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/recentPath.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/hello.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(<span class="title function_">getRecentDir</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>), <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;testPack.js&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="HtmlWebpackPlugin（根据自动生成目标页面并连接打包压缩的JS文件）"><a href="#HtmlWebpackPlugin（根据自动生成目标页面并连接打包压缩的JS文件）" class="headerlink" title="HtmlWebpackPlugin（根据自动生成目标页面并连接打包压缩的JS文件）"></a>HtmlWebpackPlugin（根据自动生成目标页面并连接打包压缩的JS文件）</h5><p>webpack通过上述方式打包的话，只能打包普通的静态js文件。也就是说，打包完成后，我们需要手动为页面引入打包后的js文件，这无疑的麻烦的。通过HtmlWebpackPlugin，我们可以将页面一起打包，自动为页面引入打包好的js文件，一起输出到目标目录。</p><blockquote><p>​详细的使用可以参考<a href="https://www.webpackjs.com/plugins/html-webpack-plugin/#basic-usage">官方文档</a></p></blockquote><p>通过如下命令安装插件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev html-webpack-plugin</span><br></pre></td></tr></table></figure><p>在webpack配置文件中，配置如下。其中，template作为模板，即以此模板在目标目录生成一份以filename为文件名的html文件，同时为其引入打包好的js文件。output中的clean属性可以清除上一次打包的东西。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getRecentDir &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/recentPath.js&#x27;</span></span><br><span class="line"><span class="comment">//引入插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HtmlWebpackPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;html-webpack-plugin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/hello.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(<span class="title function_">getRecentDir</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>), <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;testPack.js&#x27;</span>,</span><br><span class="line">        <span class="attr">clean</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./public/index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;test.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="css-loader-style-loader（加载器，把css打包到js文件中）"><a href="#css-loader-style-loader（加载器，把css打包到js文件中）" class="headerlink" title="css-loader,style-loader（加载器，把css打包到js文件中）"></a>css-loader,style-loader（加载器，把css打包到js文件中）</h5><blockquote><p><a href="https://www.webpackjs.com/loaders/css-loader/">这两个加载器的官方文档</a></p></blockquote><ul><li>css-loader：解析css代码。</li><li>style-loader：把解析后的css代码插入到DOM。最后css代码在打包后的js文件中，通过函数的方式保存。</li></ul><p>按照下方命令安装加载器。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev css-loader style-loader</span><br></pre></td></tr></table></figure><p>在webpack配置文件中配置加载器。下方的module部分。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getRecentDir &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/recentPath.js&#x27;</span></span><br><span class="line"><span class="comment">//引入插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HtmlWebpackPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;html-webpack-plugin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/hello.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(<span class="title function_">getRecentDir</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>), <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;testPack.js&#x27;</span>,</span><br><span class="line">        <span class="attr">clean</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./Login/login.html&#x27;</span>,</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;login.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>use数组中的元素顺序是有影响的。loader是从右到左应用的。在这种情况下，首先应用css-loader，然后应用style-loader。即先解析css引用，再绑定DOM元素。</p><p>配置好加载器以后，就可以把使用到的css文件引用到入口js文件中了。比如我这里的打包入口是hello.js文件，那我在文件内容开头import即可。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hello.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../Login/login.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试打包</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello, kahvia !&quot;</span>)</span><br><span class="line"><span class="comment">//二次输出</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;what&#x27;s up ?&quot;</span>)</span><br></pre></td></tr></table></figure><p>以上都完成后，即可打包。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><h5 id="mini-css-extract-plugin-提取css文件"><a href="#mini-css-extract-plugin-提取css文件" class="headerlink" title="mini-css-extract-plugin(提取css文件)"></a>mini-css-extract-plugin(提取css文件)</h5><blockquote><p><a href="https://www.webpackjs.com/plugins/mini-css-extract-plugin/">MiniCssExtractPlugin | webpack 中文文档</a></p></blockquote><p>我们在上面通过style-loader，是将css打包进js文件，这会导致js文件比平常更大。所以官方更推荐的一个做法是将css提取出来，而不是打包进js文件。通过<strong>mini-css-extract-plugin</strong>这个插件，配合css-loader我们可以做到提取css文件。</p><p>值得注意的是，mini-css-extract-plugin<strong>不能</strong>和style-loader一起使用，因为既要单独提取，又要打包进js文件，这不是相互矛盾了吗？</p><p>顺带一提，单独提取的css文件，是不会被压缩的。</p><p>通过以下命令安装插件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev mini-css-extract-plugin</span><br></pre></td></tr></table></figure><p>再在webpack配置文件中引入该插件，为其配置plugin选项，并在rules-use中添加插件内置的loader。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getRecentDir &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/recentPath.js&#x27;</span></span><br><span class="line"><span class="comment">//引入插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HtmlWebpackPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;html-webpack-plugin&#x27;</span></span><br><span class="line"><span class="comment">//引入css提取插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MiniCssExtractPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;mini-css-extract-plugin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/hello.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(<span class="title function_">getRecentDir</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>), <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;testPack.js&#x27;</span>,</span><br><span class="line">        <span class="attr">clean</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./Login/login.html&#x27;</span>,</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;login.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>()</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="CssMinimizerWebpackPlugin（压缩提取的css文件）"><a href="#CssMinimizerWebpackPlugin（压缩提取的css文件）" class="headerlink" title="CssMinimizerWebpackPlugin（压缩提取的css文件）"></a>CssMinimizerWebpackPlugin（压缩提取的css文件）</h5><p>通过上述的mini-css-extract-plugin插件，只能做到提取，但是会发现提取出来的css文件并没有做到压缩。而CssMinimizerWebpackPlugin就是为了压缩而使用的。</p><p>通过命令安装插件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install css-minimizer-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure><p>在webpack配置文件中引入并配置。其中optimization-minimizer是配置项。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getRecentDir &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/recentPath.js&#x27;</span></span><br><span class="line"><span class="comment">//引入插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HtmlWebpackPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;html-webpack-plugin&#x27;</span></span><br><span class="line"><span class="comment">//引入css提取插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MiniCssExtractPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;mini-css-extract-plugin&#x27;</span></span><br><span class="line"><span class="comment">//引入css压缩插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CssMinimizerPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/hello.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(<span class="title function_">getRecentDir</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>), <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;testPack.js&#x27;</span>,</span><br><span class="line">        <span class="attr">clean</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./Login/login.html&#x27;</span>,</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;login.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(),</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//优化</span></span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="comment">//minimize 减小</span></span><br><span class="line">        <span class="attr">minimizer</span>: [</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>()</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="打包图片"><a href="#打包图片" class="headerlink" title="打包图片"></a>打包图片</h5><p>在上述操作中，我们可以打包html，css，js了，但是图片该如何处理呢？如果项目中的图片，采用网络地址url访问，那么我们打包后自然可以正常使用。但如果采用的是本地的图片呢？我们就需要把图片也一起打包了。</p><blockquote><p><a href="https://www.webpackjs.com/guides/asset-modules/">资源模块 | webpack 中文文档</a></p></blockquote><p>在webpack5中，我们无需使用外置loader，配置如下所示，在rule中配置图片打包。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getRecentDir &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/recentPath.js&#x27;</span></span><br><span class="line"><span class="comment">//引入插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HtmlWebpackPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;html-webpack-plugin&#x27;</span></span><br><span class="line"><span class="comment">//引入css提取插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MiniCssExtractPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;mini-css-extract-plugin&#x27;</span></span><br><span class="line"><span class="comment">//引入css压缩插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CssMinimizerPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/hello.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(<span class="title function_">getRecentDir</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>), <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;testPack.js&#x27;</span>,</span><br><span class="line">        <span class="attr">clean</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./Login/login.html&#x27;</span>,</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;login.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(),</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//配置图片打包</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|gif)$/i</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//优化</span></span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="comment">//minimize 减小</span></span><br><span class="line">        <span class="attr">minimizer</span>: [</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>()</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在asset类型下，大于8kb的图片会直接作拷贝处理，小于8kb的会转为base64，通过uri的方式替换项目中的src引用。</p><p>类似于css打包，我们将要打包的图片也引入入口JS文件即可。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hello.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../Login/login.css&#x27;</span></span><br><span class="line"><span class="comment">//导入需要打包的本地图片</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../Login/ganda.jpg&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试打包</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello, kahvia !&quot;</span>)</span><br><span class="line"><span class="comment">//二次输出</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;what&#x27;s up ?&quot;</span>)</span><br></pre></td></tr></table></figure><p>正常打包即可。</p><h5 id="搭建热更新开发环境"><a href="#搭建热更新开发环境" class="headerlink" title="搭建热更新开发环境"></a>搭建热更新开发环境</h5><p>下载webpack-dev-server。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack-dev-server --save-dev</span><br></pre></td></tr></table></figure><p>在webpack配置文件中，设置模式（mode）为开发模式（development）,并在package.json中配置自定义命令，即scripts中的选项，”dev”: “webpack serve –open”。</p><p>设置开发模式。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; getRecentDir &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/recentPath.js&#x27;</span></span><br><span class="line"><span class="comment">//引入插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HtmlWebpackPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;html-webpack-plugin&#x27;</span></span><br><span class="line"><span class="comment">//引入css提取插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MiniCssExtractPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;mini-css-extract-plugin&#x27;</span></span><br><span class="line"><span class="comment">//引入css压缩插件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CssMinimizerPlugin</span> <span class="keyword">from</span> <span class="string">&#x27;css-minimizer-webpack-plugin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">//设置热更新开发模式</span></span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    <span class="comment">//设置入口</span></span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/hello.js&#x27;</span>,</span><br><span class="line">    <span class="comment">//出口</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(<span class="title function_">getRecentDir</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>), <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;testPack.js&#x27;</span>,</span><br><span class="line">        <span class="attr">clean</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//插件</span></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">            <span class="comment">// filename: &quot;login.css&quot;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./Login/login.html&#x27;</span>,</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;login.html&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//配置图片打包</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|gif)$/i</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;asset&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//优化</span></span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="comment">//minimize 减小</span></span><br><span class="line">        <span class="attr">minimizer</span>: [</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CssMinimizerPlugin</span>()</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在package.json中，如下所示。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;css-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.8.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;css-minimizer-webpack-plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;html-webpack-plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.5.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;mini-css-extract-plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.7.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;style-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.3.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;webpack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.88.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;webpack-cli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.1.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;webpack-dev-server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.15.1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack serve --open&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>通过自定义命令启动。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure><p>这种情况下，会自动创建一个8080端口的服务，服务器的根目录为项目的public目录和webpack配置文件中的出口目录。默认打开的是public目录下的index网页，而我们要查看的网页在出口目录，那么我们可以为public目录的index网页添加重定向，自动跳转到我们要查看的网页。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public目录下的index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    location.<span class="property">href</span> = <span class="string">&quot;/login.html&quot;</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="生产模式"><a href="#生产模式" class="headerlink" title="生产模式"></a>生产模式</h5><p>上面使用到了开发模式，配合webpack-dev-server可以热更新。与之相对的，还有生产模式（production），即打包模式。</p><p>我们开发模式用的更多，所以mode设置为development，那打包的时候怎么办呢？再去修改mode吗？这很显然不方便。所以我们可以通过自定义命令指定模式。命令的优先级＞配置文件。</p><p>在package.json文件中，我们这样设置，在build和dev后面加上–mode&#x3D;[mode]即可。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;devDependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;css-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^6.8.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;css-minimizer-webpack-plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;html-webpack-plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.5.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;mini-css-extract-plugin&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.7.6&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;style-loader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.3.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;webpack&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.88.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;webpack-cli&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^5.1.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;webpack-dev-server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^4.15.1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --mode=production&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack serve --open --mode=development&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>这样一来，开发的时候就使用热更新开发模式，打包的时候就使用生产模式，两不误。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;包的类型&quot;&gt;&lt;a href=&quot;#包的类型&quot; class=&quot;headerlink&quot; title=&quot;包的类型&quot;&gt;&lt;/a&gt;包的类型&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;项目包：用于编写项目和和业务逻辑&lt;/li&gt;
&lt;li&gt;软件包：封装工具和方法进行使用&lt;ul&gt;
&lt;li&gt;本地软件包：</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="node.js" scheme="https://blog.kahvia.cn/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript-解构赋值</title>
    <link href="https://blog.kahvia.cn/2023/06/28/Javascript-DestructuringAssignment.html"/>
    <id>https://blog.kahvia.cn/2023/06/28/Javascript-DestructuringAssignment.html</id>
    <published>2023-06-28T06:22:20.924Z</published>
    <updated>2023-06-28T06:31:13.271Z</updated>
    
    <content type="html"><![CDATA[<h3 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h3><p><strong>解构赋值</strong>语法是一种 Javascript 表达式。可以将数组中的值或对象的属性取出，赋值给其他变量。</p><p>对于对象和数组的解构，有两种解构模式：<em>绑定模式</em>和<em>赋值模式</em>，它们的语法略有不同。</p><h3 id="绑定模式"><a href="#绑定模式" class="headerlink" title="绑定模式"></a>绑定模式</h3><p>在绑定模式中，模式以声明关键字（<code>var</code>、<code>let</code> 或 <code>const</code>）开始。然后，每个单独的属性必须绑定到一个变量或进一步解构。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: &#123; <span class="attr">c</span>: <span class="number">2</span> &#125; &#125;;</span><br><span class="line"><span class="keyword">const</span> &#123; a, <span class="attr">b</span>: &#123; <span class="attr">c</span>: d &#125; &#125; = obj;</span><br><span class="line"><span class="comment">// Two variables are bound: `a` and `d`</span></span><br><span class="line"><span class="comment">//两个变量绑定了：a 和 b</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="赋值模式"><a href="#赋值模式" class="headerlink" title="赋值模式"></a>赋值模式</h3><p>在赋值模式中，模式不以关键字开头。每个解构属性都被赋值给一个赋值目标——这个赋值目标可以事先用 <code>var</code> 或 <code>let</code> 声明，也可以是另一个对象的属性——一般来说，可以是任何可以出现在赋值表达式左侧的东西。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [];</span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line">(&#123; <span class="attr">a</span>: numbers[<span class="number">0</span>], <span class="attr">b</span>: numbers[<span class="number">1</span>] &#125; = obj);</span><br><span class="line"><span class="comment">// The properties `a` and `b` are assigned to properties of `numbers`</span></span><br><span class="line"><span class="comment">//obj的两个属性，a和b，被赋值给了数组numbers[]</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>备注：</strong> 当使用对象文字解构赋值而不带声明时，在赋值语句周围必须添加括号 <code>( ... )</code>。</p><p><code>&#123; a, b &#125; = &#123; a: 1, b: 2 &#125;</code> 不是有效的独立语法，因为左侧的 <code>&#123;a, b&#125;</code> 被视为块而不是对象字面量。但是，<code>(&#123; a, b &#125; = &#123; a: 1, b: 2 &#125;)</code> 是有效的，<code>const &#123; a, b &#125; = &#123; a: 1， b: 2 &#125;</code> 也是有效的。</p><p>如果你的编码风格不包括尾随分号，则 <code>( ... )</code> 表达式前面需要有一个分号，否则它可能用于执行前一行的函数。</p></blockquote><h3 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">解构赋值 - JavaScript | MDN</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;解构赋值&quot;&gt;&lt;a href=&quot;#解构赋值&quot; class=&quot;headerlink&quot; title=&quot;解构赋值&quot;&gt;&lt;/a&gt;解构赋值&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;解构赋值&lt;/strong&gt;语法是一种 Javascript 表达式。可以将数组中的值或对象的属性取出，赋值给</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="js" scheme="https://blog.kahvia.cn/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>NodeJs使用</title>
    <link href="https://blog.kahvia.cn/2023/06/27/NodeJs.html"/>
    <id>https://blog.kahvia.cn/2023/06/27/NodeJs.html</id>
    <published>2023-06-27T02:06:42.700Z</published>
    <updated>2023-06-28T03:58:03.328Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Commonjs和ECMAScript语法"><a href="#Commonjs和ECMAScript语法" class="headerlink" title="Commonjs和ECMAScript语法"></a>Commonjs和ECMAScript语法</h2><h3 id="Commonjs"><a href="#Commonjs" class="headerlink" title="Commonjs"></a>Commonjs</h3><p>Nodejs中默认采用Commonjs语法。</p><p>模块导出格式如下。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//commonjs语法导出自定义模块</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">setResHeader</span>: setResHeader</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>模块导入格式如下。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入自定义工具模块，只能使用路径</span></span><br><span class="line"><span class="keyword">let</span> resHeaderUtil = <span class="built_in">require</span>(<span class="string">&quot;./utils/resHeaderUtil&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="ECMAScript"><a href="#ECMAScript" class="headerlink" title="ECMAScript"></a>ECMAScript</h3><p>比如vue这种框架，采用的就是ECMAScript语法。要使用这种语法，首先得在package.json中指出type的值。</p><blockquote><p>When set to “module”, the type field allows a package to specify all .js files within are ES modules. If the “type” field is omitted or set to “commonjs”, all .js files are treated as CommonJS.</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>这便设置成了。</p><h4 id="默认导出"><a href="#默认导出" class="headerlink" title="默认导出"></a>默认导出</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ECMAScript语法默认导出,外部import以后，全部加载</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">setResHeader</span>: setResHeader</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当我们需要时，如下导入即可。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入自定义工具模块,需要附带文件的后缀</span></span><br><span class="line"><span class="keyword">import</span> resHeaderUtil <span class="keyword">from</span> <span class="string">&#x27;./utils/resHeaderUtil-ecmascript-default.js&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="命名导出"><a href="#命名导出" class="headerlink" title="命名导出"></a>命名导出</h4><p>只需要在变量前面加上 export 修饰，即可在其它地方导入。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置http响应体的Content-Type</span></span><br><span class="line"><span class="comment">//ECMAScript语法命名导出,外部import按需导入，按需加载</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">setResHeader</span>(<span class="params">response, contentType</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (contentType == <span class="string">&quot;html&quot;</span>)</span><br><span class="line">        response.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (contentType == <span class="string">&quot;css&quot;</span>)</span><br><span class="line">        response.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/css;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (contentType == <span class="string">&quot;js&quot;</span>)</span><br><span class="line">        response.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/javascript;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        response.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>命名导出方式，在导入时，是按需导入，按需加载。花括号中放置需要的变量，不用像默认导出那样将整个模块都导入进来。</p><p>需要注意的是，花括号中的变量名，要和引入模块中的变量名或者函数名相同。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入自定义工具模块,需要附带文件的后缀</span></span><br><span class="line"><span class="keyword">import</span> &#123; setResHeader &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/resHeaderUtil-ecmascript-named.js&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="语法差异"><a href="#语法差异" class="headerlink" title="语法差异"></a>语法差异</h3><p>在Common.js中，我们可以使用__dirname来获取当前js文件所在目录的绝对路径，通过node:path模块的join方法来拼接自己想要的绝对路径。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加监听事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> pathname = req.<span class="property">url</span></span><br><span class="line">    <span class="keyword">var</span> postfix = pathname.<span class="title function_">match</span>(<span class="regexp">/(\.[^.]+|)$/</span>)[<span class="number">0</span>];<span class="comment">//取得后缀名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//readFile方法使用相对路径时，查找的起点是执行node xx.js命令的目录。这个目录与我们打开终端的位置有关，所以最好采用绝对路径。</span></span><br><span class="line">    <span class="comment">//其中__dirname是当前文件夹的绝对路径，通过path.join方法拼接路径可以将拼接后的路径转换成当前操作系统支持识别的绝对路径</span></span><br><span class="line">    <span class="keyword">let</span> filePath = path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;./Login&quot;</span>, pathname)</span><br><span class="line">    fs.<span class="title function_">readFile</span>(filePath, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html;charset=utf-8&quot;</span>)</span><br><span class="line">            res.<span class="title function_">end</span>(<span class="string">&quot;&lt;h1&gt;访问的内容不存在&lt;/h1&gt;&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//根据后缀设置响应头</span></span><br><span class="line">            <span class="keyword">if</span> (postfix == <span class="string">&quot;html&quot;</span>)</span><br><span class="line">                resHeaderUtil.<span class="title function_">setResHeader</span>(res, <span class="string">&quot;html&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (postfix == <span class="string">&quot;css&quot;</span>)</span><br><span class="line">                resHeaderUtil.<span class="title function_">setResHeader</span>(res, <span class="string">&quot;css&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (postfix == <span class="string">&quot;js&quot;</span>)</span><br><span class="line">                resHeaderUtil.<span class="title function_">setResHeader</span>(res, <span class="string">&quot;js&quot;</span>)</span><br><span class="line">            <span class="comment">//以...内容结束响应</span></span><br><span class="line">            res.<span class="title function_">end</span>(data.<span class="title function_">toString</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>但是当我们使用ES语法后，__dirname就不能使用了，否则会报错如下。</p><blockquote><p>ReferenceError: __dirname is not defined in ES module scope</p></blockquote><p>但是我们使用fs.readFile方法时，又经常需要使用到绝对路径。作为__dirname的替代方案，可以实现工具类如下。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> url <span class="keyword">from</span> <span class="string">&#x27;node:url&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;node:path&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getRecentDir</span>(<span class="params">fileUrl</span>) &#123;</span><br><span class="line">    <span class="comment">//将文件url转换成文件的绝对路径</span></span><br><span class="line">    <span class="keyword">let</span> filePath = url.<span class="title function_">fileURLToPath</span>(fileUrl)</span><br><span class="line">    <span class="comment">//获取绝对路径的最后目录名</span></span><br><span class="line">    <span class="keyword">let</span> dirname = path.<span class="title function_">dirname</span>(filePath)</span><br><span class="line">    <span class="comment">//返回给外界使用</span></span><br><span class="line">    <span class="keyword">return</span> dirname</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>外界传入对应的文件URL即可。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入自定义工具模块,需要附带文件的后缀</span></span><br><span class="line"><span class="keyword">import</span> &#123; setResHeader &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/resHeaderUtil-ecmascript-named.js&#x27;</span></span><br><span class="line"><span class="comment">//导入自定义的文件绝对路径工具</span></span><br><span class="line"><span class="keyword">import</span> &#123; getRecentDir &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/recentPath.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//添加监听事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> pathname = req.<span class="property">url</span></span><br><span class="line">    <span class="keyword">var</span> postfix = pathname.<span class="title function_">match</span>(<span class="regexp">/(\.[^.]+|)$/</span>)[<span class="number">0</span>];<span class="comment">//取得后缀名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//readFile方法使用相对路径时，查找的起点是执行node xx.js命令的目录。这个目录与我们打开终端的位置有关，所以最好采用绝对路径。</span></span><br><span class="line">    <span class="comment">//在ES语法中没有__dirname，要通过文件url转换得到当前文件夹的绝对路径，通过path.join方法拼接路径可以将拼接后的路径转换成当前操作系统支持识别的绝对路径</span></span><br><span class="line">    <span class="keyword">let</span> filePath = path.<span class="title function_">join</span>(<span class="title function_">getRecentDir</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>), <span class="string">&quot;./Login&quot;</span>, pathname)</span><br><span class="line">    fs.<span class="title function_">readFile</span>(filePath, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html;charset=utf-8&quot;</span>)</span><br><span class="line">            res.<span class="title function_">end</span>(<span class="string">&quot;&lt;h1&gt;访问的内容不存在&lt;/h1&gt;&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//根据后缀设置响应头</span></span><br><span class="line">            <span class="keyword">if</span> (postfix == <span class="string">&quot;html&quot;</span>)</span><br><span class="line">                <span class="comment">// resHeaderUtil.setResHeader(res, &quot;html&quot;)</span></span><br><span class="line">                <span class="title function_">setResHeader</span>(res, <span class="string">&quot;html&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (postfix == <span class="string">&quot;css&quot;</span>)</span><br><span class="line">                <span class="comment">// resHeaderUtil.setResHeader(res, &quot;css&quot;)</span></span><br><span class="line">                <span class="title function_">setResHeader</span>(res, <span class="string">&quot;css&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (postfix == <span class="string">&quot;js&quot;</span>)</span><br><span class="line">                <span class="comment">// resHeaderUtil.setResHeader(res, &quot;js&quot;)</span></span><br><span class="line">                <span class="title function_">setResHeader</span>(res, <span class="string">&quot;js&quot;</span>)</span><br><span class="line">            <span class="comment">//以...内容结束响应</span></span><br><span class="line">            res.<span class="title function_">end</span>(data.<span class="title function_">toString</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Commonjs和ECMAScript语法&quot;&gt;&lt;a href=&quot;#Commonjs和ECMAScript语法&quot; class=&quot;headerlink&quot; title=&quot;Commonjs和ECMAScript语法&quot;&gt;&lt;/a&gt;Commonjs和ECMAScript语法&lt;/</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="node.js" scheme="https://blog.kahvia.cn/tags/node-js/"/>
    
  </entry>
  
  <entry>
    <title>汇编语言练习</title>
    <link href="https://blog.kahvia.cn/2023/05/04/AssemblyLanguageWorks.html"/>
    <id>https://blog.kahvia.cn/2023/05/04/AssemblyLanguageWorks.html</id>
    <published>2023-05-04T08:05:54.790Z</published>
    <updated>2023-05-04T08:27:47.201Z</updated>
    
    <content type="html"><![CDATA[<h3 id="变量BUF3中存放着10个有符号的字节数据，编程将这10个数按从小到大排序。"><a href="#变量BUF3中存放着10个有符号的字节数据，编程将这10个数按从小到大排序。" class="headerlink" title="变量BUF3中存放着10个有符号的字节数据，编程将这10个数按从小到大排序。"></a>变量BUF3中存放着10个有符号的字节数据，编程将这10个数按从小到大排序。</h3><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>双指针排序。BP留在原地，SI不断移动，一旦发现比BP小的值，就把那个值和BP交换，SI从左往右走一轮可以使得BP所在位置的值最小。一轮走完再开一轮，BP向右移动一位，用以存放次小值，SI再去探险。如此循环。</p><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">;变量BUF3中存放着10个有符号的字节数据，编程将这10个数按从小到大排序。</span><br><span class="line">DSEG SEGMENT</span><br><span class="line">    BUF3       DB 10,9,8,7,6,5,4,3,2,1</span><br><span class="line">    BUFFLENGTH DB $-BUF3</span><br><span class="line">DSEG ENDS</span><br><span class="line"></span><br><span class="line">SSEG SEGMENT</span><br><span class="line">SSEG ENDS</span><br><span class="line"></span><br><span class="line">CSEG SEGMENT</span><br><span class="line">                   ASSUME DS:DSEG,SS:SSEG,CS:CSEG</span><br><span class="line">    START:         </span><br><span class="line">                   MOV    AX,DSEG</span><br><span class="line">                   MOV    DS,AX</span><br><span class="line"></span><br><span class="line">                   MOV    BP,OFFSET BUF3             ;用以指向BUF数组需要放置最小数的位置</span><br><span class="line">                   LEA    SI,BUF3                    ;移动这个指针来寻找最小值</span><br><span class="line"></span><br><span class="line">                   MOV    DH,BUFFLENGTH              ;外循环次数</span><br><span class="line"></span><br><span class="line">    ;MOV    DL,BUFFLENGTH-1            ;不能直接这么写，这样会把BUFFLENGTH处理为地址。地址减一，就成数组的最后一个值的地址了。</span><br><span class="line">                   MOV    DL,BUFFLENGTH</span><br><span class="line">                   DEC    DL                         ;DL是内循环次数</span><br><span class="line"></span><br><span class="line">    OUTERLOOP:     </span><br><span class="line">                   CMP    DH,0                       ;查看是否需要进行外循环</span><br><span class="line">                   JE     ENDLOOP</span><br><span class="line">                   DEC    DH</span><br><span class="line">                   MOV    DL,DH                      ;重置内循环次数</span><br><span class="line"></span><br><span class="line">                   MOV    SI,BP                      ;需要则，将用以移动寻找最小值的指针SI重置到需要放置最小值的指针处</span><br><span class="line">                   JMP    INNERLOOP</span><br><span class="line"></span><br><span class="line">    INNERLOOP:     </span><br><span class="line">                   INC    SI                         ;让SI自增，指向下一个数组元素</span><br><span class="line">                   MOV    AL,DS:[BP]</span><br><span class="line">                   CMP    DS:[SI],AL</span><br><span class="line">                   JLE    UPDATEMIN</span><br><span class="line">                   JMP    BEFORENEXTLOOP</span><br><span class="line">    </span><br><span class="line">    UPDATEMIN:                                       ;把到目前为止的最小值交换到目标最小值位置</span><br><span class="line">                   MOV    AL,DS:[BP]</span><br><span class="line">                   XCHG   AL,DS:[SI]</span><br><span class="line">                   MOV    DS:[BP],AL</span><br><span class="line"></span><br><span class="line">    BEFORENEXTLOOP:                                  ;在内循环进行下一次之前</span><br><span class="line">                   DEC    DL                         ;内循环剩余次数自减</span><br><span class="line">                   CMP    DL,0                       ;判断是否需要还需要进行内循环</span><br><span class="line">                   JG     INNERLOOP                  ;需要则进行</span><br><span class="line"></span><br><span class="line">                   INC    BP                         ;否则自增外循环初始数组地址</span><br><span class="line">                   JMP    OUTERLOOP                  ;进行外循环</span><br><span class="line">    ENDLOOP:       </span><br><span class="line">                   MOV    AH,4CH</span><br><span class="line">                   INT    21H</span><br><span class="line"></span><br><span class="line">CSEG ENDS</span><br><span class="line">END START</span><br></pre></td></tr></table></figure><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ul><li>不能写 “MOV    DL, BUFFLENGTH-1” ，因为会把BUFFLENGTH当成地址来减一然后取新地址的值，会导致DL中存放的是上一个变量即BUF3数组的最后一个数。</li><li>使用BP和SI的时候，需要指定段地址为DS，不然会找不到数据（虽然我也不知道为什么以前不写没事）。</li><li>涉及到双循环还是自己操作循环数比较方便。</li></ul><h4 id="结果图"><a href="#结果图" class="headerlink" title="结果图"></a>结果图</h4><p><img src="https://pics.kahvia.cn/img/%E5%8F%98%E9%87%8FBUF3%E4%B8%AD%E5%AD%98%E6%94%BE%E7%9D%8010%E4%B8%AA%E6%9C%89%E7%AC%A6%E5%8F%B7%E7%9A%84%E5%AD%97%E8%8A%82%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%BC%96%E7%A8%8B%E5%B0%86%E8%BF%9910%E4%B8%AA%E6%95%B0%E6%8C%89%E4%BB%8E%E5%B0%8F%E5%88%B0%E5%A4%A7%E6%8E%92%E5%BA%8F.png" alt="结果图"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;变量BUF3中存放着10个有符号的字节数据，编程将这10个数按从小到大排序。&quot;&gt;&lt;a href=&quot;#变量BUF3中存放着10个有符号的字节数据，编程将这10个数按从小到大排序。&quot; class=&quot;headerlink&quot; title=&quot;变量BUF3中存放着10个有符号</summary>
      
    
    
    
    <category term="微机 汇编" scheme="https://blog.kahvia.cn/categories/%E5%BE%AE%E6%9C%BA-%E6%B1%87%E7%BC%96/"/>
    
    
    <category term="AssemblyLanguage" scheme="https://blog.kahvia.cn/tags/AssemblyLanguage/"/>
    
  </entry>
  
  <entry>
    <title>前端练习1</title>
    <link href="https://blog.kahvia.cn/2023/04/18/HTML-Study.html"/>
    <id>https://blog.kahvia.cn/2023/04/18/HTML-Study.html</id>
    <published>2023-04-18T04:02:22.171Z</published>
    <updated>2023-04-18T04:31:05.874Z</updated>
    
    <content type="html"><![CDATA[<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>HTML:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Button Anime<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;button.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;:javascript&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;button.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>CSS:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100vh</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">13px</span> <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(<span class="built_in">rgb</span>(<span class="number">43</span>, <span class="number">190</span>, <span class="number">96</span>), <span class="built_in">rgb</span>(<span class="number">15</span>, <span class="number">157</span>, <span class="number">88</span>));</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: inherit;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="comment">/* var函数的参数必须以--开头 */</span></span><br><span class="line">    <span class="attribute">left</span>: <span class="built_in">var</span>(--xPos);</span><br><span class="line">    <span class="attribute">top</span>: <span class="built_in">var</span>(--yPos);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: black;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transition</span>: width <span class="number">0.5s</span>, height <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">600px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">600px</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span> <span class="selector-tag">a</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JS:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> button = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.btn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseover&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> x = e.<span class="property">clientX</span> - button.<span class="property">offsetLeft</span>;</span><br><span class="line">    <span class="keyword">const</span> y = e.<span class="property">clientY</span> - button.<span class="property">offsetTop</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//element.style.setPorperty是用于设置css的属性</span></span><br><span class="line">    button.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&#x27;--xPos&#x27;</span>, x + <span class="string">&#x27;px&#x27;</span>);</span><br><span class="line">    button.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&#x27;--yPos&#x27;</span>, y + <span class="string">&#x27;px&#x27;</span>);</span><br><span class="line">    <span class="comment">//element.setAttribute可以用于设置document元素的style属性，但是会覆盖style</span></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><p><img src="https://pics.kahvia.cn/img/screenshots.gif" alt="效果图"></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol><li><p>transition和transform是两个不同的CSS属性，它们的作用和用法也不同：</p><ul><li>transition是用来设置元素在不同状态之间切换时的过渡效果的，它可以指定要过渡的属性、过渡的持续时间、过渡的速度曲线和过渡的延迟时间¹。transition可以让元素的属性值平滑地变化，而不是突然跳变。</li><li>transform是用来设置元素的变形效果的，它可以对元素进行旋转、缩放、倾斜、移动等操作，改变元素在二维或三维空间中的形状和位置²。transform可以让元素产生视觉上的变化，而不影响元素在文档流中的位置。</li></ul><p>简单地说，transition是用来控制元素属性值的变化速度和方式的，而transform是用来控制元素形状和位置的变化效果的。两者可以结合使用，实现更多种类的动画效果。例如，你可以用transition来设置transform属性的过渡效果，让元素在旋转或缩放时有一个平滑的动画³。</p><p>源: 与必应的对话， 2023&#x2F;4&#x2F;18<br>(1) CSS transforms VS transitions - Stack Overflow. <a href="https://stackoverflow.com/questions/19186585/css-transforms-vs-transitions">https://stackoverflow.com/questions/19186585/css-transforms-vs-transitions</a>.<br>(2) CSS Transitions - W3School. <a href="https://www.w3schools.com/css/css3_transitions.asp">https://www.w3schools.com/css/css3_transitions.asp</a>.<br>(3) Easy CSS Animation With Transition &amp; Transforms. <a href="https://webdesignerwall.com/tutorials/easy-css-animation-transition-transforms">https://webdesignerwall.com/tutorials/easy-css-animation-transition-transforms</a>.</p></li><li><p>element.setAttribute()和element.style.setProperty()有一些区别，主要是：</p><ul><li>element.setAttribute()是用来设置元素的属性的，它可以设置任何属性，包括自定义属性¹。element.style.setProperty()是用来设置元素的样式属性的，它只能设置CSS属性²。</li><li>element.setAttribute()的第一个参数是属性名，第二个参数是属性值。如果属性已经存在，它会更新属性值，如果不存在，它会添加一个新的属性¹。element.style.setProperty()的第一个参数是CSS属性名，第二个参数是CSS属性值，第三个参数是可选的，表示优先级（如&quot;important&quot;）²。</li><li>element.setAttribute()的属性名不区分大小写，但是在HTML文档中，它会自动转换为小写¹。element.style.setProperty()的CSS属性名区分大小写，但是要使用连字符分隔的形式（如&quot;background-color&quot;），而不是驼峰形式（如&quot;backgroundColor&quot;）²。</li></ul><p>一般来说，如果你想设置元素的样式属性，建议使用element.style.setProperty()，因为它更符合CSS规范，并且可以避免一些浏览器兼容性问题³。如果你想设置元素的其他属性，例如id、class、data-*等，可以使用element.setAttribute()。</p><p>源: 与必应的对话， 2023&#x2F;4&#x2F;18<br>(1) javascript - Setting a property via property or setAttribute - Stack …. <a href="https://stackoverflow.com/questions/8018814/setting-a-property-via-property-or-setattribute">https://stackoverflow.com/questions/8018814/setting-a-property-via-property-or-setattribute</a>.<br>(2) Element: setAttribute() method - Web APIs | MDN - Mozilla Developer. <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute">https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute</a>.<br>(3) When to use setAttribute vs .attribute&#x3D; in JavaScript?. <a href="https://stackoverflow.com/questions/3919291/when-to-use-setattribute-vs-attribute-in-javascript">https://stackoverflow.com/questions/3919291/when-to-use-setattribute-vs-attribute-in-javascript</a>.</p></li><li><p>var()函数是CSS中的一个函数，它可以插入一个自定义属性（有时也被称为“CSS变量”）的值，用来代替非自定义属性中值的任何部分¹²。例如，你可以在:root上定义一个名为–main-bg-color的自定义属性，然后在其他地方使用var(–main-bg-color)来引用它的值²。var()函数的第一个参数是要替换的自定义属性的名称，第二个参数是可选的，用作回退值，如果第一个参数引用的自定义属性无效，则该函数将使用第二个值¹。</p><p>源: 与必应的对话， 2023&#x2F;4&#x2F;18<br>(1) var() - CSS：层叠样式表 | MDN - Mozilla Developer. <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/var">https://developer.mozilla.org/zh-CN/docs/Web/CSS/var</a>.<br>(2) CSS var() 函数 - w3school. <a href="https://www.w3school.com.cn/cssref/func_var.asp">https://www.w3school.com.cn/cssref/func_var.asp</a>.<br>(3) var() - CSS: Cascading Style Sheets | MDN - Mozilla Developer. <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/var">https://developer.mozilla.org/en-US/docs/Web/CSS/var</a>.</p></li><li><p>var()函数的第一个参数必须是一个以两个破折号开头的有效标识符，表示自定义属性的名称¹。你可以元素上定义这两个自定义属性，然后给它们赋值，例如：</p><p>:root {<br>  –data-x: 50%;<br>  –data-y: 50%;<br>}</p><p>或者</p><p>.btn {<br>  –data-x: 50%;<br>  –data-y: 50%;<br>}</p><p>然后你就可以在::before伪元素中使用var(–data-x)和var(–data-y)来引用它们的值了。</p><p>源: 与必应的对话， 2023&#x2F;4&#x2F;18<br>(1) var() - CSS: Cascading Style Sheets | MDN - Mozilla Developer. <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/var">https://developer.mozilla.org/en-US/docs/Web/CSS/var</a>.<br>(2) var() - CSS：层叠样式表 | MDN - Mozilla Developer. <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/var">https://developer.mozilla.org/zh-CN/docs/Web/CSS/var</a>.</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;代码&quot;&gt;&lt;a href=&quot;#代码&quot; class=&quot;headerlink&quot; title=&quot;代码&quot;&gt;&lt;/a&gt;代码&lt;/h3&gt;&lt;p&gt;HTML:&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;</summary>
      
    
    
    
    <category term="前端练习" scheme="https://blog.kahvia.cn/categories/%E5%89%8D%E7%AB%AF%E7%BB%83%E4%B9%A0/"/>
    
    
    <category term="Html Css JavaScript" scheme="https://blog.kahvia.cn/tags/Html-Css-JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Flutter-AzListView</title>
    <link href="https://blog.kahvia.cn/2023/03/14/FlutterAzList_fix.html"/>
    <id>https://blog.kahvia.cn/2023/03/14/FlutterAzList_fix.html</id>
    <published>2023-03-14T06:43:52.459Z</published>
    <updated>2023-03-14T08:29:02.543Z</updated>
    
    <content type="html"><![CDATA[<h3 id="修复数据过少时跳转反弹"><a href="#修复数据过少时跳转反弹" class="headerlink" title="修复数据过少时跳转反弹"></a>修复数据过少时跳转反弹</h3><p>修改源码中滚动代码如下所示。</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _scrollTopIndex(<span class="built_in">String</span> tag) &#123;</span><br><span class="line">  <span class="built_in">int</span> index = _getIndex(tag);</span><br><span class="line">  <span class="built_in">int</span> itemsCountOnScreen = itemPositionsListener.itemPositions.value.length;</span><br><span class="line">  <span class="keyword">if</span> (index != <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="comment">//如果要跳转的条目后面的数据个数&lt;屏幕可容纳的数据个数,使用align属性去调整跳转</span></span><br><span class="line">    <span class="comment">//条目在屏幕上的位置。align默认是0，即条目的头部top与可视部分上边缘对齐。</span></span><br><span class="line">    <span class="comment">//计算正确的对齐位置，才能让它正常显示。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//if the the items&#x27;counts after the item you want to jump less than</span></span><br><span class="line">    <span class="comment">//full screen items counts, use the align to justify the item&#x27;s location</span></span><br><span class="line">    <span class="comment">// to be correct. The align defaults to be 0, which means the item&#x27;s top</span></span><br><span class="line">    <span class="comment">// to align the view&#x27;s top.</span></span><br><span class="line">    /ange the data of alignment and make it <span class="keyword">show</span> properly.</span><br><span class="line">    <span class="keyword">if</span> ((widget.data.length - index) &lt; itemsCountOnScreen) &#123;</span><br><span class="line">      <span class="comment">//可视口由两部分组成，一个是其它数据，一个是期望数据（即想要跳转却不足以填充屏幕的数据）。</span></span><br><span class="line">      <span class="comment">//用其他数据个数/总数据个数，作为alignment，就可以让期望数据正确对齐而不发生反弹。</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//The view port includes other datas and expected datas(this refers to</span></span><br><span class="line">      <span class="comment">//the data you want to jump but can&#x27;t fill the screen and therefor causes</span></span><br><span class="line">      <span class="comment">//out bouncing).</span></span><br><span class="line">      <span class="comment">//other datas&#x27; length / all datas&#x27;length = alignment(the correct rete to align expected datas)</span></span><br><span class="line">      <span class="built_in">double</span> alignment = (itemsCountOnScreen - (widget.data.length - index)) /</span><br><span class="line">          itemsCountOnScreen;</span><br><span class="line">      itemScrollController.jumpTo(alignment: alignment, index: index);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      itemScrollController.jumpTo(index: index);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;修复数据过少时跳转反弹&quot;&gt;&lt;a href=&quot;#修复数据过少时跳转反弹&quot; class=&quot;headerlink&quot; title=&quot;修复数据过少时跳转反弹&quot;&gt;&lt;/a&gt;修复数据过少时跳转反弹&lt;/h3&gt;&lt;p&gt;修改源码中滚动代码如下所示。&lt;/p&gt;
&lt;figure class=&quot;</summary>
      
    
    
    
    <category term="小问题" scheme="https://blog.kahvia.cn/categories/%E5%B0%8F%E9%97%AE%E9%A2%98/"/>
    
    
    <category term="Flutter" scheme="https://blog.kahvia.cn/tags/Flutter/"/>
    
  </entry>
  
  <entry>
    <title>Nacos集群模式</title>
    <link href="https://blog.kahvia.cn/2023/01/05/NacosCluster.html"/>
    <id>https://blog.kahvia.cn/2023/01/05/NacosCluster.html</id>
    <published>2023-01-05T11:57:54.574Z</published>
    <updated>2023-01-05T12:26:32.227Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Nacos集群模式"><a href="#Nacos集群模式" class="headerlink" title="Nacos集群模式"></a>Nacos集群模式</h3><p>想要使用nacos的集群模式，就需要为其配置单独的数据库。</p><ol><li>先在 mysql 数据库中创建数据库NacosDb ，再使用 conf 目录下的 nacos-mysql.sql 文件，创建相关表结构。文件如下所示。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright 1999-2018 Alibaba Group Holding Ltd.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  `c_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_use` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `effect` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `c_schema` text,</span><br><span class="line">  `encrypted_data_key` text <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;秘钥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info_aggr   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_aggr` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `datum_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;datum_id&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;内容&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;增加租户字段&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info_beta   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_beta` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `beta_ips` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;betaIps&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  `encrypted_data_key` text <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;秘钥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_beta&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_info_tag   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_info_tag` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tag_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_id&#x27;</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;content&#x27;</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;md5&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  `src_user` text COMMENT <span class="string">&#x27;source user&#x27;</span>,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;source ip&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_info_tag&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = config_tags_relation   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `config_tags_relation` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `tag_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_name&#x27;</span>,</span><br><span class="line">  `tag_type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tag_type&#x27;</span>,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;data_id&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;group_id&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;config_tag_relation&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = group_capacity   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `group_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Group ID，空字符表示整个集群&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;配额，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;使用量&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个配置大小上限，单位为字节，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;聚合子配置最大个数，，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;最大变更历史数量&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_group_id` (`group_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;集群、各Group容量信息表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = his_config_info   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `his_config_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `nid` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `data_id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `group_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `app_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;app_name&#x27;</span>,</span><br><span class="line">  `content` longtext <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `md5` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `src_user` text,</span><br><span class="line">  `src_ip` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `op_type` <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;租户字段&#x27;</span>,</span><br><span class="line">  `encrypted_data_key` text <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;秘钥&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`nid`),</span><br><span class="line">  KEY `idx_gmt_create` (`gmt_create`),</span><br><span class="line">  KEY `idx_gmt_modified` (`gmt_modified`),</span><br><span class="line">  KEY `idx_did` (`data_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;多租户改造&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="comment">/*   数据库全名 = nacos_config   */</span></span><br><span class="line"><span class="comment">/*   表名称 = tenant_capacity   */</span></span><br><span class="line"><span class="comment">/******************************************/</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_capacity` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;Tenant ID&#x27;</span>,</span><br><span class="line">  `quota` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;配额，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `usage` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;使用量&#x27;</span>,</span><br><span class="line">  `max_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个配置大小上限，单位为字节，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_aggr_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;聚合子配置最大个数&#x27;</span>,</span><br><span class="line">  `max_aggr_size` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#x27;</span>,</span><br><span class="line">  `max_history_count` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;最大变更历史数量&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;租户容量信息表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tenant_info` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `kp` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;kp&#x27;</span>,</span><br><span class="line">  `tenant_id` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_id&#x27;</span>,</span><br><span class="line">  `tenant_name` <span class="type">varchar</span>(<span class="number">128</span>) <span class="keyword">default</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;tenant_name&#x27;</span>,</span><br><span class="line">  `tenant_desc` <span class="type">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;tenant_desc&#x27;</span>,</span><br><span class="line">  `create_source` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;create_source&#x27;</span>,</span><br><span class="line">  `gmt_create` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),</span><br><span class="line">  KEY `idx_tenant_id` (`tenant_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;tenant_info&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">`password` <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`enabled` <span class="type">boolean</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `roles` (</span><br><span class="line">`username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">`role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX `idx_user_role` (`username` <span class="keyword">ASC</span>, `role` <span class="keyword">ASC</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `permissions` (</span><br><span class="line">    `role` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `resource` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `action` <span class="type">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> INDEX `uk_role_permission` (`role`,`resource`,`action`) <span class="keyword">USING</span> BTREE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (username, password, enabled) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#x27;</span>, <span class="literal">TRUE</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> roles (username, role) <span class="keyword">VALUES</span> (<span class="string">&#x27;nacos&#x27;</span>, <span class="string">&#x27;ROLE_ADMIN&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li><p>配置 conf 目录下的 application.properties 配置文件，重要几项如下所示，主要是配置当前节点的一些信息，而且，有几个nacos节点就要复制几个nacos文件夹作相同的配置。</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Default web context path:</span></span><br><span class="line"><span class="attr">server.servlet.contextPath</span>=<span class="string">/nacos</span></span><br><span class="line"><span class="comment">### Include message field</span></span><br><span class="line"><span class="attr">server.error.include-message</span>=<span class="string">ON_PARAM</span></span><br><span class="line"><span class="comment">### 当前nacos节点对应端口号</span></span><br><span class="line"><span class="comment">### Default web server port:</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8841</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#*************** Network Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### If prefer hostname over ip for Nacos server addresses in cluster.conf:</span></span><br><span class="line"><span class="comment"># nacos.inetutils.prefer-hostname-over-ip=false</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### Specify local server&#x27;s IP:</span></span><br><span class="line"><span class="comment"># nacos.inetutils.ip-address=</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#*************** Config Module Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### 下面这项需要去掉注释，因为我们要配置数据库</span></span><br><span class="line"><span class="comment">### If use MySQL as datasource:</span></span><br><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### 数据库的数量</span></span><br><span class="line"><span class="comment">### Count of DB:</span></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### Connect URL of DB:</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://www.kahvia.cn:3306/NacosDb（这是我创建的数据库名称）?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user.0</span>=<span class="string">数据库账号</span></span><br><span class="line"><span class="attr">db.password.0</span>=<span class="string">密码</span></span><br></pre></td></tr></table></figure></li><li><p>配置 cluster.conf (需要去掉example后缀), 即便是本地配置，也不能使用 localhost 或者127.0.0.1。要使用通过 cmd 和 ipconfig 查看到的ipv4地址，<a href="https://blog.csdn.net/u010696630/article/details/123617028">原因在这里</a>。端口也不能连续，<a href="https://blog.csdn.net/w_e_i_a_i_/article/details/121993518">原因在这里</a>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 列出各 nacos 节点的ip地址和端口号。谁让它们是一起作负载均衡用的呢？</span><br><span class="line">192.168.137.1:8841</span><br><span class="line">192.168.137.1:8843</span><br></pre></td></tr></table></figure></li><li><p>配置nginx，对于上方配置的nacos节点作负载均衡。因为微服务可能有很多很多，注册中心由一个nacos节点来可能不够用。所以上面配置了多个nacos节点，再采用nginx作负载均衡。nginx.conf 文件如下所示。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line"><span class="section">upstream</span> nacos-cluster &#123;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:8841</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:8843</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> /nacos &#123;</span><br><span class="line"><span class="attribute">proxy_pass</span> http://nacos-cluster;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    root           html;</span></span><br><span class="line">        <span class="comment">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line">        <span class="comment">#    fastcgi_index  index.php;</span></span><br><span class="line">        <span class="comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class="line">        <span class="comment">#    include        fastcgi_params;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line">        <span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">        <span class="comment">#    deny  all;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># another virtual host using mix of IP-, name-, and port-based configuration</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       8000;</span></span><br><span class="line">    <span class="comment">#    listen       somename:8080;</span></span><br><span class="line">    <span class="comment">#    server_name  somename  alias  another.alias;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTPS server</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       443 ssl;</span></span><br><span class="line">    <span class="comment">#    server_name  localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_certificate      cert.pem;</span></span><br><span class="line">    <span class="comment">#    ssl_certificate_key  cert.key;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_session_cache    shared:SSL:1m;</span></span><br><span class="line">    <span class="comment">#    ssl_session_timeout  5m;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span><br><span class="line">    <span class="comment">#    ssl_prefer_server_ciphers  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>配置完nginx，依次启动各nacos节点，再启动nginx即可。</p></li><li><p>最后启动各项 spring boot 微服务。需要配置 nacos 服务端地址，也就是上面作负载均衡的地址。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://xxx.xxx.xxx:3306/xxx?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">xxxxx</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxxxx</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ImageService</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.137</span><span class="number">.1</span><span class="string">:80</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">39941</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><p>最后附上一张效果图。</p><p><img src="https://pics.kahvia.cn/img/image-20230105202443232.png" alt="nacos集群模式效果图"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;Nacos集群模式&quot;&gt;&lt;a href=&quot;#Nacos集群模式&quot; class=&quot;headerlink&quot; title=&quot;Nacos集群模式&quot;&gt;&lt;/a&gt;Nacos集群模式&lt;/h3&gt;&lt;p&gt;想要使用nacos的集群模式，就需要为其配置单独的数据库。&lt;/p&gt;
&lt;ol&gt;
&lt;li</summary>
      
    
    
    
    <category term="知识" scheme="https://blog.kahvia.cn/categories/%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="MicroService" scheme="https://blog.kahvia.cn/tags/MicroService/"/>
    
  </entry>
  
</feed>
